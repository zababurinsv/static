var Module={};function isImageData(t){return t instanceof ImageData}function isCanvasImageSource(t){return t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof ImageBitmap}function toCanvas(t){if(console.assert(isCanvasImageSource(t)),t instanceof HTMLCanvasElement)return t;var e=document.createElement("canvas");return e.width=t.videoWidth||t.naturalWidth||t.width,e.height=t.videoHeight||t.naturalHeight||t.height,e.getContext("2d").drawImage(t,0,0,e.width,e.height),e}function readImageData(t){if(console.assert(t),isImageData(t))return t;var e=toCanvas(t);return e.getContext("2d").getImageData(0,0,e.width,e.height)}function writeImageDataToCanvas(t,e,n,a){t.width=n,t.height=a;var r=t.getContext("2d"),s=r.createImageData(n,a);return s.data.set(e),r.putImageData(s,0,0),t}function writeImageData(t,e,n,a){if(console.assert(t),"function"!=typeof t){if(isImageData(t))return console.assert(t.width===n,t.height===a),void t.data.set(e);console.assert(t instanceof HTMLElement),console.assert(!(t instanceof HTMLVideoElement),"Cannot write to video element");var r=t instanceof HTMLCanvasElement?t:document.createElement("canvas");writeImageDataToCanvas(r,e,n,a),t instanceof HTMLCanvasElement||(t instanceof HTMLImageElement?t.src=r.toDataURL():t.appendChild(r))}else t(e,n,a)}function drawVideo(t,e){const n=document.createElement("canvas");if(n.width=t.videoWidth,n.height=t.videoHeight,context=n.getContext("2d"),context.drawImage(t,0,0,n.width,n.height),pixels=context.getImageData(0,0,t.width,t.height),pixels.data.set(filter(pixels.data)),!e){if(!document.querySelector("#wasm-canvas")){const t=document.createElement("canvas");t.id="wasm-canvas";t.getContext("2d")}}}function createFilter(t){return function(e,n){if(e instanceof HTMLVideoElement)e.paused||requestAnimationFrame(drawVideo(e,n));else if(e instanceof HTMLCanvasElement){const n=e.getContext("2d"),a=n.getImageData(0,0,e.width,e.height);a.data.set(t(a.data)),n.putImageData(a,0,0)}}}function loadWASM(){return new Promise((t,e)=>{if("WebAssembly"in window)fetch("./lib/webdsp_c.wasm").then(t=>t.arrayBuffer()).then(e=>{Module.wasmBinary=e,script=document.createElement("script"),doneEvent=new Event("done"),script.addEventListener("done",function(){console.log("Emscripten boilerplate loaded.");const e={grayScale:function(t){const e=t.length,n=_malloc(e);HEAPU8.set(t,n),_grayScale(n,e);const a=HEAPU8.subarray(n,n+e);return _free(n),a},brighten:function(t,e=25){const n=t.length,a=_malloc(n);HEAPU8.set(t,a),_brighten(a,n,e);const r=HEAPU8.subarray(a,a+n);return _free(a),r},invert:function(t){const e=t.length,n=_malloc(e);HEAPU8.set(t,n),_invert(n,e);const a=HEAPU8.subarray(n,n+e);return _free(n),a},noise:function(t){const e=t.length,n=_malloc(e*Float32Array.BYTES_PER_ELEMENT);HEAPF32.set(t,n/Float32Array.BYTES_PER_ELEMENT),_noise(n,e);const a=HEAPF32.subarray(n/Float32Array.BYTES_PER_ELEMENT,n/Float32Array.BYTES_PER_ELEMENT+e);return _free(n),a},multiFilter:function(t,e,n,a,r,s){const o=t.length,i=_malloc(o);HEAPU8.set(t,i),_multiFilter(i,o,e,n,a,r,s);const l=HEAPU8.subarray(i,i+o);return _free(i),l},multiFilterFloat:function(t,e,n,a,r,s){const o=t.length,i=_malloc(o*Float32Array.BYTES_PER_ELEMENT);HEAPF32.set(t,i/Float32Array.BYTES_PER_ELEMENT),_multiFilterFloat(i,o,e,n,a,r,s);const l=HEAPF32.subarray(i/Float32Array.BYTES_PER_ELEMENT,i/Float32Array.BYTES_PER_ELEMENT+o);return _free(i),l}};let n=e.multiFilter,a=e.multiFilterFloat;e.sunset=bindLastArgs(n,4,127,2,4),e.analogTV=bindLastArgs(n,7,127,2,4),e.emboss=bindLastArgs(n,1,127,2,4),e.urple=bindLastArgs(n,2,127,2,4),e.forest=bindLastArgs(a,5,127,3,1),e.romance=bindLastArgs(a,8,127,3,2),e.hippo=bindLastArgs(a,2,80,3,2),e.longhorn=bindLastArgs(a,2,27,3,2),e.underground=bindLastArgs(n,8,127,1,4),e.rooster=bindLastArgs(n,8,60,1,4),e.moss=bindLastArgs(a,1,127,1,1),e.mist=bindLastArgs(n,1,127,1,1),e.kaleidoscope=bindLastArgs(n,1,124,4,3),e.tingle=bindLastArgs(a,1,124,4,3),e.bacteria=bindLastArgs(n,4,0,2,4),e.hulk=bindLastArgs(n,2,10,2,4),e.ghost=bindLastArgs(n,1,5,2,4),e.swamp=bindLastArgs(a,1,40,2,3),e.twisted=bindLastArgs(n,1,40,2,3),e.security=bindLastArgs(n,1,120,1,0),e.robbery=bindLastArgs(a,1,120,1,0),e.sobelFilter=function(t,e,n,a=!1){const r=t.length,s=_malloc(r);HEAPU8.set(t,s),_sobelFilter(s,e,n,a);const o=HEAPU8.subarray(s,s+r);return _free(s),o},e.convFilter=function(t,e,n,a,r,s=0,o=1){const i=t.length,l=_malloc(i*Float32Array.BYTES_PER_ELEMENT);HEAPF32.set(t,l/Float32Array.BYTES_PER_ELEMENT);const c=a[0].length,d=a.length,E=c*d,g=a.reduce((t,e)=>t.concat(e)),u=_malloc(E*Float32Array.BYTES_PER_ELEMENT);HEAPF32.set(g,u/Float32Array.BYTES_PER_ELEMENT),_convFilter(l,e,n,u,3,3,r,s,o);const m=HEAPF32.subarray(l/Float32Array.BYTES_PER_ELEMENT,l/Float32Array.BYTES_PER_ELEMENT+i);return _free(l),_free(u),m};let r=[[1,1,1],[1,1,1],[1,1,1]],s=9,o=e.convFilter;e.blur=bindLastArgs(o,r,s,0,3),r=[[-1,-1,-1],[-1,8,-1],[-1,-1,-1]],s=1,e.strongSharpen=bindLastArgs(o,r,s),r=[[0,-1,0],[-1,5,-1],[0,-1,0]],s=2,e.sharpen=bindLastArgs(o,r,s),r=[[1,-1,-1],[-1,8,-1],[-1,-1,1]],s=3,e.clarity=bindLastArgs(o,r,s),r=[[-1,-1,1],[-1,14,-1],[1,-1,-1]],s=3,e.goodMorning=bindLastArgs(o,r,s),r=[[4,-1,-1],[-1,4,-1],[0,-1,4]],s=3,e.acid=bindLastArgs(o,r,s),r=[[0,0,-1],[-1,12,-1],[0,-1,-1]],s=2,e.dewdrops=bindLastArgs(o,r,s),r=[[-1,-1,4],[-1,9,-1],[0,-1,0]],s=2,e.destruction=bindLastArgs(o,r,s),t(e)}),script.src="./lib/webdsp_c.js",document.body.appendChild(script)});else{console.log("Couldn't load WASM, loading JS Fallback");const e=document.createElement("script");e.src="./lib/webdsp_polyfill.js",e.onload=function(){return t(jsFallback())},document.body.appendChild(e)}})}function bindLastArgs(t,...e){return function(...n){return t(...n,...e)}}