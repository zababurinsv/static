import store from"/static/html/components/component_modules/staticProperty/staticProperty.mjs";import matcher from"/static/html/components/component_modules/matcher/matcher.mjs";import action from"/static/html/components/component_modules/action/action.mjs";import staticProperty from"/static/html/components/component_modules/staticProperty/staticProperty.mjs";import addEventListener from"/static/html/components/component_modules/addEventListener/addEventListener.mjs";customElements.define("lacerta-moderator",class extends HTMLElement{static get observedAttributes(){return["feed"]}constructor(){super();let t=[],e=[],r=[],a=[];function n(e,r){return new Promise(function(r,a){if(e.verify=[],e.this.getAttribute("preset"))switch(e.this.getAttribute("preset")){case"default":e["path-template"]=`/static/html/components/${e.component}/template/${e.component}.html`,e.preset=`${e.this.getAttribute("preset")}`,e.verify.preset=!0;break;default:e["path-template"]=`/static/html/components/${e.component}/template/${e.this.getAttribute("preset")}.html`,e.preset=`${e.this.getAttribute("preset")}`,e.verify.preset=!0}else e["path-template"]=`/static/html/components/${e.component}/${e.component}.html`,e.verify.preset=!1;fetch(e["path-template"]).then(function(t){if(t.ok)return t.text()}).then(function(a){let n=(new DOMParser).parseFromString(a,"text/html");e.template=n.getElementsByTagName("template")[0].content.cloneNode(!0),function(e){return new Promise(function(r,a){e["path-external"]=`/static/html/components/${e.component}/external/${e.component}-external.html`,fetch(e["path-external"]).then(function(t){return!1===t.ok?t.ok:t.text()}).then(function(a){if(!1===a);else{let n=new DOMParser,o=n.parseFromString(a,"text/html");e.external=o.querySelectorAll("section"),function(e){return new Promise(function(r,a){e["external-property"]=t["external-property"];let n=[],o=[],i=[];for(let t=0;t<e.external.length;t++){for(let r=0;r<e.external[t].children.length;r++)switch(e.external[t].children[r].tagName){case"SCRIPT":e.external[t].getAttribute("id")&&(o.script=e.external[t].children[r]);break;case"COMPONENT-ID":o.id=e.external[t].children[r].innerText;break;case"COMPONENT-ACTION":for(let a=0;a<e.external[t].children[r].children.length;a++)i.push(e.external[t].children[r].children[a].innerText);o.actions=i}n.push(o),o=[]}e["external-property"]=n,r(e)}).catch(t=>{})}(e).then(t=>{0===t["external-property"].length?r(t):function(t){return new Promise(function(e,r){t["words-action"]=[];let a=[];for(let r=0;r<t["external-property"].length;r++){for(let e=0;e<t["external-property"][r].actions.length;e++)for(let n=0;n<t.words.length;n++)-1!==t["external-property"][r].actions[e].indexOf(t.words[n])&&("shadowRoot"!==t.words[n]&&"shadow"!==t.words[e]||(a.shadow=!0),"light"!==t.words[n]&&"лайт"!==t.words[e]||(a.light=!0),"editor"===t.words[n]&&(a.editor=!0),"слайдер"===t.words[n]&&(a["editor-slider"]=!0),"swap"===t.words[n]&&(a.swap=!0));t["words-action"]=a;for(let e in t["external-property"])for(let r in t["external-property"][e])switch(r){case"id":let a=document.createElement(t["external-property"][e][r]);a.setAttribute("type","external"),t.this.appendChild(a)}e(t)}})}(t).then(t=>{r(t)})})}}).catch(t=>{throw t})})}(e).then(t=>{(function(t,e,r){return new Promise(function(e,r){t["template-shadow"]=[],t["template-light"]=[];let a=[];a.swap=!1,a.blog=!1,a.external=!1,a.light=!1,a.slider=!1,a.one=!1,a.sliderText=!1,a.text=!1;for(let e=0;e<t.type.length;e++){if(-1!==t.type[e].indexOf("slider")&&t.type[e].split("-").length>1){a.slider=!0;for(let r in t.type[e].split("-"))switch(t.type[e].split("-")[r]){case"one":a.one=!0}}if(t.type[e].length)if(t.type[e].split("-").length>1)switch(t.type[e].split("-")[0]){case"blog":a.blog=!0;break;default:console.log("типы не отслеживаются",t.type[e])}else switch(t.type[e]){case"swap":a.swap=!0;break;case"external":a.external=!0;break;case"light":a.light=!0;break;case"slider":a.slider=!0;break;case"sliderText":a.sliderText=!0;break;case"text":a.text=!0}}if(t.this.getAttribute("parent")&&(t.parent=t.this.getAttribute("parent")),!0===a.swap){for(let e=0;e<t.this.children.length;e++)1===t.this.children[e].tagName.split("-").length?("view"===t.this.children[e].slot&&(t.this.children[e].className="wall"),t["template-light"].push(t.this.children[e])):!0===t.getAttribute(t.this.children[e],"light","template")?(t.this.children[e].setAttribute("type",`${t.this.children[e].getAttribute("type")}-external`),!1===t.parent?t.slot?t.this.children[e].setAttribute("parent",`${t.slot}`):t.this.children[e].setAttribute("parent",`${t.component}`):t.this.children[e].setAttribute("parent",`${t.parent}`),o(t.this.children[e],t),t["template-light"].push(t.this.children[e])):(t.this.children[e].setAttribute("type",`${t.this.children[e].getAttribute("type")}-external`),!1===t.parent?t.slot?t.this.children[e].setAttribute("parent",`${t.slot}`):t.this.children[e].setAttribute("parent",`${t.component}`):t.this.children[e].setAttribute("parent",`${t.parent}`),o(t.this.children[e],t),t["template-shadow"].push(t.this.children[e]));for(let e=0;e<t.template.children.length;e++)1===t.template.children[e].tagName.split("-").length?("view"===t.template.children[e].slot&&(t.template.children[e].className="wall"),t["template-light"].push(t.template.children[e])):!0===t.getAttribute(t.template.children[e],"light","template")?(t.template.children[e].setAttribute("type",`${t.template.children[e].getAttribute("type")}-external`),!1===t.parent?t.slot?t.this.children[e].setAttribute("parent",`${t.slot}`):t.this.children[e].setAttribute("parent",`${t.component}`):t.this.children[e].setAttribute("parent",`${t.parent}`),o(t.template.children[e],t),t["template-light"].push(t.template.children[e])):(t.template.children[e].setAttribute("type",`${t.template.children[e].getAttribute("type")}-external`),!1===t.parent?t.slot?t.this.children[e].setAttribute("parent",`${t.slot}`):t.this.children[e].setAttribute("parent",`${t.component}`):t.this.children[e].setAttribute("parent",`${t.parent}`),o(t.template.children[e],t),t["template-shadow"].push(t.template.children[e]))}else{for(let e=0;e<t.this.children.length;e++)1===t.this.children[e].tagName.split("-").length?("view"===t.this.children[e].slot&&(t.this.children[e].className="wall"),t["template-shadow"].push(t.this.children[e])):!0===t.getAttribute(t.this.children[e],"light","template")?(!1===t.parent?t.slot?t.this.children[e].setAttribute("parent",`${t.slot}`):t.this.children[e].setAttribute("parent",`${t.component}`):t.this.children[e].setAttribute("parent",`${t.parent}`),o(t.this.children[e],t),t["template-shadow"].push(t.this.children[e])):(!1===t.parent?t.slot?t.this.children[e].setAttribute("parent",`${t.slot}`):t.this.children[e].setAttribute("parent",`${t.component}`):t.this.children[e].setAttribute("parent",`${t.parent}`),o(t.this.children[e],t),t["template-light"].push(t.this.children[e]));for(let e=0;e<t.template.children.length;e++)1===t.template.children[e].tagName.split("-").length?("view"===t.template.children[e].slot&&(t.template.children[e].className="wall"),t["template-shadow"].push(t.template.children[e])):!0===t.getAttribute(t.template.children[e],"light","template")?(!1===t.parent?t.slot?t.this.children[e].setAttribute("parent",`${t.slot}`):t.this.children[e].setAttribute("parent",`${t.component}`):t.this.children[e].setAttribute("parent",`${t.parent}`),o(t.template.children[e],t),t["template-shadow"].push(t.template.children[e])):(!1===t.parent?t.slot?t.this.children[e].setAttribute("parent",`${t.slot}`):t.this.children[e].setAttribute("parent",`${t.component}`):t.this.children[e].setAttribute("parent",`${t.parent}`),o(t.template.children[e],t),t["template-light"].push(t.template.children[e]))}for(let e in a)t.verify[e]=a[e];e(t)})})(t,t["type-swap"],t["type-external"]).then(t=>{if(!0===t.verify.swap){if(0!==t["template-light"].length)for(let e=0;e<t["template-light"].length;e++)t.this.prepend(t["template-light"][e]);if(0!==t["template-shadow"].length){t.this.attachShadow({mode:"open"}),t.shadowRoot=!0;for(let e=0;e<t["template-shadow"].length;e++)t.this.shadowRoot.appendChild(t["template-shadow"][e])}}else{if(0!==t["template-light"].length)for(let e in t["template-light"])t.this.appendChild(t["template-light"][e]);if(0!==t["template-shadow"].length){t.this.attachShadow({mode:"open"}),t.shadowRoot=!0;for(let e in t["template-shadow"])t.this.shadowRoot.appendChild(t["template-shadow"][e])}}r(t)})})}).catch(t=>t)})}function o(t,e){return new Promise(function(r,a){let n=!1;for(let e=0;e<document.querySelectorAll("script").length;e++)-1!==document.querySelectorAll("script")[e].src.indexOf(t.tagName.toLowerCase())&&(n=!0);if(!0===n)console.log("модуль загружен");else{const n=document.createElement("script");n.src=`/static/html/components/${t.tagName.toLowerCase()}/${t.tagName.toLowerCase()}.mjs`,n.type="module",n.setAttribute("async",""),n.onload=r,n.onerror=a,e.this.appendChild(n)}})}var i;e.push("component-id"),e.push("script"),e.push("component-action"),r.push("h1"),r.push("innerText"),a.push("shadowRoot"),a.push("head"),a.push("shadow"),a.push("light"),a.push("lightDom"),a.push("editor"),a.push("слайдер"),a.push("swap"),t.this=this,t["type-supported"]=r,(i=this,new Promise(function(t,e){let r=[];r.staticProperty=[],r.staticProperty.c=0,r.state=[],r.state.push("shadow"),r.state.push("light"),r.words=a,r.parent=!1,r["type-swap"]=!1,r["type-external"]=!1,r["document-offsetWidth"]=document.body.offsetWidth;let n=!1;if(r.getAttribute=((t,e,r)=>{if("template"===r){if(!t.getAttribute("type"))return t.setAttribute("type","default"),!1;for(let r=0;r<t.getAttribute("type").split("-").length;r++)t.getAttribute("type").split("-")[r]===e&&(n=!0);return n}if(t[`verify-${e}`]=!1,0===t.this.getAttribute("type").split("-").length)return!1;for(let r=0;r<t.this.getAttribute("type").split("-").length;r++)t.this.getAttribute("type").split("-")[r]===e?t[`verify-${e}`]=!0:t[`verify-${e}`]=!1;return console.assert(!1,t),t[`verify-${e}`]}),i.tagName.toLowerCase()&&(r.component=i.tagName.toLowerCase()),"object"!=typeof i);else{if(i.getAttribute("type")){r.type=i.getAttribute("type").split("-");for(let t=0;t<r.type.length;t++)r.type[t]=r.type[t].replace(/:/g,"-");for(let t in r.type)switch(r.type[t]){case"swap":r["type-swap"]=!0;break;case"external":r["type-external"]=!0}}else r.type=["default"],i.setAttribute("type","default");if(i.slot?r.slot=i.slot:(i.slot=i.tagName.toLowerCase(),r.slot=i.slot),i.getAttribute("type")){let t=!1;for(let e in i.getAttribute("type").split("-"))-1!==i.getAttribute("type").split("-")[e].indexOf("style:")&&(t=!0);r["style-custom"]=!0===t?"not-default":"default"}}r.shadowRoot=!1,r.this=i,t(r)})).then(t=>{n(t).then(t=>{(function(t){return new Promise(function(e,r){let a=document.createElement("style"),n=document.createElement("style"),o={};(o=t.slot?t.slot:t.parent)||console.assert(!1,"не установленны ни слот ни парент");for(let e=0;e<t.type.length;e++)"swap"===t.type[e]?"scoped"===t.type[e]&&a.setAttribute("scoped",""):"scoped"===t.type[e]&&n.setAttribute("scoped","");for(let r=0;r<t.state.length;r++){switch(t[`path-style-${t.state[r]}`]=`@import '/static/html/components/${t.component}/${t.state[r]}/${t.component}.css'; @import '/static/html/components/${t.component}/${t.state[r]}/${t.component}-custom.css';`,t.state[r]){case"shadow":!0===t.verify.preset&&(t[`path-style-${t.state[r]}-preset`]=`@import '/static/html/components/${t.component}/template/${o}.css';`),a.innerText=t[`path-style-${t.state[r]}`]+t[`path-style-${t.state[r]}-preset`];break;case"light":!0===t.verify.preset&&(t[`path-style-${t.state[r]}-preset`]=`@import '/static/html/components/${t.component}/template/${o}.css';`),n.innerText=t[`path-style-${t.state[r]}`]+t[`path-style-${t.state[r]}-preset`]}"swap"===t.state[r]?!0===t.shadowRoot?(t.this.shadowRoot.appendChild(n),t.this.appendChild(a),e(t)):t.this.appendChild(a):!0===t.shadowRoot?(t.this.shadowRoot.appendChild(a),t.this.appendChild(n),e(t)):t.this.appendChild(n)}e(t)})})(t).then(t=>{!async function(t){if(null===t.this.shadowRoot.querySelector("#image")){await store({input:"lacerta-moderator",this:t.this,obj:t,slot:t.slot,type:"obj"},"set","type");let e=await matcher.webdav({input:"varan-moderator",type:"list",data:{type:"moderator"},path:"/list"},"post","type");if(0===e.length);else{t.this.shadowRoot.querySelector(".main").innerHTML="";for(let r=0;r<e.length;r++){t.this.shadowRoot.querySelector(".main").insertAdjacentHTML("beforeend",e[r]);let a=t.this.shadowRoot.querySelector(`.item_${r}`),n=a.querySelector(".timestamp").innerText;n=+n,a.addEventListener("click",t=>{"/admin"===window.location.pathname||"/admin/"===window.location.pathname||"P"===t.target.tagName&&"SUMMARY"===t.target.parentNode.tagName||"SPAN"===t.target.tagName&&"P"===t.target.parentNode.tagName&&"SUMMARY"===t.target.parentNode.parentNode.tagName||"EM"===t.target.tagName&&"P"===t.target.parentNode.tagName||(t.preventDefault(),t.target.open=!1)}),a.querySelector(".delete").addEventListener("click",async e=>{let r=e.target,a=!1;for(;!a;)"DETAILS"===r.tagName&&r.className.indexOf("item")>-1?a=!0:r=r.parentNode;let n=r.querySelector(".timestamp").innerText;n=+n,await action({input:"lacerta-moderator",this:t.this,date:n,remove:r,type:"moderator"},"delete","type"),r.remove()}),a.querySelector(".change").addEventListener("click",async t=>{let e=t.target,r=!1;for(;!r;)"DETAILS"===e.tagName&&e.className.indexOf("item")>-1?r=!0:e=e.parentNode;let a=e.querySelector(".timestamp").innerText;a=+a;let n=await staticProperty({input:"action",type:"all"},"get","type");t.target.innerText="данные добавляются в редактор",t.target.disabled=!0;for(let t=0;t<n["varan-editor"].length;t++)switch(n["varan-editor"][t].slot){case"moderator":n["varan-editor"][t].obj.this.querySelector(".wall").innerHTML="",n["varan-editor"][t].obj.this.querySelector(".wall").insertAdjacentHTML("afterbegin",e.querySelector(".preview").innerHTML),n["varan-editor"][t].editor.quill.root.innerHTML="",n["varan-editor"][t].editor.quill.root.innerHTML=e.querySelector(".preview").innerHTML;let r={},a={};r=null===n["varan-editor"][t].obj.this.querySelector(".menu-convert")?(r=n["varan-editor"][t].obj.this.querySelector("varan-menu")).shadowRoot.querySelector(".menu-convert"):n["varan-editor"][t].obj.this.querySelector(".menu-convert"),null!==(a=null===n["varan-editor"][t].obj.this.querySelector(".update")?(a=n["varan-editor"][t].obj.this.querySelector("varan-menu")).shadowRoot.querySelector(".update"):n["varan-editor"][t].obj.this.querySelector(".update"))&&a.remove(),r.insertAdjacentHTML("afterend",'<button class="update" type="button">update</button>'),a=null===n["varan-editor"][t].obj.this.querySelector(".update")?(a=n["varan-editor"][t].obj.this.querySelector("varan-menu")).shadowRoot.querySelector(".update"):n["varan-editor"][t].obj.this.querySelector(".update"),addEventListener({input:"lacerta-moderator",type:"menu-update",data:a},"add","type");break;case"moderatorContent":n["varan-editor"][t].obj.this.querySelector(".wall").innerHTML="",n["varan-editor"][t].obj.this.querySelector(".wall").insertAdjacentHTML("afterbegin",e.querySelector(".content").innerHTML),n["varan-editor"][t].obj.this.querySelector(".ql-editor").innerHTML=e.querySelector(".content").innerHTML;let o={},i={};(o=null===n["varan-editor"][t].obj.this.querySelector(".menu-convert")?(o=n["varan-editor"][t].obj.this.querySelector("varan-menu")).shadowRoot.querySelector(".menu-convert"):n["varan-editor"][t].obj.this.querySelector(".menu-convert")).insertAdjacentHTML("afterend",'<button class="update" type="button">update</button>'),i=null===n["varan-editor"][t].obj.this.querySelector(".update")?(i=n["varan-editor"][t].obj.this.querySelector("varan-menu")).shadowRoot.querySelector(".update"):n["varan-editor"][t].obj.this.querySelector(".update"),addEventListener({input:"lacerta-moderator",type:"menu-update",data:i},"add","type")}for(let t=0;t<n["lacerta-moderator"].length;t++)switch(n["lacerta-moderator"][t].slot){case"moderator-admin":n["lacerta-moderator"][t].obj.this.shadowRoot.querySelector(".timestamp").innerText=e.querySelector(".timestamp").innerText,n["lacerta-moderator"][t].obj.this.shadowRoot.querySelector("#titleItem").value=e.querySelector("h2").innerText,n["lacerta-moderator"][t].obj.this.shadowRoot.querySelector(".moderator").src=e.querySelector(".moderator").src}t.target.innerText="данные в редакторе",t.target.disabled=!1})}}}else await store({input:"lacerta-moderator",this:t.this,obj:t,slot:t.slot,type:"obj",img:t.this.shadowRoot.querySelector(".moderator")},"set","type"),t.this.shadowRoot.querySelector("#image").onchange=function(e){let r=new CustomEvent("sideBarCrop",{detail:{id:t.component,slot:t.slot,file:e.target.files[0]}});document.dispatchEvent(r),e.target.value=""}}(t)})})})}});