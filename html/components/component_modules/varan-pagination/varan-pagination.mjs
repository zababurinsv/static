import modal from"/static/html/components/component_modules/varan-modal/varan-modal-1.0.mjs";import matcher from"/static/html/components/component_modules/matcher/matcher.mjs";import createObject from"/static/html/components/component_modules/varan-object/varan-object.mjs";Number.isNaN=Number.isNaN||function(e){return"number"==typeof e&&isNaN(e)};let count={};function colorLog(e,t,...n){switch(t=t||"black"){case"success":t="firebrick";break;case"info":t="DodgerBlue";break;case"error":t="Red";break;case"warning":t="Orange";break;case"events-out":t="blue";break;case"violet":t="violet"}console.log("%c"+e,"color:"+t,...n)}function pause(e){return new Promise(t=>{setTimeout(()=>{t(e)},100)})}count.staticProperty=0;let pagination={},object={},state={};pagination.func={},object.staticProperty={},state.staticProperty={},state.staticProperty=0,pagination.func.listener=function(e){e.pagination.btn_next&&e.pagination.btn_next.addEventListener("click",e=>{object.staticProperty.pagination.func.nextPage(object.staticProperty.pagination)}),e.pagination.btn_prev&&e.pagination.btn_prev.addEventListener("click",e=>{object.staticProperty.pagination.func.prevPage(object.staticProperty.pagination)})};let timeStamp=0;function init(e,t){e.paginationArguments={},e.paginationArguments.type={},e.paginationArguments.type.sliderNews=!1,e.paginationArguments.type.sliderText=!1,e.paginationArguments.type.blog=!1,colorLog("[->]pagination.init","firebrick",e,t);for(let t=0;t<e.type.length;t++)switch(e.type[t]){case"slider-news":e.paginationArguments.type.sliderNews=!0;break;case"blog":e.paginationArguments.type.blog=!0}if(!0===e.verify.sliderText&&(e.paginationArguments.numPage=1,e.paginationArguments.type.sliderText=!0),!t){let t={};t=e.slot?e.slot:e.parent,e.paginationArguments.numPage="varan-slider-news"===t?2:3}for(let t=0;t<e.type.length;t++)if(e.type[t].split("-").length>1)for(let n=0;n<e.type[t].split("-").length;n++)switch(e.type[t].split("-")[n]){case"blog":e.paginationArguments.type.blog=!0,e.paginationArguments.numPage=e.type[t].split("-")[1]}return e["slider-template"]?(e.paginationArguments.template=e["slider-template"],e.paginationArguments.slider=!0):(e.paginationArguments.slider=!1,e.paginationArguments.template=e.this.querySelector(".section")),e.paginationArguments.slot=e.slot,colorLog("[<-]pagination.init","firebrick",e.paginationArguments),e}async function action(e){colorLog("[->]pagination.action","SaddleBrown",e);let t=[],n={};if(e.pagination={},n=e.slot?e.slot:e.parent,e.get)if(void 0===e.get[n]){for(;!e.get;)console.warn("Ждём get pagination объект"),e=await pause(e);switch(n){case"varan-slider-news":for(let a in e.get[`${e.slot}`])t.push(e.get[n][a].feed);pagination.objJson=t[0];break;default:colorLog("[-]стандартное поведение","firebrick",n);for(let a in e.get[n])t.push(e.get[n][a]);pagination.objJson=t}console.assert(!1,"нет воходных данных")}else{switch(n){case"varan-slider-news":for(let a in e.get[`${e.slot}`])t.push(e.get[n][a].feed);pagination.objJson=t[0];break;default:colorLog("[-]стандартное поведение","firebrick",n);for(let a in e.get[n])t.push(e.get[n][a]);pagination.objJson=t}console.log("~~~~~~~~~~~pagination['objJson']~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",pagination.objJson)}else pagination.objJson=0;pagination.current_page=1,pagination.btn_next="",pagination.btn_prev="",pagination.page=1,pagination.numPages=1,pagination.numSlider=1,pagination.listing_table=e.paginationArguments.template,pagination.records_per_page=3,pagination.slider=e.paginationArguments.slider,e.hasOwnProperty("paginationArguments")?(e.paginationArguments.slot,colorLog("[->]default","SaddleBrown",e.paginationArguments.slot),!0===pagination.slider&&(pagination.listing_table=e.paginationArguments.template.querySelector(".peppermint"),pagination.listing_table_item=e.paginationArguments.template.querySelector(".ql-editor"))):console.assert(!1,"нет paginationArguments нужна инициализация"),pagination.type={},pagination.type.sliderNews=e.paginationArguments.type.sliderNews,pagination.type.sliderText=e.paginationArguments.type.sliderText,pagination.type.blog=e.paginationArguments.type.blog,pagination.type.default=!0;for(let t in e.paginationArguments.type)!0===e.paginationArguments.type[t]&&(pagination.type.default=!1);return pagination.records_per_page=e.paginationArguments.numPage,pagination.numSlider=e.paginationArguments.numSlide,pagination.slot=e.paginationArguments.slot,pagination.page_span="",pagination.btn_next=e.this.querySelector("#next"),pagination.btn_prev=e.this.querySelector("#prev"),pagination.page_span=e.this.querySelector(".page"),pagination.pagination=e.this.querySelector(".menu"),object.staticProperty={},e.pagination=pagination,object.staticProperty=e,object.staticProperty.pagination.func.listener(e),object.staticProperty.pagination.func.changePage(object.staticProperty.pagination),colorLog("[<-]pagination.action","SaddleBrown",e.pagination.listing_table),e}pagination.func.prevPage=function(e){timeStamp!==event.timeStamp&&(e.page>1&&(e.page--,e.func.changePage(e)),timeStamp=event.timeStamp)},pagination.func.nextPage=function(e){timeStamp!==event.timeStamp&&((e=e.func.numPages(e)).page<e.numPages&&(e.page++,e.func.changePage(e)),timeStamp=event.timeStamp)},pagination.func.numPages=function(e){return e.numPages=Math.ceil(e.objJson.length/e.records_per_page),e},pagination.func.changePage=async function(e){if(e.page<1&&(e.page=1),(e=e.func.numPages(e)).page>e.numPages&&(e.page=e.numPages),!0===(e=await createObject.init(e)).slider)for(let t in e.type)switch(t){case"sliderNews":if(!0===e.type[t]){e.numSlider=e.objJson.length,e.listing_table.innerHTML="",e.numSlider=e.numPages;for(let t=1;t<e.numSlider+1;t++){let n=document.createElement("section");n.className=e.listing_table_item.className,n.setAttribute("page",`${t}`);for(let t=(e.page-1)*e.records_per_page;t<e.page*e.records_per_page&&t<e.objJson.length;t++)e.object=e.objJson[t],n.appendChild(e.$create(e)),e.listing_table.appendChild(n);e.page++}let t=document.createElement("style");t.setAttribute("scoped",""),t.innerText="@import '/static/html/components/varan-news/shadow/varan-news.css';",e.listing_table.appendChild(t)}break;case"sliderText":if(!0===e.type[t]){e.numSlider=e.objJson.length,e.listing_table.innerHTML="";for(let t=1;t<e.numSlider+1;t++){let n=document.createElement("section");e.numSlider>1?n.className=`ql-editor ${e.slot}`:n.className=e.listing_table_item.className,n.setAttribute("page",`${t}`),colorLog(`<${e.slot}-out> object['$create'] </${e.slot}-out>`,"firebrick"),n.innerHTML=e.objJson[t-1].content,e.listing_table.appendChild(n)}}break;default:if(!0===e.type[t]){e.numSlider=e.objJson.length,e.listing_table.innerHTML="",e.numSlider=e.numPages;for(let t=1;t<e.numSlider+1;t++){let n=document.createElement("section");n.className=e.listing_table_item.className,n.setAttribute("page",`${t}`);for(let t=(e.page-1)*e.records_per_page;t<e.page*e.records_per_page&&t<e.objJson.length;t++)e.object=e.objJson[t],n.appendChild(e.$create(e)),e.listing_table.appendChild(n);e.page++}colorLog("[-]~~~~~~default~~pagination~~~~~~","firebrick",t)}}else for(let t in e.type)switch(t){case"blog":if(e.listing_table.innerHTML="",!0===e.type[t])for(let t=(e.page-1)*e.records_per_page;t<e.page*e.records_per_page&&t<e.objJson.length;t++)e.object=e.objJson[t],e.listing_table.appendChild(e.$create(e));break;default:if(!0===e.type[t]){e.listing_table.innerHTML="";for(let t=(e.page-1)*e.records_per_page;t<e.page*e.records_per_page&&t<e.objJson.length;t++)e.object=e.objJson[t],e.listing_table.appendChild(e.$create(e));if("varan-slider-news"===e.slot){console.assert(!0,e.listing_table);let t=document.createElement("style");t.setAttribute("scoped",""),t.innerText="@import '/static/html/components/varan-news/shadow/varan-news.css';",e.listing_table.appendChild(t)}}}for(let e=0;e<object.staticProperty.pagination.listing_table.children.length;e++)object.staticProperty.pagination.listing_table.children[e].addEventListener("click",e=>{if("BUTTON"===e.target.tagName)if("удалить"===e.target.innerText.toLowerCase()){if(!0===confirm("Вы точно хотите удалить файл ?")){let t={};t.id=e.target.id,t.component=e.target.getAttribute("class"),object.staticProperty.delObj=t,matcher.database.request.functions.delImages(object.staticProperty).then(t=>{for(let n=0;n<t.this.querySelector(".section").children.length;n++)e.target.id===t.this.querySelector(".section").children[n].id&&t.this.querySelector(".section").removeChild(t.this.querySelector(".section").children[n]);t.mongo=null,action(t)})}}else if(e.target.className.split(":").length>1){if("activeitem"===e.target.className.split(":")[1].toLowerCase())if("добавить"===e.target.innerText.toLowerCase()){e.target.innerText="убрать";let t=new CustomEvent("activeItem",{detail:{id:e.target.id,object:e.target.className.split(":")[0],status:!0}});document.dispatchEvent(t)}else{e.target.innerText="добавить";let t=new CustomEvent("activeItem",{detail:{id:e.target.id,object:e.target.className.split(":")[0],status:!1}});document.dispatchEvent(t)}}else{let t={};t.id=e.target.id,t.component=e.target.getAttribute("class"),object.staticProperty.upload=t,matcher.database.request.functions.getImageById(object.staticProperty).then(e=>{e.upload.url=e.upload["file-url"],e.namespace={},e.namespace.modal=e.this.querySelector(".modal"),e.this.querySelector(".modal").style.display="block",modal.init(e).then(e=>{matcher.external.func.crop.cropUrl(e).then(e=>{colorLog("~~~~~~~~~~~<varan-pagination-update>~~~~~~~~~~~","firebrick");let t={};t=e.slot?"edit"===e.slot?e.parent:"view"===e.slot?e.parent:e.slot:e.parent;let n=e.upload;e.upload={},e.upload[t]=n,e.upload.object=t,e.upload.id=n.id,matcher.database.request.functions.updImage(e).then(e=>{e.this.querySelector(".modal").style.display="none",matcher.database.request.functions.getObject(e).then(e=>{action(e)}),console.log("~~~~pagination~~update~~~~~~~~~~",e)})})})})}});!0===Number.isNaN(e.numPages)?e.pagination.style.display="none":e.pagination.style.display="flex",e.page_span&&(e.page_span.innerHTML=e.page+"/"+e.numPages,e.page_span.style.visibility="visible",1===e.page?e.btn_prev.style.visibility="hidden":e.btn_prev.style.visibility="visible",e.page===e.numPages?e.btn_next.style.visibility="hidden":e.btn_next.style.visibility="visible")};export default{init:e=>init(e),action:e=>action(e)};