import matcher from"/static/html/components/component_modules/matcher/matcher.mjs";import utils from"/static/html/components/component_modules/utils/utils.mjs";import staticProperty from"/static/html/components/component_modules/staticProperty/staticProperty.mjs";import addEventListener from"/static/html/components/component_modules/addEventListener/addEventListener.mjs";import events from"/static/html/components/component_modules/customEvent/callback.mjs";(async()=>{bundle.default({input:"object"},null,async function(e,t){function r(e){o.staticProperty=e,r=function(e){return e}}events();let o={staticProperty:0};for(let e=0;e<t.store["varan-menu"].length;e++){let a=(e,t)=>"VARAN-EDITOR"===e.tagName,n=(e,t)=>e.slot===t,i=function(e){r(e.timeStamp);let t=e.timeStamp-o.staticProperty;if(t>140||0===t){e.target.disable="true",e.target.style.backgroundColor="#62bcd7";let t=e.target,r=!1;for(;!r;)void 0!==(t=t.parentNode).tagName&&"undefined"!==t.tagName||(t=t.getRootNode().host),r=a(t,"varan-editor");let o=new CustomEvent("saveEditor",{detail:{id:t.slot}});document.dispatchEvent(o),setTimeout(function(){e.target.disable="false",e.target.style.backgroundColor="#ccc"},3e3)}o.staticProperty=e.timeStamp},s=async function(e){r(e.timeStamp);let i=e.timeStamp-o.staticProperty;if(i>140||0===i){e.target.disable="true",e.target.style.backgroundColor="#62bcd7";let r=e.target,o=!1;for(;!o;)void 0!==(r=r.parentNode).tagName&&"undefined"!==r.tagName||(r=r.getRootNode().host),o=a(r,"varan-editor");let i=await staticProperty({input:"action",type:"all"},"get","type"),s={moderator:{},news:{}},l={},c={},u={};for(let e=0;e<i["varan-editor"].length;e++)switch(i["varan-editor"][e].slot){case"description":s.news.description=await utils({input:"varan-menu",data:i["varan-editor"][e].editor.quill.root.innerHTML,type:"html2string"},"convert","type"),u.description=i["varan-editor"][e].editor.quill.root.innerHTML,i["varan-editor"][e].obj.this.querySelector(".wall").innerHTML="",i["varan-editor"][e].editor.quill.root.innerHTML="";break;case"content":s.news.content=await utils({input:"varan-menu",data:i["varan-editor"][e].editor.quill.root.innerHTML,type:"html2string"},"convert","type"),u.content=i["varan-editor"][e].editor.quill.root.innerHTML,i["varan-editor"][e].obj.this.querySelector(".wall").innerHTML="",i["varan-editor"][e].editor.quill.root.innerHTML="";break;case"about":s.about=await utils({input:"varan-menu",data:i["varan-editor"][e].editor.quill.root.innerHTML,type:"html2string"},"convert","type"),l=i["varan-editor"][e].editor.quill.root.innerHTML;break;case"moderator":s.moderator.description=await utils({input:"varan-menu",data:i["varan-editor"][e].editor.quill.root.innerHTML,type:"html2string"},"convert","type"),c.description=i["varan-editor"][e].editor.quill.root.innerHTML;break;case"moderatorContent":s.moderator.content=await utils({input:"varan-menu",data:i["varan-editor"][e].editor.quill.root.innerHTML,type:"html2string"},"convert","type"),c.content=i["varan-editor"][e].editor.quill.root.innerHTML;break;default:console.warn("~~~~~~~~~","На этот объект нет действия ",i["varan-editor"][e].slot)}let d={},m={},v={},y={},p={},h={},b={},w={},g={};switch(r.slot){case"about":g="about";break;case"moderator":case"moderatorContent":g="moderator";break;case"content":case"description":g="news";break;default:g=r.slot,console.warn("необрабатываемый тип",r.slot)}switch(g){case"about":let e=await utils({input:"varan-menu",data:l,type:"html2string"},"convert","type");for(let r=0;r<t.store["varan-about"].length;r++)switch(t.store["varan-about"][r].slot){case"about-admin":let o={};if(null===t.store["varan-about"][r].obj.this.querySelector(".menu-convert")){let e=t.store["varan-about"][r].obj.this.querySelector("varan-menu");o=e.shadowRoot.querySelector(".menu-convert")}else o=t.store["varan-about"][r].obj.this.querySelector(".menu-convert");o.innerText="Идёт сохранение данных.",o.disabled=!0,o.style.backgroundColor="red";let a=await matcher.webdav({input:"varan-menu",data:{txt:e},type:"about",path:"/about"},"set","type"),n=await utils({input:"varan-menu",target:"varan-about",type:"object",source:t.store["varan-about"],get:".main"},"get","type");n.innerHTML="",n.insertAdjacentHTML("beforeend",a),o.innerText="Данные сохранены",setTimeout(()=>{o.innerText="сохранить",o.disabled=!1,o.style.backgroundColor="#ccc"},2e3)}break;case"moderator":for(o=!1,d={};!o;)d=r.parentNode,o=n(d,r.getAttribute("parent"));m={},v=d.shadowRoot.querySelector("#titleItem").value;let a={};t.isEmpty(v)?"введите Имя и Фамилию  автора"===(a=prompt("введите Имя и Фамилию  автора","введите Имя и Фамилию  автора"))?(alert("вы не ввели имя автора поле остаётся пустым"),m="модератор"):m=a:m=v,Date.now||(Date.now=function(){return(new Date).getTime()}),y=Date.now(),(p={}).timestamp=y,p.title=m,p.img=d.shadowRoot.querySelector(".moderator").src,p.description=s.moderator.description,p.content=s.moderator.content,p.dir="moderator",p.positionImg=confirm("Фотографию разположить слева ?");let i={},c={},u={},q={};for(let e=0;e<t.store["varan-editor"].length;e++)switch(t.store["varan-editor"][e].slot){case"moderator":case"moderatorContent":i=(q=t.store["varan-editor"][e].obj.this.querySelector("varan-menu").shadowRoot&&void 0!==t.store["varan-editor"][e].obj.this.querySelector("varan-menu").shadowRoot&&null!==t.store["varan-editor"][e].obj.this.querySelector("varan-menu").shadowRoot?t.store["varan-editor"][e].obj.this.querySelector("varan-menu").shadowRoot:t.store["varan-editor"][e].obj.this.querySelector("varan-menu")).querySelector(".menu-convert"),c=q.querySelectorAll(".menu-save")[0],null===(u=q.querySelector(".update"))||"null"===u||u.remove(),i.innerHTML="создаётся модератор",i.style.backgroundColor="#e1e1e1",i.disabled=!0,c.disabled=!0}w=await utils({input:"varan-menu",target:"lacerta-moderator",type:"object",source:t.store["lacerta-moderator"],get:".main"},"get","type"),h=await matcher.webdav({input:"varan-menu",data:p,type:"components",name:"moderator",path:"/components"},"set","type",w.querySelectorAll(".adminMenu").length);let S=w.querySelectorAll(".adminMenu").length;b=await utils({input:"varan-menu",target:"moderator-admin",type:"object",source:t.store["lacerta-moderator"],get:".adminContent"},"get","type");for(let e=0;e<h.length;e++){w.insertAdjacentHTML("beforeend",h[e]),w.querySelector(`.item_${w.querySelectorAll(".adminMenu").length}`),console.log(S);let t=w.querySelector(`.item_${S}`);await addEventListener({input:"varan-menu",delete:t.querySelector(".delete"),change:t.querySelector(".change"),type:"lacerta-moderator"},"add","type")}for(let e=0;e<t.store["varan-editor"].length;e++)switch(t.store["varan-editor"][e].slot){case"moderator":i=(q=t.store["varan-editor"][e].obj.this.querySelector("varan-menu").shadowRoot&&void 0!==t.store["varan-editor"][e].obj.this.querySelector("varan-menu").shadowRoot&&null!==t.store["varan-editor"][e].obj.this.querySelector("varan-menu").shadowRoot?t.store["varan-editor"][e].obj.this.querySelector("varan-menu").shadowRoot:t.store["varan-editor"][e].obj.this.querySelector("varan-menu")).querySelector(".menu-convert"),c=q.querySelectorAll(".menu-save")[0],null===(u=q.querySelector(".update"))||"null"===u||u.remove(),i.innerHTML="модератор создан",location.reload();break;case"moderatorContent":i=(q=t.store["varan-editor"][e].obj.this.querySelector("varan-menu").shadowRoot&&void 0!==t.store["varan-editor"][e].obj.this.querySelector("varan-menu").shadowRoot&&null!==t.store["varan-editor"][e].obj.this.querySelector("varan-menu").shadowRoot?t.store["varan-editor"][e].obj.this.querySelector("varan-menu").shadowRoot:t.store["varan-editor"][e].obj.this.querySelector("varan-menu")).querySelector(".menu-convert"),c=q.querySelectorAll(".menu-save")[0],null===(u=q.querySelector(".update"))||"null"===u||u.remove(),i.innerHTML="модератор создан",i.style.backgroundColor="red",i.disabled=!1,c.disabled=!1}break;case"news":let f=t.store["varan-editor-admin"][0].this.querySelector("lacerta-news"),j=f.shadowRoot.querySelector("#titleItem").value,k=f.shadowRoot.querySelector(".gallery").src,T="image";0===j.length&&(j="Новость"),Date.now||(Date.now=function(){return(new Date).getTime()});let L={image:{}};L.image.data=k,L.image.name=T,L.title=j,L.content=s.news.content,L.short_content=s.news.description,L.url="https://universitykids.ru",L.rss="https://universitykids.ru/rss",L.timestamp=Date.now();for(let e=0;e<t.store["lacerta-news"].length;e++)switch(t.store["lacerta-news"][e].slot){case"news-admin":t.store["lacerta-news"][e].obj.this.shadowRoot.querySelector("#titleItem").value="",t.store["lacerta-news"][e].obj.this.shadowRoot.querySelector(".date").innerHTML="",t.store["lacerta-news"][e].obj.this.shadowRoot.querySelector(".gallery").src="/static/html/components/lacerta-news/icons/no_image.jpg",t.isEmpty(t.store.action)&&(t.store.action={}),t.isEmpty(t.store.action.create)&&(t.store.action.create={}),t.store.action.create=!0;let r=t.store["lacerta-news"][e].obj.this.querySelectorAll("varan-menu"),o={},a={},n={},i={};for(let e=0;e<r.length;e++)a=(o=void 0===r[e].shadowRoot||null===r[e].shadowRoot?r[e]:r[e].shadowRoot).querySelector(".menu-convert"),n=o.querySelector(".menu-save"),null===(i=o.querySelector(".update"))||"null"===i||i.remove(),a.innerText="Создаётся новость. Страница сама перезагрузится",a.style.backgroundColor="red",a.disabled=!0,n.disabled=!0;break;default:console.warn("~~~~~~~~~","На этот объект нет действия ",t.store["lacerta-news"][e].slot)}staticProperty({type:"task",task:{type:"create",data:L}},"task","type");break;default:console.assert(!1,g)}setTimeout(function(){e.target.disable="false",e.target.style.backgroundColor="#ccc"},3e3)}o.staticProperty=e.timeStamp};t.store["varan-menu"][e].this.querySelector(".menu-save")?(t.store["varan-menu"][e].this.querySelector(".menu-save").addEventListener("click",i,!1),t.store["varan-menu"][e].this.querySelector(".menu-convert").addEventListener("click",s,!1)):(t.store["varan-menu"][e].this.shadowRoot.querySelector(".menu-save").addEventListener("click",i,!1),t.store["varan-menu"][e].this.shadowRoot.querySelector(".menu-convert").addEventListener("click",s,!1))}})})();