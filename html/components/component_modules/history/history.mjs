import _extends from"@babel/runtime/helpers/esm/extends";import resolvePathname from"resolve-pathname";import valueEqual from"value-equal";import warning from"tiny-warning";import invariant from"tiny-invariant";function addLeadingSlash(t){return"/"===t.charAt(0)?t:"/"+t}function stripLeadingSlash(t){return"/"===t.charAt(0)?t.substr(1):t}function hasBasename(t,n){return 0===t.toLowerCase().indexOf(n.toLowerCase())&&-1!=="/?#".indexOf(t.charAt(n.length))}function stripBasename(t,n){return hasBasename(t,n)?t.substr(n.length):t}function stripTrailingSlash(t){return"/"===t.charAt(t.length-1)?t.slice(0,-1):t}function parsePath(t){var n=t||"/",e="",a="",o=n.indexOf("#");-1!==o&&(a=n.substr(o),n=n.substr(0,o));var i=n.indexOf("?");return-1!==i&&(e=n.substr(i),n=n.substr(0,i)),{pathname:n,search:"?"===e?"":e,hash:"#"===a?"":a}}function createPath(t){var n=t.pathname,e=t.search,a=t.hash,o=n||"/";return e&&"?"!==e&&(o+="?"===e.charAt(0)?e:"?"+e),a&&"#"!==a&&(o+="#"===a.charAt(0)?a:"#"+a),o}function createLocation(t,n,e,a){var o;"string"==typeof t?(o=parsePath(t)).state=n:(void 0===(o=_extends({},t)).pathname&&(o.pathname=""),o.search?"?"!==o.search.charAt(0)&&(o.search="?"+o.search):o.search="",o.hash?"#"!==o.hash.charAt(0)&&(o.hash="#"+o.hash):o.hash="",void 0!==n&&void 0===o.state&&(o.state=n));try{o.pathname=decodeURI(o.pathname)}catch(t){throw t instanceof URIError?new URIError('Pathname "'+o.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):t}return e&&(o.key=e),a?o.pathname?"/"!==o.pathname.charAt(0)&&(o.pathname=resolvePathname(o.pathname,a.pathname)):o.pathname=a.pathname:o.pathname||(o.pathname="/"),o}function locationsAreEqual(t,n){return t.pathname===n.pathname&&t.search===n.search&&t.hash===n.hash&&t.key===n.key&&valueEqual(t.state,n.state)}function createTransitionManager(){var t=null;var n=[];return{setPrompt:function(n){return"production"!==process.env.NODE_ENV&&warning(null==t,"A history supports only one prompt at a time"),t=n,function(){t===n&&(t=null)}},confirmTransitionTo:function(n,e,a,o){if(null!=t){var i="function"==typeof t?t(n,e):t;"string"==typeof i?"function"==typeof a?a(i,o):("production"!==process.env.NODE_ENV&&warning(!1,"A history needs a getUserConfirmation function in order to use a prompt message"),o(!0)):o(!1!==i)}else o(!0)},appendListener:function(t){var e=!0;function a(){e&&t.apply(void 0,arguments)}return n.push(a),function(){e=!1,n=n.filter(function(t){return t!==a})}},notifyListeners:function(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];n.forEach(function(t){return t.apply(void 0,e)})}}}var canUseDOM=!("undefined"==typeof window||!window.document||!window.document.createElement);function getConfirmation(t,n){n(window.confirm(t))}function supportsHistory(){var t=window.navigator.userAgent;return(-1===t.indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)}function supportsPopStateOnHashChange(){return-1===window.navigator.userAgent.indexOf("Trident")}function supportsGoWithoutReloadUsingHash(){return-1===window.navigator.userAgent.indexOf("Firefox")}function isExtraneousPopstateEvent(t){return void 0===t.state&&-1===navigator.userAgent.indexOf("CriOS")}var PopStateEvent="popstate",HashChangeEvent="hashchange";function getHistoryState(){try{return window.history.state||{}}catch(t){return{}}}function createBrowserHistory(t){void 0===t&&(t={}),canUseDOM||("production"!==process.env.NODE_ENV?invariant(!1,"Browser history needs a DOM"):invariant(!1));var n=window.history,e=supportsHistory(),a=!supportsPopStateOnHashChange(),o=t,i=o.forceRefresh,r=void 0!==i&&i,s=o.getUserConfirmation,c=void 0===s?getConfirmation:s,h=o.keyLength,u=void 0===h?6:h,d=t.basename?stripTrailingSlash(addLeadingSlash(t.basename)):"";function f(t){var n=t||{},e=n.key,a=n.state,o=window.location,i=o.pathname+o.search+o.hash;return"production"!==process.env.NODE_ENV&&warning(!d||hasBasename(i,d),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+i+'" to begin with "'+d+'".'),d&&(i=stripBasename(i,d)),createLocation(i,a,e)}function l(){return Math.random().toString(36).substr(2,u)}var p=createTransitionManager();function v(t){_extends(S,t),S.length=n.length,p.notifyListeners(S.location,S.action)}function g(t){isExtraneousPopstateEvent(t)||P(f(t.state))}function m(){P(f(getHistoryState()))}var w=!1;function P(t){if(w)w=!1,v();else{p.confirmTransitionTo(t,"POP",c,function(n){n?v({action:"POP",location:t}):function(t){var n=S.location,e=E.indexOf(n.key);-1===e&&(e=0);var a=E.indexOf(t.key);-1===a&&(a=0);var o=e-a;o&&(w=!0,O(o))}(t)})}}var y=f(getHistoryState()),E=[y.key];function H(t){return d+createPath(t)}function O(t){n.go(t)}var L=0;function b(t){1===(L+=t)&&1===t?(window.addEventListener(PopStateEvent,g),a&&window.addEventListener(HashChangeEvent,m)):0===L&&(window.removeEventListener(PopStateEvent,g),a&&window.removeEventListener(HashChangeEvent,m))}var x=!1;var S={length:n.length,action:"POP",location:y,createHref:H,push:function(t,a){"production"!==process.env.NODE_ENV&&warning(!("object"==typeof t&&void 0!==t.state&&void 0!==a),"You should avoid providing a 2nd state argument to push when the 1st argument is a location-like object that already has state; it is ignored");var o=createLocation(t,a,l(),S.location);p.confirmTransitionTo(o,"PUSH",c,function(t){if(t){var a=H(o),i=o.key,s=o.state;if(e)if(n.pushState({key:i,state:s},null,a),r)window.location.href=a;else{var c=E.indexOf(S.location.key),h=E.slice(0,c+1);h.push(o.key),E=h,v({action:"PUSH",location:o})}else"production"!==process.env.NODE_ENV&&warning(void 0===s,"Browser history cannot push state in browsers that do not support HTML5 history"),window.location.href=a}})},replace:function(t,a){"production"!==process.env.NODE_ENV&&warning(!("object"==typeof t&&void 0!==t.state&&void 0!==a),"You should avoid providing a 2nd state argument to replace when the 1st argument is a location-like object that already has state; it is ignored");var o=createLocation(t,a,l(),S.location);p.confirmTransitionTo(o,"REPLACE",c,function(t){if(t){var a=H(o),i=o.key,s=o.state;if(e)if(n.replaceState({key:i,state:s},null,a),r)window.location.replace(a);else{var c=E.indexOf(S.location.key);-1!==c&&(E[c]=o.key),v({action:"REPLACE",location:o})}else"production"!==process.env.NODE_ENV&&warning(void 0===s,"Browser history cannot replace state in browsers that do not support HTML5 history"),window.location.replace(a)}})},go:O,goBack:function(){O(-1)},goForward:function(){O(1)},block:function(t){void 0===t&&(t=!1);var n=p.setPrompt(t);return x||(b(1),x=!0),function(){return x&&(x=!1,b(-1)),n()}},listen:function(t){var n=p.appendListener(t);return b(1),function(){b(-1),n()}}};return S}var HashChangeEvent$1="hashchange",HashPathCoders={hashbang:{encodePath:function(t){return"!"===t.charAt(0)?t:"!/"+stripLeadingSlash(t)},decodePath:function(t){return"!"===t.charAt(0)?t.substr(1):t}},noslash:{encodePath:stripLeadingSlash,decodePath:addLeadingSlash},slash:{encodePath:addLeadingSlash,decodePath:addLeadingSlash}};function stripHash(t){var n=t.indexOf("#");return-1===n?t:t.slice(0,n)}function getHashPath(){var t=window.location.href,n=t.indexOf("#");return-1===n?"":t.substring(n+1)}function pushHashPath(t){window.location.hash=t}function replaceHashPath(t){window.location.replace(stripHash(window.location.href)+"#"+t)}function createHashHistory(t){void 0===t&&(t={}),canUseDOM||("production"!==process.env.NODE_ENV?invariant(!1,"Hash history needs a DOM"):invariant(!1));var n=window.history,e=supportsGoWithoutReloadUsingHash(),a=t,o=a.getUserConfirmation,i=void 0===o?getConfirmation:o,r=a.hashType,s=void 0===r?"slash":r,c=t.basename?stripTrailingSlash(addLeadingSlash(t.basename)):"",h=HashPathCoders[s],u=h.encodePath,d=h.decodePath;function f(){var t=d(getHashPath());return"production"!==process.env.NODE_ENV&&warning(!c||hasBasename(t,c),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+t+'" to begin with "'+c+'".'),c&&(t=stripBasename(t,c)),createLocation(t)}var l=createTransitionManager();function p(t){_extends(x,t),x.length=n.length,l.notifyListeners(x.location,x.action)}var v=!1,g=null;function m(){var t,n,e=getHashPath(),a=u(e);if(e!==a)replaceHashPath(a);else{var o=f(),r=x.location;if(!v&&(n=o,(t=r).pathname===n.pathname&&t.search===n.search&&t.hash===n.hash))return;if(g===createPath(o))return;g=null,function(t){if(v)v=!1,p();else{l.confirmTransitionTo(t,"POP",i,function(n){n?p({action:"POP",location:t}):function(t){var n=x.location,e=E.lastIndexOf(createPath(n));-1===e&&(e=0);var a=E.lastIndexOf(createPath(t));-1===a&&(a=0);var o=e-a;o&&(v=!0,H(o))}(t)})}}(o)}}var w=getHashPath(),P=u(w);w!==P&&replaceHashPath(P);var y=f(),E=[createPath(y)];function H(t){"production"!==process.env.NODE_ENV&&warning(e,"Hash history go(n) causes a full page reload in this browser"),n.go(t)}var O=0;function L(t){1===(O+=t)&&1===t?window.addEventListener(HashChangeEvent$1,m):0===O&&window.removeEventListener(HashChangeEvent$1,m)}var b=!1;var x={length:n.length,action:"POP",location:y,createHref:function(t){var n=document.querySelector("base"),e="";return n&&n.getAttribute("href")&&(e=stripHash(window.location.href)),e+"#"+u(c+createPath(t))},push:function(t,n){"production"!==process.env.NODE_ENV&&warning(void 0===n,"Hash history cannot push state; it is ignored");var e=createLocation(t,void 0,void 0,x.location);l.confirmTransitionTo(e,"PUSH",i,function(t){if(t){var n=createPath(e),a=u(c+n);if(getHashPath()!==a){g=n,pushHashPath(a);var o=E.lastIndexOf(createPath(x.location)),i=E.slice(0,o+1);i.push(n),E=i,p({action:"PUSH",location:e})}else"production"!==process.env.NODE_ENV&&warning(!1,"Hash history cannot PUSH the same path; a new entry will not be added to the history stack"),p()}})},replace:function(t,n){"production"!==process.env.NODE_ENV&&warning(void 0===n,"Hash history cannot replace state; it is ignored");var e=createLocation(t,void 0,void 0,x.location);l.confirmTransitionTo(e,"REPLACE",i,function(t){if(t){var n=createPath(e),a=u(c+n);getHashPath()!==a&&(g=n,replaceHashPath(a));var o=E.indexOf(createPath(x.location));-1!==o&&(E[o]=n),p({action:"REPLACE",location:e})}})},go:H,goBack:function(){H(-1)},goForward:function(){H(1)},block:function(t){void 0===t&&(t=!1);var n=l.setPrompt(t);return b||(L(1),b=!0),function(){return b&&(b=!1,L(-1)),n()}},listen:function(t){var n=l.appendListener(t);return L(1),function(){L(-1),n()}}};return x}function clamp(t,n,e){return Math.min(Math.max(t,n),e)}function createMemoryHistory(t){void 0===t&&(t={});var n=t,e=n.getUserConfirmation,a=n.initialEntries,o=void 0===a?["/"]:a,i=n.initialIndex,r=void 0===i?0:i,s=n.keyLength,c=void 0===s?6:s,h=createTransitionManager();function u(t){_extends(g,t),g.length=g.entries.length,h.notifyListeners(g.location,g.action)}function d(){return Math.random().toString(36).substr(2,c)}var f=clamp(r,0,o.length-1),l=o.map(function(t){return createLocation(t,void 0,"string"==typeof t?d():t.key||d())}),p=createPath;function v(t){var n=clamp(g.index+t,0,g.entries.length-1),a=g.entries[n];h.confirmTransitionTo(a,"POP",e,function(t){t?u({action:"POP",location:a,index:n}):u()})}var g={length:l.length,action:"POP",location:l[f],index:f,entries:l,createHref:p,push:function(t,n){"production"!==process.env.NODE_ENV&&warning(!("object"==typeof t&&void 0!==t.state&&void 0!==n),"You should avoid providing a 2nd state argument to push when the 1st argument is a location-like object that already has state; it is ignored");var a=createLocation(t,n,d(),g.location);h.confirmTransitionTo(a,"PUSH",e,function(t){if(t){var n=g.index+1,e=g.entries.slice(0);e.length>n?e.splice(n,e.length-n,a):e.push(a),u({action:"PUSH",location:a,index:n,entries:e})}})},replace:function(t,n){"production"!==process.env.NODE_ENV&&warning(!("object"==typeof t&&void 0!==t.state&&void 0!==n),"You should avoid providing a 2nd state argument to replace when the 1st argument is a location-like object that already has state; it is ignored");var a=createLocation(t,n,d(),g.location);h.confirmTransitionTo(a,"REPLACE",e,function(t){t&&(g.entries[g.index]=a,u({action:"REPLACE",location:a}))})},go:v,goBack:function(){v(-1)},goForward:function(){v(1)},canGo:function(t){var n=g.index+t;return n>=0&&n<g.entries.length},block:function(t){return void 0===t&&(t=!1),h.setPrompt(t)},listen:function(t){return h.appendListener(t)}};return g}export{createBrowserHistory,createHashHistory,createMemoryHistory,createLocation,locationsAreEqual,parsePath,createPath};