"use strict";import database from"/static/html/components/component_modules/matcher/matcher/database.mjs";import draggable from"/static/html/components/component_modules/crop/this/varan-crop-tool/utils/draggable.mjs";import movePos from"/static/html/components/component_modules/crop/this/varan-crop-tool/utils/cropMove.mjs";import crop from"/static/html/components/component_modules/crop/crop.mjs";import convert from"/static/html/components/component_modules/convert/convert.mjs";import webdav from"/static/html/components/component_modules/matcher/matcher/this/database/wabdav/webdav.mjs";const dragEle=[".c-crop--drap_eline",".c-crop--drap_sline",".c-crop--drap_wline",".c-crop--drap_nline",".c-crop--drap_e",".c-crop--drap_s",".c-crop--drap_w",".c-crop--drap_n",".c-crop--drap_ne",".c-crop--drap_se",".c-crop--drap_sw",".c-crop--drap_nw"];import store from"/static/html/components/component_modules/staticProperty/staticProperty.mjs";import mongo from"/static/html/components/component_modules/matcher/matcher/mongoDb.mjs";import action from"/static/html/components/component_modules/action/action.mjs";import email from"/static/html/components/component_modules/matcher/matcher/this/database/mail/mail.mjs";import server from"/static/html/components/component_modules/matcher/matcher/this/database/server/server.mjs";import config from"/static/html/components/component_modules/matcher/matcher/this/database/config/index.mjs";import bundle from"/static/html/components/component_modules/bundle/matcher.mjs";function dom(){}function colorLog(t,o,...r){switch(o=o||"black"){case"success":o="Green";break;case"info":o="DodgerBlue";break;case"error":o="Red";break;case"warning":o="Orange"}console.log("%c"+t,"color:"+o,...r)}function downloadURI(t,o){var r=document.createElement("a");r.download=o,r.href=t,r.click()}let external=[];external.func=[],external.func.crop=[],external.func.afterCrop=function(t){};let init=async function(t){dom.staticProperty=t.this,t.crop={};for(let o in crop.crop)t.crop[`${o}`]=crop.crop[`${o}`];t.crop.func.tool={};for(let o in external.func)t.crop.func.tool[`${o}`]=external.func[o];return t.crop.func.convert=await convert.init(),t.crop.this.height=0,t.crop.this.top=0,t.crop.this.left=0,t.crop.this.width=0,t.crop.this.marginTop=0,t.crop.this.marginLeft=0,t.crop.this.startPos=[0,0],t.crop.this.cropTimer=null,t.crop.this.startSize=null,t.crop.this.url=t.upload.url,t.crop.this.previewJson=[{width:0,height:0}],t.crop.watch.previewJson=[{width:0,height:0}],t.crop.watch.convert=await convert.init(t),t.crop.watch=proxy(t.crop.watch),t.crop.watch.updateSize=t.crop.func.updateSize,t.crop.watch["c-preview"]=t.crop.func["c-preview"],t.crop.watch.elWidth=0,t.crop.watch.elHeight=0,t.crop.watch.cursorTop=0,t.crop.watch.cursorLeft=0,t.crop.watch.left=0,t.crop.watch.top=0,t.crop.watch.end=!1,t.crop.watch.startPos=0,t.crop.watch.scale=t.crop.this.scale,t.crop.watch.originImgSize=0,t.crop.watch.previewImgSize=0,t.crop.func.tool.style(t),t};const handler={get:function(t,o){return t[o]},set:function(t,o,r){return t[o]=r,"c-crop--area"in t==!1||"updateSize"in t==!1||"previewImgSize"in t==!1||"c-crop--cut"in t==!1||"cursorLeft"in t==!1||"cursorTop"in t==!1||"cut"in t==!1||"elHeight"in t==!1||"elWidth"in t==!1||"height"in t==!1||"imgH"in t==!1||"imgW"in t==!1||"end"in t==!1||"width"in t==!1||!0===t.end&&("end"===o||t.updateSize(t,dom.staticProperty)),t}};function proxy(t){return t=new Proxy(t,handler)}external.func.style=function(t){console.log(`{a[*'style'])t-${t}`,t),dom.staticProperty.querySelector(".c-crop--area").style.display="block";let o=getComputedStyle(dom.staticProperty.querySelector(".c-crop--preview"),"width").width;return o=o.substr(0,o.length-2),t.crop.this.previewJson[0].height=o,t.crop.this.previewJson[0].width=o,t.crop.watch.previewJson[0].height=o,t.crop.watch.previewJson[0].width=o,t},external.func.crop.cropUrl=function(t){return new Promise(function(o,r){console.log("~~~~~~~~cropUrl~~~~~~~~~~",t),init(t).then(t=>{t.crop.func.setImage(t),t.crop.func.tool.mounted(t),t.crop.func.setSize(t);let r=0;t.this.querySelector(".saveImg").addEventListener("click",e=>{colorLog("~~~~~~~~<matcher-save-imgages>~~~~~~~~~~","#FF4500",e),r=e.timeStamp;let c=dom.staticProperty.querySelector(".org"),n=t.crop.func.convert.clearnPx(dom.staticProperty.querySelector(".preview").style.top),i=t.crop.func.convert.clearnPx(dom.staticProperty.querySelector(".preview").style.left),p=t.crop.func.convert.clearnPx(dom.staticProperty.querySelector(".preview").style.width),a=t.crop.func.convert.clearnPx(dom.staticProperty.querySelector(".preview").style.height),s=t.crop.func.convert.vwToPixel(36),l=t.crop.func.convert.vwToPixel(36),h=dom.staticProperty.querySelector(".preview").naturalWidth,u=dom.staticProperty.querySelector(".preview").naturalHeight;i=parseInt(i,10),n=parseInt(n,10),p=parseInt(p,10),a=parseInt(a,10),s=parseInt(s,10),l=parseInt(l,10);let m=document.createElement("canvas");m.width=s,m.height=l,m.getContext("2d").drawImage(c,0,0,h,u,i,n,p,a),t.upload.url=m.toDataURL("image/png").replace("image/png","image/octet-stream");let d=m.toDataURL();m.toBlob(async function(r){URL.createObjectURL(r);t.slot?t.upload.object=t.slot:t.upload.object=t.parent,t.upload.file=r,t.this.querySelector(".modal").style.display="none";let e=await action({input:t.slot?t.slot:"image",url:URL.createObjectURL(r),blob:r,dataURL:d,name:(await bundle.default()).uniqid(),type:"image"},"save","type");o(e)},"image/jpeg",.95)},!0)})})},external.func.crop.mounted=async function(t){return t=await crop.crop.func.setSize(t)},external.func.mounted=function(t){return new Promise(function(o,r){t.crop.this.$cropArea=t.this.querySelector(".c-crop--area");for(let o=0;o<dragEle.length;o++)t.crop.func.tool.dragCall(t,o);t.crop.func.tool.dragCallLocation(t)})},external.func.dragCall=function(t,o){let r=t.this.querySelector(dragEle[o]);draggable(r,{start:o=>{t.crop.this.startSize=t.crop.func.tool.getDragSize(o,t)},drag:r=>{t.crop.func.tool.handleDrag(r,o,t)},end:r=>{t.crop.func.tool.handleDrag(r,o,t)}})},external.func.dragCallLocation=function(t){return new Promise(function(o,r){draggable(t.this.querySelector(".c-crop--drap_screen"),{start:o=>{t.crop.this.startPos=[o.x,o.y]},drag:o=>{t.crop.func.tool.handleDragLocation(o,t)},end:o=>{t.crop.func.tool.handleDragLocation(o,t)}})})},external.func.handleDrag=function(t,o,r){return new Promise(function(e,c){r.crop.this.json=r.crop.func.tool.getDragSize(t,r),movePos[o](r.crop.this,r.crop.this.json,r.crop.this.startSize),r.crop.func.tool.handleSize(!0,r),r.crop.func.tool.drapSizeUpdate(r.crop.this.width,r.crop.this.height,r.crop.this.top,r.crop.this.left,r),clearTimeout(r.crop.this.cropTimer),r.crop.this.cropTimer=setTimeout(()=>{r.crop.func.tool.afterCrop(r)},200)})},external.func.getDragSize=function(t,o){const r=o.crop.this.$cropArea.querySelector(".c-crop--drap"),e=o.crop.this.$cropArea.getBoundingClientRect(),c=r.getBoundingClientRect();let n={x:t.clientX,y:t.clientY,t:c.top,b:c.bottom,l:c.left,r:c.right,w:c.width,h:c.height,screen:e};return n.ratio=n.w/n.h,n},external.func.getCoord=function(t,o,r,e,c){return{p0:[t=c.crop.this.scale*t,o=c.crop.this.scale*o],p1:[t+(r=c.crop.this.scale*r),o],p2:[t+r,o+(e=c.crop.this.scale*e)],p3:[t,o+e],w:r,h:e,l:t,t:o}},external.func.drapSizeUpdate=function(t,o,r,e,c){return new Promise(function(n,i){c.crop.this.elWidth=t,c.crop.this.elHeight=o,c.crop.this.cursorTop=r,c.crop.this.cursorLeft=e,c.crop.watch.elWidth=t,c.crop.watch.elHeight=o,c.crop.watch.cursorTop=r,c.crop.watch.cursorLeft=e,c.crop.this.coord=c.crop.func.tool.getCoord(e,r,t,o,c),c.crop.func.setPreviewSize(c)})},external.func.range2=function(t,o,r){return t<=0?0:t>r-o?r-o:t},external.func.handleSize=function(t,o){return new Promise(function(r,e){if(o.crop.this.left=o.crop.func.tool.range2(o.crop.this.left,o.crop.this.width,o.crop.this.cropJson.w),o.crop.this.top=o.crop.func.tool.range2(o.crop.this.top,o.crop.this.height,o.crop.this.cropJson.h),t){let t=o.crop.this.cropJson.w-o.crop.this.left,r=o.crop.this.cropJson.h-o.crop.this.top;o.crop.this.cropJson.r?t<o.crop.this.width?(o.crop.this.width=t,o.crop.this.height=o.crop.this.width/o.crop.this.cropJson.r):r<o.crop.this.height&&(o.crop.this.height=r,o.crop.this.width=o.crop.this.height*o.crop.this.cropJson.r):(t<o.crop.this.width&&(o.crop.this.width=t),r<o.crop.this.height&&(o.crop.this.height=r))}})},external.func.verify=function(t){return t<0&&(t=0),t},external.func.verifyRB=function(t){return t<0},external.func.handleDragLocation=function(t,o){return new Promise(function(r,e){let c=t.clientX,n=t.clientY;o.crop.this.top=o.crop.func.tool.verify(n-o.crop.this.startPos[1]+o.crop.this.top),o.crop.this.left=o.crop.func.tool.verify(c-o.crop.this.startPos[0]+o.crop.this.left),o.crop.this.startPos=[c,n],o.crop.watch.top=o.crop.func.tool.verify(n-o.crop.this.startPos[1]+o.crop.this.top),o.crop.watch.left=o.crop.func.tool.verify(c-o.crop.this.startPos[0]+o.crop.this.left),o.crop.watch.startPos=[c,n],clearTimeout(o.crop.this.cropTimer),o.crop.this.cropTimer=setTimeout(()=>{o.crop.func.tool.afterCrop(o)},200)})},external.func.getParentElement=function(t,o){return new Promise(function(r,e){return-1===t.className.indexOf(o)?(t=t.parentNode,this.getParentElement(t,o)):t})};export default{database:database,external:external,mongo:mongo,webdav:webdav,email:email,server:server,config:config};