!function(){var e,t={is_template:function(e){return/\{\{(.+)\}\}/g.test(e)},is_array:function(e){return Array.isArray(e)||!!e&&"object"==typeof e&&"number"==typeof e.length&&(0===e.length||e.length>0&&e.length-1 in e)},resolve:function(e,t,r){return t&&t.length>0?Function("new_val","with(this) {this"+t+"=new_val; return this;}").bind(e)(r):e=r}},r={run:function(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=Object.keys(n)[0],l=o.tokenize(i);if("#if"!==l.name&&"#elseif"!==l.name)return o.run(n[i],t);var s=l.expression,a=o.fillout(t,"{{"+s+"}}");if(a==="{{"+s+"}}")return e;if(a)return o.run(n[i],t)}return null},is:function(e){if(!t.is_array(e))return!1;if(0===e.length)return!1;for(var r=!0,n=0;n<e.length;n++){var i=e[0];if("object"!=typeof i){r=!1;break}if(1!==Object.keys(i).length){r=!1;break}}if(!r)return!1;var l,s=e[0];for(var a in s){if(!(l=o.tokenize(a)))return!1;if(!l.name)return!1;if(!l.expression||0===l.expression.length)return!1;if("#if"!==l.name.toLowerCase())return!1}if(1===e.length)return!0;for(var c=!0,p=1;p<e.length-1;p++){var u=e[p];for(var f in u)if("#elseif"!==(l=o.tokenize(f)).name.toLowerCase()){c=!1;break}}if(!c)return!1;var d=e[e.length-1];for(var $ in d)if(l=o.tokenize($),-1===["#else","#elseif"].indexOf(l.name.toLowerCase()))return!1;return!0}},o={memory:{},transform:function(e,t,r,o){var i,l=null;if(/#include/.test(JSON.stringify(e))&&(l=function(e,t){return/#include/.test(e)||/#include/.test(t)}),r){var s=n.select(e,l,o).transform(t,o).root();i=n.select(t,null,o).inject(r,o).transformWith(s,o).root()}else i=n.select(e,l,o).transform(t,o).root();return o?JSON.stringify(i):i},tokenize:function(e){var t=(e=e.replace(/\{\{(.+)\}\}/g,"$1")).trim().split(" ");if(t.length>0&&"#"===t[0][0])return{name:t.shift(),expression:t.join(" ")};return null},run:function(e,n){var i,l;if("string"==typeof e)if(t.is_template(e)){/\{\{([ ]*#include)[ ]*([^ ]*)\}\}/g.test(e)?(l=o.tokenize(e),i=l.expression?o.fillout(n,"{{"+l.expression+"}}",!0):e):i=o.fillout(n,e)}else i=e;else if(t.is_array(e))if(r.is(e))i=r.run(e,n);else{i=[];for(var s=0;s<e.length;s++){(x=o.run(e[s],n))&&i.push(x)}}else{if("[object Object]"!==Object.prototype.toString.call(e))return e;i={};var a=/\{\{([ ]*#include)[ ]*(.*)\}\}/,c=Object.keys(e).filter(function(e){return a.test(e)});for(var p in c.length>0&&(l=o.tokenize(c[0]),i=l.expression?o.fillout(e[c[0]],"{{"+l.expression+"}}",!0):e[c[0]]),e){if(t.is_template(p))if(l=o.tokenize(p)){if("#include"===l.name);else if("#let"===l.name){if(t.is_array(e[p])&&2==e[p].length){var u=e[p][0],f=e[p][1],d=o.run(u,n);for(var $ in d)o.memory[$]=d[$],n[$]=d[$];i=o.run(f,n)}}else if("#concat"===l.name)t.is_array(e[p])&&(i=[],e[p].forEach(function(e){var t=o.run(e,n);i=i.concat(t)}),/\{\{(.*?)\}\}/.test(JSON.stringify(i))&&(i=e));else if("#merge"===l.name){if(t.is_array(e[p]))if(i={},e[p].forEach(function(e){var t=o.run(e,n);for(var r in t)i[r]=t[r]}),"object"==typeof n)for(var y in delete i.$index,o.memory)delete i[y];else for(var y in delete String.prototype.$index,delete Number.prototype.$index,delete Function.prototype.$index,delete Array.prototype.$index,delete Boolean.prototype.$index,o.memory)delete String.prototype[y],delete Number.prototype[y],delete Function.prototype[y],delete Array.prototype[y],delete Boolean.prototype[y]}else if("#each"===l.name){var m=o.fillout(n,"{{"+l.expression+"}}",!0);if(m&&t.is_array(m)){i=[];for(var v=0;v<m.length;v++){if("object"==typeof m[v])for(var y in m[v].$index=v,o.memory)m[v][y]=o.memory[y];else for(var y in String.prototype.$index=v,Number.prototype.$index=v,Function.prototype.$index=v,Array.prototype.$index=v,Boolean.prototype.$index=v,o.memory)String.prototype[y]=o.memory[y],Number.prototype[y]=o.memory[y],Function.prototype[y]=o.memory[y],Array.prototype[y]=o.memory[y],Boolean.prototype[y]=o.memory[y];var g=o.run(e[p],m[v]);if("object"==typeof m[v])for(var y in delete m[v].$index,o.memory)delete m[v][y];else for(var y in delete String.prototype.$index,delete Number.prototype.$index,delete Function.prototype.$index,delete Array.prototype.$index,delete Boolean.prototype.$index,o.memory)delete String.prototype[y],delete Number.prototype[y],delete Function.prototype[y],delete Array.prototype[y],delete Boolean.prototype[y];g&&i.push(g)}}else i=e}}else{var h=o.fillout(n,p),_=o.fillout(n,e[p]);void 0!==h&&void 0!==_&&(i[h]=_)}else if("string"==typeof e[p])if((l=o.tokenize(e[p]))&&"#?"===l.name){var b=o.fillout(n,"{{"+l.expression+"}}");b!=="{{"+l.expression+"}}"&&b&&(i[p]=b)}else{var x;void 0!==(x=o.run(e[p],n))&&(i[p]=x)}else void 0!==(x=o.run(e[p],n))&&(i[p]=x)}}return i},fillout:function(e,r,n){var i=r;if(t.is_template(r)){var l=r.match(/\{\{(.*?)\}\}/g);if(!l)return i;if(n)i=o._fillout({variable:l[0],data:e,template:null});else for(var s=0;s<l.length;s++){var a=l[s];i=o._fillout({variable:a,data:e,template:i})}}return i},_fillout:function(t){var r=/^\{\{((?!\}\}).)*\}\}$/,o=t.variable,n=t.data,i=t.template;try{var l=o.replace(/\{\{(.*?)\}\}/g,"$1");if(n){["number","string","array","boolean","function"].indexOf(-1===typeof n)&&(n.$root=e);var s=/function\([ ]*\)[ ]*\{(.*)\}[ ]*$/g.exec(l),a=(s?Function("with(this) {"+s[1]+"}").bind(n):/\breturn [^;]+;?[ ]*$/.test(l)&&/return[^}]*$/.test(l)?Function("with(this) {"+l+"}").bind(n):Function("with(this) {return ("+l+")}").bind(n))();return delete n.$root,a&&(a=a.valueOf()),void 0===a?i:a?i?r.test(i)?a:i.replace(o,a):a:i?r.test(i)?a:i.replace(o,""):""}return i}catch(e){return i}}},n={$val:null,$selected:[],$injected:[],$progress:null,exec:function(e,r,o){if("string"==typeof e);else if(t.is_array(e))for(var i=0;i<e.length;i++)n.exec(e[i],r+"["+i+"]",o);else for(var l in e)if("$root"!==l){if(o(l,e[l])){var s=n.$selected.length;n.$selected.push({index:s,key:l,path:r,object:e,value:e[l]})}n.exec(e[l],r+'["'+l+'"]',o)}},inject:function(e,t){n.$injected=e;try{t&&(n.$injected=JSON.parse(e))}catch(e){}return Object.keys(n.$injected).length>0&&n.select(n.$injected),n},select:function(e,r,o){var i=e;try{o&&(i=JSON.parse(e))}catch(e){}return r?(n.$selected=[],n.exec(i,"",r)):n.$selected=null,i&&(t.is_array(i)||"object"==typeof i)?(n.$progress||(t.is_array(i)?(n.$val=[],n.$selected_root=[]):(n.$val={},n.$selected_root={})),Object.keys(i).forEach(function(e){n.$val[e]=i[e],n.$selected_root[e]=i[e]})):(n.$val=i,n.$selected_root=i),n.$progress=!0,n},transformWith:function(r,i){n.$parsed=[],n.$progress=null;var l=r;try{i&&(l=JSON.parse(r))}catch(e){}if(n.$template_root=l,String.prototype.$root=n.$selected_root,Number.prototype.$root=n.$selected_root,Function.prototype.$root=n.$selected_root,Array.prototype.$root=n.$selected_root,Boolean.prototype.$root=n.$selected_root,e=n.$selected_root,n.$selected&&n.$selected.length>0)n.$selected.sort(function(e,t){return t.path.length-e.path.length}).forEach(function(e){var r=o.run(l,e.object);n.$selected_root=t.resolve(n.$selected_root,e.path,r),e.object=r}),n.$selected.sort(function(e,t){return e.index-t.index});else{var s=o.run(l,n.$selected_root);n.$selected_root=t.resolve(n.$selected_root,"",s)}return delete String.prototype.$root,delete Number.prototype.$root,delete Function.prototype.$root,delete Array.prototype.$root,delete Boolean.prototype.$root,n},transform:function(r,i){n.$parsed=[],n.$progress=null;var l=r;try{i&&(l=JSON.parse(r))}catch(e){}if(n.$template_root=n.$selected_root,String.prototype.$root=l,Number.prototype.$root=l,Function.prototype.$root=l,Array.prototype.$root=l,Boolean.prototype.$root=l,e=l,n.$selected&&n.$selected.length>0)n.$selected.sort(function(e,t){return t.path.length-e.path.length}).forEach(function(e){var r=o.run(e.object,l);n.$template_root=t.resolve(n.$template_root,e.path,r),n.$selected_root=n.$template_root,e.object=r}),n.$selected.sort(function(e,t){return e.index-t.index});else{var s=o.run(n.$selected_root,l);n.$template_root=t.resolve(n.$template_root,"",s),n.$selected_root=n.$template_root}return delete String.prototype.$root,delete Number.prototype.$root,delete Function.prototype.$root,delete Array.prototype.$root,delete Boolean.prototype.$root,n},objects:function(){return n.$progress=null,n.$selected?n.$selected.map(function(e){return e.object}):[n.$selected_root]},keys:function(){return n.$progress=null,n.$selected?n.$selected.map(function(e){return e.key}):Array.isArray(n.$selected_root)?Object.keys(n.$selected_root).map(function(e){return parseInt(e)}):Object.keys(n.$selected_root)},paths:function(){return n.$progress=null,n.$selected?n.$selected.map(function(e){return e.path}):Array.isArray(n.$selected_root)?Object.keys(n.$selected_root).map(function(e){return"["+e+"]"}):Object.keys(n.$selected_root).map(function(e){return'["'+e+'"]'})},values:function(){return n.$progress=null,n.$selected?n.$selected.map(function(e){return e.value}):Object.values(n.$selected_root)},root:function(){return n.$progress=null,n.$selected_root}},i=JSON.stringify;if(JSON.stringify=function(e,t,r){return-1!==["number","string","boolean"].indexOf(typeof e)?i(e,t,r):i(e,t||function(e,t){if(!(n.$injected&&n.$injected.length>0&&-1!==n.$injected.indexOf(e)||"$root"===e||"$index"===e||e in o.memory))return"function"==typeof t?"("+t.toString()+")":t},r)},"undefined"!=typeof exports){var l={TRANSFORM:o,transform:o,SELECT:n,Conditional:r,Helper:t,inject:n.inject,select:n.select,transform:o.transform};"undefined"!=typeof module&&module.exports&&(exports=module.exports=l),exports=l}else this.ST={select:n.select,inject:n.inject,transform:o.transform}}();