function startup(){var e=document.body;e.addEventListener("touchstart",handleStart,!1),e.addEventListener("touchend",handleEnd,!1),e.addEventListener("touchcancel",handleCancel,!1),e.addEventListener("touchleave",handleEnd,!1),e.addEventListener("touchmove",handleMove,!1),log("initialized.")}var ongoingTouches=new Array;function handleStart(e){for(var n=document.getElementsByTagName("canvas")[0],t=n.getContext("2d"),o=e.changedTouches,i=findPos(n),c=0;c<o.length;c++)if(o[c].clientX-i.x>0&&o[c].clientX-i.x<parseFloat(n.width)&&o[c].clientY-i.y>0&&o[c].clientY-i.y<parseFloat(n.height)){e.preventDefault(),log("touchstart:"+c+"..."),ongoingTouches.push(copyTouch(o[c]));var l=colorForTouch(o[c]);t.beginPath(),t.arc(o[c].clientX-i.x,o[c].clientY-i.y,4,0,2*Math.PI,!1),t.fillStyle=l,t.fill(),log("touchstart:"+c+".")}}function handleMove(e){for(var n=document.getElementsByTagName("canvas")[0],t=n.getContext("2d"),o=e.changedTouches,i=findPos(n),c=0;c<o.length;c++)if(o[c].clientX-i.x>0&&o[c].clientX-i.x<parseFloat(n.width)&&o[c].clientY-i.y>0&&o[c].clientY-i.y<parseFloat(n.height)){e.preventDefault();var l=colorForTouch(o[c]),r=ongoingTouchIndexById(o[c].identifier);r>=0?(log("continuing touch "+r),t.beginPath(),log("ctx.moveTo("+ongoingTouches[r].clientX+", "+ongoingTouches[r].clientY+");"),t.moveTo(ongoingTouches[r].clientX-i.x,ongoingTouches[r].clientY-i.y),log("ctx.lineTo("+o[c].clientX+", "+o[c].clientY+");"),t.lineTo(o[c].clientX-i.x,o[c].clientY-i.y),t.lineWidth=4,t.strokeStyle=l,t.stroke(),ongoingTouches.splice(r,1,copyTouch(o[c])),log(".")):log("can't figure out which touch to continue")}}function handleEnd(e){for(var n=document.getElementsByTagName("canvas")[0],t=n.getContext("2d"),o=e.changedTouches,i=findPos(n),c=0;c<o.length;c++)if(o[c].clientX-i.x>0&&o[c].clientX-i.x<parseFloat(n.width)&&o[c].clientY-i.y>0&&o[c].clientY-i.y<parseFloat(n.height)){e.preventDefault();var l=colorForTouch(o[c]),r=ongoingTouchIndexById(o[c].identifier);r>=0?(t.lineWidth=4,t.fillStyle=l,t.beginPath(),t.moveTo(ongoingTouches[r].clientX-i.x,ongoingTouches[r].clientY-i.y),t.lineTo(o[c].clientX-i.x,o[c].clientY-i.y),t.fillRect(o[c].clientX-4-i.x,o[c].clientY-4-i.y,8,8),ongoingTouches.splice(c,1)):log("can't figure out which touch to end")}}function handleCancel(e){e.preventDefault(),log("touchcancel.");for(var n=e.changedTouches,t=0;t<n.length;t++)ongoingTouches.splice(t,1)}function colorForTouch(e){var n=e.identifier%16,t=Math.floor(e.identifier/3)%16,o=Math.floor(e.identifier/7)%16,i="#"+(n=n.toString(16))+(t=t.toString(16))+(o=o.toString(16));return log("color for touch with identifier "+e.identifier+" = "+i),i}function copyTouch(e){return{identifier:e.identifier,clientX:e.clientX,clientY:e.clientY}}function ongoingTouchIndexById(e){for(var n=0;n<ongoingTouches.length;n++){if(ongoingTouches[n].identifier==e)return n}return-1}function log(e){var n=document.getElementById("log");n.innerHTML=e+"\n"+n.innerHTML}function findPos(e){var n=0,t=0;if(e.offsetParent){do{n+=e.offsetLeft,t+=e.offsetTop}while(e=e.offsetParent);return{x:n-document.body.scrollLeft,y:t-document.body.scrollTop}}}