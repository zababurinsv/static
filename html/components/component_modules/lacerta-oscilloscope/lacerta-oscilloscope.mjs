!function(t,e){"use strict";var n="exp pow tan tg:tan atan arctg:atan log sin asin arcsin:asin cos acos arccos:acos sqrt E e:E PI pi:PI floor ceil round sign abs rand:random random".split(/\s+/).map(function(t){return t.split(":")}).reduce(function(t,e){return t+"var "+e[0]+" = Math."+(e[1]||e[0])+";"},"");function i(t){return 2*((t*=.5)-floor(.5+t))}function r(t){try{var e=new Function(n+"return function(t, m, s) {\n  var phi = m * PI;\n  return ("+t+");\n};")();return isNaN(e(0,0,0))&&isNaN(e(42,1,1))?null:e}catch(t){return null}}function a(){this.x="cos(3*phi + tri(t))",this.y="sin(2*phi + t)",this.w="cos(3*phi*tri(t))",this.speed=1,this.step=.01,this.thickness=2,this.color="#77ccff",this.running=!0,this.prev=Date.now(),this.time=0,this.audio=null}n+=function(t){return sign(sin(t))}.toString(),n+=i.toString(),n+=function(t){return 1-2*abs(i(t))}.toString(),a.prototype={get x(){return this._x},set x(t){var e=r(t);e&&(this.xfn=e,this._x=t)},get y(){return this._y},set y(t){var e=r(t);e&&(this.yfn=e,this._y=t)},get w(){return this._w},set w(t){var e=r(t);e&&(this.wfn=e,this._w=t)},get recording(){return!!this.audio},set recording(t){t?this.startRecording():this.stopRecording()},startRecording:function(){if(!this.audio){var t=this;navigator.getUserMedia({audio:!0,video:!1},function(e){var n=t.audio={};n.stream=e,n.context=new AudioContext,n.analyser=n.context.createAnalyser(),n.analyser.smoothingTimeConstant=0,n.source=n.context.createMediaStreamSource(e),n.source.connect(n.analyser),n.buffer=new Float32Array(n.analyser.frequencyBinCount),n.lastSample=n.buffer.length-1},function(t){throw t})}},stopRecording:function(){this.audio&&(this.audio.stream.stop(),this.audio=null)},toggle:function(){this.running=!this.running,this.prev=Date.now()},update:function(){if(this.running){var t=Date.now();this.time+=(t-this.prev)*this.speed,this.prev=t}},render:function(t){if(this.running){var e=t.canvas.width,n=e/2,i=t.canvas.height,r=i/2;if(t.clearRect(0,0,e,i),t.lineWidth=this.thickness,t.strokeStyle=this.color,this.audio&&this.audio.buffer){var a=this.audio.buffer,s=this.audio.lastSample;this.audio.analyser.getFloatTimeDomainData(a)}for(var o=this.xfn,u=this.yfn,h=this.wfn,d=this.step,c=this.time/1e3,g=o(c,-1,a?a[0]:0),f=u(c,-1,a?a[0]:0),l=-1,p=1+d/2;l<p;l+=d){l>1&&(l=1);var m=a?a[s*(l+1)/2+.5|0]:0,v=o(c,l,m),w=u(c,l,m);t.globalAlpha=h(c,l,m),t.save(),t.setTransform(n,0,0,-r,n,r),t.beginPath(),t.moveTo(g,f),t.lineTo(v,w),t.restore(),t.stroke(),g=v,f=w}}},constructor:a},window.onload=function(){var n=new a,i=document.querySelector("#area"),r=i.getContext("2d"),s=new t.GUI;s.add(n,"x").name("x(t, m, phi, s)"),s.add(n,"y").name("y(t, m, phi, s)"),s.add(n,"w").name("w(t, m, phi, s)"),s.add(n,"recording").name("record (s param)").listen(),s.add(n,"speed",-25,25),s.add(n,"step",.001,.05),s.add(n,"thickness",.2,10),s.addColor(n,"color"),s.add(i,"width",100),s.add(i,"height",100);var o=s.add(n,"toggle").name("pause (space)").onChange(u);function u(){o.name(n.running?"resume":"pause"),n.running?h.hide():h.show()}addEventListener("keypress",function(t){32===t.charCode&&"INPUT"!==t.target.tagName&&(u(),n.toggle(),t.preventDefault())},!1);var h=new e,d=requestAnimationFrame;!function t(){h.tickStart(),n.update(),n.render(r),d(t),h.tick()}()},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}(dat,FPSMeter);