import action from"/static/html/components/component_modules/action/action.mjs";import isEmpty from"/static/html/components/component_modules/isEmpty/isEmpty.mjs";let queue={staticProperty:[]},handler={get:function(t,e){return t[e]},set:function(t,e,a){switch(t[e]=a,e){case"length":if(1===t.length){let e=setTimeout(async function a(){if(console.log("~~~~~input~~~~~~"),0===t.length)console.log("end~~~~~~~~~~~"),clearTimeout(e);else{switch(t[0].task.type){case"delete":switch(t[0].name||(t[0].name="default"),t[0].name){case"bid":await action({input:"static-property",date:t[0].task.date,remove:t[0].task.remove,type:"bid"},"delete","type");break;default:await action({input:"static-property",date:t[0].task.date,remove:t[0].task.remove,type:"news"},"delete","type")}break;case"create":let e=new CustomEvent("convertAction",{detail:{data:t[0].task.data}});document.dispatchEvent(e);break;case"update":switch(t[0].name||(t[0].name="default"),t[0].name){case"bid":action({button:t[0].task.button,input:"varan-card-news",this:t[0].task.this,date:t[0].task.date,type:"bid"},"update","type");break;default:action({button:t[0].task.button,input:"lacerta-news",this:t[0].task.this,date:t[0].task.date,type:"news"},"update","type")}break;case"updateAction":t[0].name||(t[0].name="default");let a={};switch(t[0].name){case"bid":a=new CustomEvent("updateAction",{detail:{date:t[0].task.date,data:t[0].task.update,name:"bid"}}),document.dispatchEvent(a);break;default:a=new CustomEvent("updateAction",{detail:{date:t[0].task.date,data:t[0].task.update,name:"news"}}),document.dispatchEvent(a)}}console.log("all~~~~~~~~~~~",t,t.length),console.log("now~~~~~~~~~~~",t[0]),t.shift(),e=setTimeout(a,10)}},0)}}return!0}};export default(t,e,...a)=>new Promise(function(r,s){let i=t=>{r(t)},o=t=>{console.log("~~~ err staticProperty ~~~",t),s(t)};switch(e){case"object":(async(t,e,a)=>{try{console.log(`${t.input}[(staticProperty)${t[e]}]`),isEmpty(queue.staticProperty[t[e]])?i(!0):i(queue.staticProperty[t[e]])}catch(t){o(t)}})(t,a[0],a[1],a[2],a[3]);break;case"task":(async(t,e,a)=>{switch(t[e]){case"task":try{isEmpty(queue.staticProperty.task)&&(queue.staticProperty.task=[],queue.staticProperty.task=new Proxy(queue.staticProperty.task,handler)),queue.staticProperty.task.push(t),i({task:"push"})}catch(t){o(t)}break;default:o(`необрабатываемый тип запроса ${t[e]}`)}})(t,a[0],a[1],a[2],a[3]);break;case"set":(async(t,e,a)=>{try{switch(t[e]){case"store":void 0===queue.staticProperty[`${t.input}`]&&(queue.staticProperty[`${t.input}`]=[]),queue.staticProperty[`${t.input}`]=t.store,i(queue.staticProperty);break;case"timer":void 0===queue.staticProperty[`${t.input}`]&&(queue.staticProperty[`${t.input}`]=[]),queue.staticProperty[`${t.input}_${t.id}`]=t.data,i(queue.staticProperty[`${t.input}_${t.id}`]);break;case"obj":queue.staticProperty[t.input]||(queue.staticProperty[t.input]=[]),queue.staticProperty[t.input].push(t),i(t);break;case"all":queue.staticProperty=t.store,i(queue.staticProperty);break;case"object":queue.staticProperty[t.name]||(queue.staticProperty[t.name]=[]),queue.staticProperty[t.name].push(t),console.log("store",t),i(t);break;case"editor":if(isEmpty(queue.staticProperty["varan-editor"]))queue.staticProperty["varan-editor"]=[],queue.staticProperty["varan-editor"].push(t.editor),i(t.editor);else{let e=!1,a=0,r=0;for(let s=0;s<queue.staticProperty["varan-editor"].length;s++)isEmpty(t.slot)?console.assert(!1,"должен быть слот"):t.slot===queue.staticProperty["varan-editor"][s].slot&&(e=!0,a=s,r++);e?r>1?console.assert(!1,"должен быть один объект"):(queue.staticProperty["varan-editor"][a].editor=t.editor,i(t.editor)):(queue.staticProperty["varan-editor"].push(t.editor),i(t.editor))}break;default:o(`необрабатываемый тип запроса ${t[e]}`)}}catch(t){o(t)}})(t,a[0],a[1],a[2],a[3]);break;case"put":(async(t,e,a)=>{try{switch(t[e]){case"timer":i(queue.staticProperty[`${t.input}_${t.id}`].timer=t.timer)}}catch(t){o(t)}})(t,a[0],a[1],a[2],a[3]);break;case"add":(async(t,e,a)=>{try{switch(t[e]){case"timer":queue.staticProperty[`${t.input}_${t.id}`].timer=+queue.staticProperty[`${t.input}_${t.id}`].timer+t.timer,queue.staticProperty[`${t.input}_${t.id}`].price=+queue.staticProperty[`${t.input}_${t.id}`].price+t.price,i(queue.staticProperty[`${t.input}_${t.id}`])}}catch(t){o(t)}})(t,a[0],a[1],a[2],a[3]);break;case"get":(async(t,r,s)=>{try{switch(console.log(`${e}[(${t.input})${t[r]}]`),t[r]){case"all":i(queue.staticProperty);break;case"timer":i(queue.staticProperty[`${t.input}_${t.id}`].timer);break;case"editor":let s=!1,u=0,c=0;if(isEmpty(queue.staticProperty["varan-editor"]))i(void 0);else{for(let e=0;e<queue.staticProperty["varan-editor"].length;e++)t.target===queue.staticProperty["varan-editor"][e].slot&&(s=!0,u=e,c++);s?c>1||i(queue.staticProperty["varan-editor"][u].editor):i(void 0)}break;case"obj":(async(t,e,a)=>{try{let e=!1,a=0,r=0;if(isEmpty(queue.staticProperty[t.target]))i(void 0);else if(isEmpty(t.slot))i(queue.staticProperty[t.target]);else{for(let s=0;s<queue.staticProperty[t.target].length;s++)t.slot===queue.staticProperty[t.target][s].slot&&(e=!0,a=s,r++);e?r>1?console.assert(!1,"должен быть один объект"):i(queue.staticProperty[t.target][a]):(console.warn("staticProperty - слот не найден"),i(queue.staticProperty[t.target]))}}catch(t){}})(t,a[0],a[1],a[2],a[3]);break;case"object":(async(t,e,a)=>{try{let e=[];for(let a=0;a<t.object.length;a++)console.log(t.object[a]),isEmpty(queue.staticProperty[t.object[a]])||e.push(queue.staticProperty[t.object[a]]);i(e)}catch(t){o({staticProperty:t})}})(t,a[0],a[1],a[2],a[3]);break;default:o(`необрабатываемый тип запроса ${t[r]}`)}}catch(t){o(t)}})(t,a[0],a[1],a[2],a[3]);break;case"getObject":(async(t,a,r)=>{try{console.log(`${e}[(${t.input})${t[a]}]`),i(queue.staticProperty[a])}catch(t){o(t)}})(t,a[0],a[1],a[2],a[3]);break;case"set_n":(async(t,a,r)=>{try{switch(console.log(`${e}[(${t.input})${t[a]}]`),t[a]){case"image":queue.staticProperty[t.input]||(queue.staticProperty[t.input]=[]),queue.staticProperty[t.input].push(t),i(t);break;case"object":queue.staticProperty[t.name]||(queue.staticProperty[t.name]=[]),queue.staticProperty[t.name].push(t),i(t);break;case"obj":t.input||console.assert(!1,"надо указаь obj[input]"),queue.staticProperty[t.input]||(queue.staticProperty[t.input]=[]),queue.staticProperty[t.input].push(t),console.log("store",t),i(t);break;default:o(`необрабатываемый тип запроса ${t[a]}`)}}catch(t){o(t)}})(t,a[0],a[1],a[2],a[3]);break;default:o(`новая функция ${e}`)}});