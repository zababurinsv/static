import colorLog from"/static/html/components/component_modules/colorLog/colorLog.mjs";import staticProperty from"/static/html/components/component_modules/staticProperty/staticProperty.mjs";import parser from"/static/html/components/component_modules/parser/parser.mjs";import matcher from"/static/html/components/component_modules/matcher/matcher.mjs";import feed from"/static/html/components/component_modules/feed/feed.mjs";import template from"/static/html/components/component_modules/template/template.mjs";import utils from"/static/html/components/component_modules/utils/utils.mjs";import IntersectionObserver from"/static/html/components/component_modules/IntersectionObserver/IntersectionObserver.mjs";import getBoundingClientRect from"/static/html/components/component_modules/getBoundingClientRect/getBoundingClientRect.mjs";import verification from"/static/html/components/component_modules/verification/verification.mjs";import addEventListener from"/static/html/components/component_modules/addEventListener/addEventListener.mjs";import conf from"/static/html/components/component_modules/matcher/matcher/this/database/config/index.mjs";import isEmpty from"/static/html/components/component_modules/isEmpty/isEmpty.mjs";import config from"/static/html/components/component_modules/bundle/action.mjs";export default(e,t,...a)=>new Promise(function(n,o){let r=e=>{n(e)},i=e=>{console.log("~~~ err ~~~",e),o(e)};switch(t){case"add":(async(e,a,n)=>{try{switch(console.log(`app(${t}[(${e.input})${e[a]}action])`),e[a]){case"menu-update":r(addEventListener({input:"lacerta-moderator",type:"menu-update",data:e.data},"add","type"));break;case"image":let n=await staticProperty({input:"action",object:["sidebar",e.id],type:"object"},"get","type"),o=await staticProperty(e,"set_n","type");n["varan-sidebar"][0].obj.this.shadowRoot.querySelector(".filename").innerText=`${o.name}.jpg`,r(o);break;default:i(`необрабатываемый тип запроса set ${e[a]}`)}}catch(e){i(e)}})(e,a[0],a[1],a[2],a[3]);break;case"save":(async(e,a,n)=>{try{switch(console.log(`app(${t}[(${e.input})${e[a]}action])`),e[a]){case"editor":let n=await staticProperty({input:"customEvents",type:"editor",target:e.id},"get","type"),o={};o.component=e.id,o.user="anonymous",o.type="public",o.captcha="",o.init=!1,o.count=0,o.status=-1,o.online=!1,o.Timestamp="",o["view-wall"]="",o["view-slider-pos"]=null,o["view-slider-db"]=0,o.id=e.id,o["edit-delta"]=JSON.stringify(n.quill.getContents()),o.content=n.quill.root.innerHTML,o["view-slider"]=0,o.url=window.location.href,await parser({input:"action",this:n.self,component:o,type:"editor"},"set","type");let c=await staticProperty({input:"customEvents",type:"obj",target:"varan-about",slot:"about-admin"},"get","type"),s=(await config.default()).store;if(void 0===c)if(void 0===s["varan-about"]);else for(let e=0;e<s["varan-about"].length;e++)"about-admin"===s["varan-about"][e].slot&&(c=s["varan-about"][e]);void 0===c||(null===c.obj.this.querySelector(".menu-convert")?c.obj.this.querySelector("varan-menu").shadowRoot.querySelector(".menu-convert").innerText="Сохраните данные":c.obj.this.querySelector(".menu-convert").innerText="Сохраните данные"),r(e);break;case"image":let d=await staticProperty({input:"action",object:["telegram-login",e.input],type:"object"},"get","type");isEmpty(d)?r(e):(d[0][0].file=e,console.warn("надо переписать это частный случай"),r(d[0][0]));break;default:i(`необрабатываемый тип запроса set ${e[a]}`)}}catch(e){i(e)}})(e,a[0],a[1],a[2],a[3]);break;case"action":(async(e,a,n)=>{try{switch(console.log(`${t}[(${e.input})${e[a]}]`),e[a]){case"crop":let n=await staticProperty({input:"action",type:"all"},"get","type");if(e.upload={},isEmpty(n["varan-crop"]))alert("добавьте в проект компонент varan-crop");else{e.this=n["varan-crop"][0].obj.this.shadowRoot,e.upload.url=URL.createObjectURL(e.file),e.this.querySelector(".modal").style.display="flex";let t=await matcher.external.func.crop.cropUrl(e);if("moderator-admin"===e.slot)for(let e=0;e<n["lacerta-moderator"].length;e++)switch(n["lacerta-moderator"][e].slot){case"moderator-admin":n["lacerta-moderator"][e].upload={},n["lacerta-moderator"][e].upload.img=t.dataURL,n["lacerta-moderator"][e].img.src=t.dataURL,r({crop:"true"});break;default:console.warn("~~~~~~~~~","На этот объект нет действия ",n["varan-editor"][e].slot)}else if("card-admin"===e.slot)for(let e=0;e<n["varan-card-news"].length;e++)switch(n["varan-card-news"][e].slot){case"card-admin":n["varan-card-news"][e].img.src=t.dataURL,r({crop:"true"});break;default:console.warn("~~~~~~~~~","На этот объект нет действия ",n["varan-editor"][e].slot)}else if("lacerta-news"===e.slot)for(let e=0;e<n["lacerta-news"].length;e++)switch(n["lacerta-news"][e].slot){case"news-admin":n["lacerta-news"][e].upload={},n["lacerta-news"][e].upload.img=t.dataURL,n["lacerta-news"][e].img.src=t.dataURL,r({crop:"true"});break;default:console.warn("~~~~~~~~~","На этот объект нет действия ",n["varan-editor"][e].slot)}else switch(e.slot){case"telegram-login":null===t.this.shadowRoot.querySelector(".imageAvatar")||t.this.shadowRoot.querySelector(".imageAvatar").remove(),t.this.shadowRoot.querySelector(".avatar").insertAdjacentHTML("afterbegin",`\n                                                    <img class="imageAvatar" src="${t.file.dataURL}">\n                                                    \n                                                    `);let a=new CustomEvent("telegram-login-action",{detail:{photo:t.file}});document.dispatchEvent(a),r({crop:"true"});break;case"monopoly-struct":document.dispatchEvent(new CustomEvent("monopoly-struct",{detail:{photo:t}})),r({crop:"true"});break;default:console.warn("необрабатываемое событие",e.slot)}}break;default:i(`необрабатываемый тип запроса ${e[a]}`)}}catch(e){i(e)}})(e,a[0],a[1],a[2],a[3]);break;case"get":(async(e,t,n)=>{try{switch(console.log(`${n}(${e.input})${e[t]}]`),e[t]){case"manifest":let n=document.body.shadowRoot.querySelectorAll("slot");r(n);break;case"jsonPhoto":let o=await matcher.mongo({input:"action",type:"jsonPhoto"},"get","type");r(o);break;case"lazyImg":let c=await matcher.mongo({input:"action",type:"img",data:e.data},"get","type");r(c);break;case"feeds":let s=await matcher.mongo({input:"action",relation:e.input,type:"feeds"},"get","type");r(s);break;case"yandex":r(feed({input:"action",relation:e.input,data:e.data,type:"yandex"},"get","type"));break;case"bids":let d=null,l={};if(l=await matcher.mongo({input:"action",relation:e.input,type:"bids"},"get","type"),null===(d=await fetch(`${conf.mongo.web}/bid`))||"rss not found"===await d.text())r(e);else{let e=new config.rssParser,t={};t=await e.parseURL(`${conf.mongo.web}/bid`),r(t.items)}break;case"itemsBid":(async(e,t,a)=>{try{let t=await matcher.mongo({input:"action",type:"itemsBid"},"get","type");r(t)}catch(e){i(e)}})(0,a[0],a[1],a[2],a[3]);break;case"newsTemplate":(async(e,t,a)=>{try{isEmpty(e.name)&&(e.name="default");let t={};if(0===(t=await feed({input:"action",type:"feeds"},"get","type")).mongo.length)r(e);else{let e=new config.rssParser,t={};t=await e.parseURL(conf.mongo.web),r(t.items)}}catch(e){i(e)}})(e,a[0],a[1],a[2],a[3]);break;default:i(`необрабатываемый тип запроса ${e[t]}`)}}catch(e){i(e)}})(e,a[0],a[1],a[2],a[3]);break;case"convert":(async(e,a,n)=>{try{switch(console.log(`${e.input}[${t}][(action)${e[a]}]`),e[a]){case"rss":r(feed({input:"action",relation:e.input,data:e.data,type:"rss"},"convert","type"));break;case"light":break;default:i(`необрабатываемый тип запроса ${e[a]}`)}}catch(e){i(e)}})(e,a[0],a[1],a[2],a[3]);break;case"create":(async(e,n,o)=>{try{console.log(`${t}[(${e.input})${e[n]}]`);let o={},c={},s={};switch(e[n]){case"jsonPhoto":e.this.shadowRoot.querySelector("section").innerHTML="";for(let t=0;t<e.data.length;t++){let a=`\n                                                <div class="gallery-item">\n                                                    <img class="lazy" src="./static/html/components/lacerta-gallery/images/empty.jpeg" data-src="${e.data[t].filename.split("/")[2]}" data-srcset="${e.data[t].filename.split("/")[2]}" alt="gallery">\n                                                </div>`;e.this.shadowRoot.querySelector("section").insertAdjacentHTML("beforeend",a)}console.log(e.this.shadowRoot.querySelector("section")),r("sds");break;case"channel":let t=await staticProperty({input:"action",object:["sidebar",e.id],type:"object"},"get","type"),d=await feed({input:"action",type:"channel"},"create","type");await matcher.mongo({input:"action",data:JSON.stringify(d),type:"channel"},"create","type"),r(d);break;case"itemFeed":0!==(c=await matcher.mongo({input:"action",relation:e.input,type:"feeds"},"get","type")).mongo.length&&-2!==c.mongo.status||console.warn("нет ленты новостей");let l={};await isEmpty(c.mongo)?(console.warn("нет канала"),i("нет канала")):(l=c.mongo[0]._id,config.parseString.parseString(c.mongo[0].feed.rss,async function(t,a){let n=[];if(!0===isEmpty(a.rss.channel[0].item)){let t=await feed({input:"action",feed:c.mongo[0].feed,type:"item",data:e.data},"create","type");await matcher.mongo({input:"action",data:JSON.stringify(t.item),id:t.feed.option.category,type:"item"},"create","type"),t.feed.rss=t.feed.rss.replace(/<!\[CDATA\[/g,"").replace(/]]>/g,""),await matcher.mongo({input:"action",id:l,data:JSON.stringify(t.feed),type:"feed"},"update","type"),location.reload(),r(s)}else{for(let e=0;e<a.rss.channel[0].item.length;e++){a.rss.channel[0].item[e].title||(a.rss.channel[0].item[e].title={},a.rss.channel[0].item[e].title[0]="отсутствует");let t=`    <item>\n            <title>${a.rss.channel[0].item[e].title[0]}</title>\n            <guid>${a.rss.channel[0].item[e].guid[0]}</guid>\n             <link>${a.rss.channel[0].item[e].link[0]}</link>\n            <pubDate>${a.rss.channel[0].item[e].pubDate[0]}</pubDate>\n            <description>${a.rss.channel[0].item[e].description[0]}</description>\n            <content:encoded>${a.rss.channel[0].item[e]["content:encoded"][0]}</content:encoded>\n            <author>${a.rss.channel[0].item[e].author[0]}</author>\n            <enclosure url="${a.rss.channel[0].item[e].enclosure[0].$.url}"/>\n</item>`;n.push(t)}let t=await feed({input:"action",feed:c.mongo[0].feed,type:"item",data:e.data},"create","type"),i=t.feed.rss.substr(0,t.feed.rss.indexOf("</channel>"));for(let e=0;e<n.length;e++)i+=n[e];i+=" </channel>\n                                                      </rss>",t.feed.rss=i,o=await matcher.mongo({input:"action",id:l,data:JSON.stringify(t.feed),type:"feed"},"update","type"),await matcher.mongo({input:"action",data:JSON.stringify(t.item),id:t.feed.option.category,type:"item"},"create","type"),location.reload(),r(o)}}));break;case"itemBid":(async(e,t,a)=>{c=await matcher.mongo({input:"action",relation:e.input,type:"bids"},"get","type");let n={};(await isEmpty(c.mongo)||"null"===c.mongo)&&(o=await feed({input:"action",type:"channel",name:"bid"},"create","type"),await matcher.mongo({input:"action",data:JSON.stringify(o),type:"bidChanel",name:"bid"},"create","type"),console.assert(!1,o),c=await matcher.mongo({input:"action",relation:e.input,type:"bids"},"get","type")),n=c.mongo[0]._id,config.parseString.parseString(c.mongo[0].feed.rss,async function(t,a){let i=[];if(!0===isEmpty(a.rss.channel[0].item)){let t=await feed({input:"action",feed:c.mongo[0].feed,type:"item",data:e.data},"create","type");t.item.details={price:e.data.description.price,time:e.data.description.time},await matcher.mongo({input:"action",data:JSON.stringify(t.item),id:t.feed.option.category,type:"bid"},"create","type"),t.feed.rss=t.feed.rss.replace(/<!\[CDATA\[/g,"").replace(/]]>/g,""),await matcher.mongo({input:"action",id:n,data:JSON.stringify(t.feed),type:"bid"},"update","type"),location.reload(),r(s)}else{for(let e=0;e<a.rss.channel[0].item.length;e++){a.rss.channel[0].item[e].title||(a.rss.channel[0].item[e].title={},a.rss.channel[0].item[e].title[0]="отсутствует");let t=`    <item>\n            <title>${a.rss.channel[0].item[e].title[0]}</title>\n            <guid>${a.rss.channel[0].item[e].guid[0]}</guid>\n             <link>${a.rss.channel[0].item[e].link[0]}</link>\n            <pubDate>${a.rss.channel[0].item[e].pubDate[0]}</pubDate>\n            <description>${a.rss.channel[0].item[e].description[0]}</description>\n            <content:encoded>${a.rss.channel[0].item[e]["content:encoded"][0]}</content:encoded>\n            <author>${a.rss.channel[0].item[e].author[0]}</author>\n            <enclosure url="${a.rss.channel[0].item[e].enclosure[0].$.url}"/>\n</item>`;i.push(t)}let t=await feed({input:"action",feed:c.mongo[0].feed,type:"item",data:e.data},"create","type");t.item.details={price:e.data.description.price,time:e.data.description.time};let s=t.feed.rss.substr(0,t.feed.rss.indexOf("</channel>"));for(let e=0;e<i.length;e++)s+=i[e];s+=" </channel>\n                                                      </rss>",t.feed.rss=s,o=await matcher.mongo({input:"action",id:n,data:JSON.stringify(t.feed),type:"bid"},"update","type"),await matcher.mongo({input:"action",data:JSON.stringify(t.item),id:t.feed.option.category,type:"bid"},"create","type"),location.reload(),r(o)}})})(e,a[0],a[1],a[2],a[3]);break;case"background":t=await staticProperty({input:"action",type:"object"},"getObject",e.id);let p=URL.createObjectURL(e.file);t.self.querySelector(".wall").style.background=`url(${p})`,t.self.querySelector(".wall").style.backgroundSize="100%",r(e);break;default:i(`необрабатываемый тип запроса ${e[n]}`)}}catch(e){i(e)}})(e,a[0],a[1],a[2],a[3]);break;case"set":(async(e,t,a)=>{try{switch(console.log(`${e.input}[(action)${e[t]}]`),e[t]){case"store":r(await staticProperty({input:e.input,obj:e,type:"obj",name:e.input},"set","type"));break;case"IntersectionObserver":r(IntersectionObserver({input:"action",type:"observer",this:e.this,target:e.target},"set","type"));break;default:i(`необрабатываемый тип запроса set ${e[t]}`)}}catch(e){i(e)}})(e,a[0],a[1],a[2],a[3]);break;case"delete":(async(e,t,n)=>{try{console.log(`${e.input}[(action)${e[t]}]`);let n={};switch(e[t]){case"news":n=await staticProperty({input:"action",type:"all"},"get","type");let o=await matcher.mongo({input:"action",relation:e.input,type:"feeds"},"get","type"),c=await feed({input:"action",relation:e.input,data:o.mongo[0].feed.rss,func:config.parseString.parseString,type:"items"},"get","type"),s=await feed({input:"action",relation:e.input,data:c,target:e.date.utc,type:"item"},"search","type"),d=await feed({input:"action",feed:o.mongo[0].feed,items:s.feed,type:"feed"},"create","type");o.mongo[0].feed.rss=d;let l=o.mongo[0]._id;await matcher.mongo({input:"action",relation:e.input,id:l,data:JSON.stringify(o.mongo[0].feed),type:"feed"},"update","type"),await matcher.mongo({input:"action",id:{date:e.date.iso},type:"item"},"delete","type"),e.remove.remove(),r(d);break;case"bid":(async(e,t,a)=>{n=await staticProperty({input:"action",type:"all"},"get","type");let o=await matcher.mongo({input:"action",relation:e.input,type:"bids"},"get","type"),i=await feed({input:"action",relation:e.input,data:o.mongo[0].feed.rss,func:config.parseString.parseString,type:"items"},"get","type"),c=await feed({input:"action",relation:e.input,data:i,target:e.date.utc,type:"item"},"search","type"),s=await feed({input:"action",feed:o.mongo[0].feed,items:c.feed,type:"feed"},"create","type");o.mongo[0].feed.rss=s;let d=o.mongo[0]._id;await matcher.mongo({input:"action",relation:e.input,id:d,data:JSON.stringify(o.mongo[0].feed),type:"bid"},"update","type"),await matcher.mongo({input:"action",id:{date:e.date.iso},type:"itemBid"},"delete","type"),e.remove.remove(),r(s)})(e,a[0],a[1],a[2],a[3]);break;case"moderator":await matcher.webdav({input:"action",type:"moderator",data:e.date,path:`/moderator/${e.date}`},"delete","type"),r({delete:"ok"});break;default:i(`необрабатываемый тип запроса set ${e[t]}`)}}catch(e){i(e)}})(e,a[0],a[1],a[2],a[3]);break;case"update":(async(e,t,n)=>{try{console.log(`${e.input}[(action)${e[t]}]`);let n={};switch(e[t]){case"bid":(async(e,t,a)=>{let o=await matcher.mongo({input:"action",type:"bidItem",date:e.date.iso},"get","type");n=await staticProperty({input:"action",type:"all"},"get","type");let r={},i=o.mongo.item.image,c=o.mongo.item.title,s=o.mongo.item.details.time,d=o.mongo.item.details.price,l=await utils({input:"varan-menu",data:o.mongo.item.content_html,type:"string2html"},"convert","type"),p=await utils({input:"varan-menu",data:o.mongo.item.summary,type:"string2html"},"convert","type");for(let t=0;t<n["varan-card-news"].length;t++)switch(n["varan-card-news"][t].slot){case"card-admin":let a=n["varan-card-news"][t].this.shadowRoot.querySelectorAll(".section")[1];a.querySelector(".nameBid").value=c,a.querySelector(".imgBidAdmin").src=i,a.querySelector(".timerValue").value=s,a.querySelector(".priceValue").value=d,console.log(e.date.timestamp);let o=a.querySelector(".item").className;o=`${o}_${e.date.timestamp}`,a.querySelector(".item").className=o;break;default:console.warn("~~~~~~~~~","На этот объект нет действия ",n["varan-editor"][t].slot)}let m={};for(let e=0;e<n["varan-editor"].length;e++)switch(n["varan-editor"][e].slot){case"cardDescription":r.description=p,null===(m=null===n["varan-editor"][e].menu.querySelector(".menu-convert")||"null"===n["varan-editor"][e].menu.querySelector(".menu-convert")?n["varan-editor"][e].menu.shadowRoot:n["varan-editor"][e].menu).querySelector(".update")?(m.querySelector(".menu-convert").insertAdjacentHTML("afterend",'<button class="update" type="button">update</button>'),addEventListener({input:"action",type:"menu-update",data:m.querySelector(".update")},"add","type")):(m.querySelector(".update").remove(),m.querySelector(".menu-convert").insertAdjacentHTML("afterend",'<button class="update" type="button">update</button>'),addEventListener({input:"action",type:"menu-update",data:m.querySelector(".update")},"add","type")),n["varan-editor"][e].obj.this.querySelector(".wall").innerHTML=r.description,n["varan-editor"][e].editor.quill.root.innerHTML=r.description;break;case"cardContent":r.content=l,null===(m=null===n["varan-editor"][e].menu.querySelector(".menu-convert")||"null"===n["varan-editor"][e].menu.querySelector(".menu-convert")?n["varan-editor"][e].menu.shadowRoot:n["varan-editor"][e].menu).querySelector(".update")?(m.querySelector(".menu-convert").insertAdjacentHTML("afterend",'<button class="update" type="button">update</button>'),addEventListener({input:"action",type:"menu-update",data:m.querySelector(".update")},"add","type")):(m.querySelector(".update").remove(),m.querySelector(".menu-convert").insertAdjacentHTML("afterend",'<button class="update" type="button">update</button>'),addEventListener({input:"action",type:"menu-update",data:m.querySelector(".update")},"add","type")),n["varan-editor"][e].obj.this.querySelector(".wall").innerHTML=r.content,n["varan-editor"][e].editor.quill.root.innerHTML=r.content;break;default:console.warn("~~~~~~~~~","На этот объект нет действия ",n["varan-editor"][e].slot)}e.button.innerText="данные в редакторe",setTimeout(()=>{e.button.innerText="изменить",e.button.disabled=!1},2e3)})(e,a[0],a[1],a[2],a[3]);break;case"news":let o=await matcher.mongo({input:"action",type:"feeds"},"get","type"),r=o.mongo[0]._id,c=await feed({input:"action",data:o.mongo[0].feed.rss,func:config.parseString.parseString,type:"items"},"get","type"),s=await feed({input:"action",data:c,target:e.date.utc,type:"item"},"search","type");n=await staticProperty({input:"action",type:"all"},"get","type"),s._id=r;let d={},l=s.remove.enclosure[0].$.url,p="нет заголовка";s.remove.title&&(p=s.remove.title);for(let e=0;e<n["lacerta-news"].length;e++)switch(n["lacerta-news"][e].slot){case"news-admin":n["lacerta-news"][e].this.shadowRoot.querySelector(".gallery").src=l,n["lacerta-news"][e].this.shadowRoot.querySelector("#titleItem").value=p;break;default:console.warn("~~~~~~~~~","На этот объект нет действия ",n["varan-editor"][e].slot)}let m={};for(let e=0;e<n["varan-editor"].length;e++)switch(n["varan-editor"][e].slot){case"description":d.description=await utils({input:"varan-menu",data:s.remove.description[0],type:"string2html"},"convert","type"),null===(m=null===n["varan-editor"][e].menu.querySelector(".menu-convert")||"null"===n["varan-editor"][e].menu.querySelector(".menu-convert")?n["varan-editor"][e].menu.shadowRoot:n["varan-editor"][e].menu).querySelector(".update")?(m.querySelector(".menu-convert").insertAdjacentHTML("afterend",'<button class="update" type="button">update</button>'),addEventListener({input:"action",type:"menu-update",data:m.querySelector(".update")},"add","type")):(m.querySelector(".update").remove(),m.querySelector(".menu-convert").insertAdjacentHTML("afterend",'<button class="update" type="button">update</button>'),addEventListener({input:"action",type:"menu-update",data:m.querySelector(".update")},"add","type")),n["varan-editor"][e].obj.this.querySelector(".wall").innerHTML=d.description,n["varan-editor"][e].editor.quill.root.innerHTML=d.description;break;case"content":d.content=await utils({input:"varan-menu",data:s.remove["content:encoded"][0],type:"string2html"},"convert","type"),null===(m=null===n["varan-editor"][e].menu.querySelector(".menu-convert")||"null"===n["varan-editor"][e].menu.querySelector(".menu-convert")?n["varan-editor"][e].menu.shadowRoot:n["varan-editor"][e].menu).querySelector(".update")?(m.querySelector(".menu-convert").insertAdjacentHTML("afterend",'<button class="update" type="button">update</button>'),addEventListener({input:"action",type:"menu-update",data:m.querySelector(".update")},"add","type")):(m.querySelector(".update").remove(),m.querySelector(".menu-convert").insertAdjacentHTML("afterend",'<button class="update" type="button">update</button>'),addEventListener({input:"action",type:"menu-update",data:m.querySelector(".update")},"add","type")),n["varan-editor"][e].obj.this.querySelector(".wall").innerHTML=d.content,n["varan-editor"][e].editor.quill.root.innerHTML=d.content;break;default:console.warn("~~~~~~~~~","На этот объект нет действия ",n["varan-editor"][e].slot)}for(let t=0;t<n["lacerta-news"].length;t++)switch(n["lacerta-news"][t].slot){case"news-admin":n["lacerta-news"][t].obj.this.shadowRoot.querySelector(".date").innerHTML=e.date.timestamp}e.button.innerText="данные в редакторe",setTimeout(()=>{e.button.innerText="изменить",e.button.disabled=!1},2e3);break;case"news-item":n=await staticProperty({input:"action",type:"all"},"get","type");let u=await matcher.mongo({input:"action",type:"feeds"},"get","type"),y=(u.mongo[0]._id,await feed({input:"action",relation:e.input,data:u.mongo[0].feed.rss,func:config.parseString.parseString,type:"items"},"get","type")),g=await feed({input:"action",data:y,target:e.date.utc,type:"item"},"search","type");g.remove["content:encoded"][0]=e.data.content,g.remove.description[0]=e.data.short_content,g.remove.enclosure[0].$.url=e.data.image.data,g.remove.title[0]=e.data.title,g.feed.unshift(g.remove);let h=await feed({input:"action",feed:u.mongo[0].feed,items:g.feed,type:"feed"},"create","type");u.mongo[0].feed.rss=h;let f=u.mongo[0]._id,w=(await matcher.mongo({input:"action",id:f,data:JSON.stringify(u.mongo[0].feed),type:"feed"},"update","type"),await matcher.mongo({input:"action",type:"item",id:e.date.iso},"get","type"));null===w.mongo?console.warn("нет id для обновления"):(w.mongo.item.content_html=e.data.content,w.mongo.item.summary=e.data.short_content,w.mongo.item.image=e.data.image.data,w.mongo.item.title=e.data.title,await matcher.mongo({input:"action",id:e.date.iso,data:JSON.stringify(w.mongo.item),type:"item"},"update","type"));let v=await utils({input:"varan-menu",data:e.data.content,type:"string2html"},"convert","type"),b=await utils({input:"varan-menu",data:e.data.short_content,type:"string2html"},"convert","type");for(let t=0;t<n["lacerta-news"].length;t++)switch(n["lacerta-news"][t].slot){case"lacerta-news":let a=n["lacerta-news"][t].obj.this.shadowRoot.querySelector("#news").children;for(let t=0;t<a.length;t++){let n=a[t].querySelector(".timestamp").innerText;if(n=+n,e.date.timestamp===n){let n=a[t];n.querySelector(".gallery").src=e.data.image.data,n.querySelector(".title").innerText=e.data.title,n.querySelector(".contentOut").innerHTML="",n.querySelector(".contentOut").insertAdjacentHTML("beforeend",v),n.querySelector(".preview").innerHTML="",n.querySelector(".preview").insertAdjacentHTML("beforeend",b)}}let o={};for(let e=0;e<n["varan-editor"].length;e++)switch(n["varan-editor"][e].slot){case"description":case"content":null===(o=n["varan-editor"][e].obj.this.querySelector("varan-menu")).shadowRoot||void 0===o.shadowRoot||(o=o.shadowRoot),o.querySelector(".menu-convert").disabled=!1,o.querySelector(".menu-convert").style.backgroundColor="#e1e1e1",o.querySelector(".menu-save").disabled=!1,o.querySelector(".menu-save").style.backgroundColor="#e1e1e1",o.querySelector(".update").remove()}break;default:console.warn("~~~~~~~~~","На этот объект нет действия ",n["varan-editor"][t].slot)}break;case"bid-item":(async(e,t,a)=>{n=await staticProperty({input:"action",type:"all"},"get","type");let o=await matcher.mongo({input:"action",type:"bids"},"get","type"),r=(o.mongo[0]._id,await feed({input:"action",relation:e.input,data:o.mongo[0].feed.rss,func:config.parseString.parseString,type:"items"},"get","type")),i=await feed({input:"action",data:r,target:e.date.utc,type:"item"},"search","type");i.remove["content:encoded"][0]=e.data.content,i.remove.description[0]=e.data.short_content,i.remove.enclosure[0].$.url=e.data.image.data,i.remove.title[0]=e.data.title,i.feed.unshift(i.remove);let c=await feed({input:"action",feed:o.mongo[0].feed,items:i.feed,type:"feed"},"create","type");o.mongo[0].feed.rss=c;let s=o.mongo[0]._id,d=(await matcher.mongo({input:"action",id:s,data:JSON.stringify(o.mongo[0].feed),type:"bid"},"update","type"),await matcher.mongo({input:"action",type:"bidItem",date:e.date.iso},"get","type"));null===d.mongo?console.warn("нет id для обновления"):(d.mongo.item.content_html=e.data.content,d.mongo.item.summary=e.data.short_content,d.mongo.item.image=e.data.image.data,d.mongo.item.title=e.data.title,d.mongo.item.details.price=e.data.price,d.mongo.item.details.time=e.data.time,await matcher.mongo({input:"action",id:e.date.iso,data:JSON.stringify(d.mongo.item),type:"itemBid"},"update","type")),await utils({input:"varan-menu",data:e.data.content,type:"string2html"},"convert","type"),await utils({input:"varan-menu",data:e.data.short_content,type:"string2html"},"convert","type");for(let t=0;t<n["varan-card-news"].length;t++)switch(n["varan-card-news"][t].slot){case"card-admin":let a=n["varan-card-news"][t].this.shadowRoot.querySelectorAll(".section")[0].children;for(let t=0;t<a.length;t++){let n=+a[t].className.split("_")[1];if(e.date.timestamp===n){let n=a[t];n.querySelector(".preview").innerHTML="",n.querySelector(".preview").innerText=e.data.title,n.querySelector(".imgBid").src=e.data.image.data,n.querySelector(".timer").innerText="",n.querySelector(".timer").innerText=`00:${e.data.time}:00`,n.querySelector(".price").innerText="",n.querySelector(".price").innerText=`Waves: ${e.data.price}`}}let o={};for(let e=0;e<n["varan-editor"].length;e++)switch(n["varan-editor"][e].slot){case"cardDescription":case"cardContent":null===(o=n["varan-editor"][e].this.querySelector("varan-menu")).shadowRoot||void 0===o.shadowRoot||(o=o.shadowRoot),o.querySelector(".menu-convert").disabled=!1,o.querySelector(".menu-convert").style.backgroundColor="#e1e1e1",o.querySelector(".menu-save").disabled=!1,o.querySelector(".menu-save").style.backgroundColor="#e1e1e1",o.querySelector(".update").remove()}break;default:console.warn("~~~~~~~~~","На этот объект нет действия ",n["varan-editor"][t].slot)}})(e,a[0],a[1],a[2],a[3]);break;default:i(`необрабатываемый тип запроса set ${e[t]}`)}}catch(e){i(e)}})(e,a[0],a[1],a[2],a[3]);break;default:i(`новая функция ${t}`)}});