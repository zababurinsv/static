import mInterface from"./interface.mjs";import monopoly from"./monopoly.mjs";import auction from"./auction.mjs";import classicedition from"./classicedition.mjs";export default{get:(e,t,...o)=>new Promise((o,l)=>{function r(e){o(e)}switch(e.type){case"resetTrade":(async(e,t,o)=>{let l,n,a,i,s,d,p,c;t.currentSquare={},t.currentTableRow={},t.currentTableCell={},t.currentTableCellCheckbox={},t.nameSelect={},t.currentOption={},t.allGroupUninproved={},t.currentName={};let y=function(e){t.this.querySelector("#proposetradebutton").style.display="flex",t.this.querySelector("#canceltradebutton").style.display="flex",t.this.querySelector("#accepttradebutton").style.display="none",t.this.querySelector("#rejecttradebutton").style.display="none"},u=function(e){let o=e.target.parentNode;o=o.querySelector("input"),t.checkboxElement=o,t.checkboxElement!==e.srcElement&&(t.checkboxElement.checked=!t.checkboxElement.checked),t.this.querySelector("#proposetradebutton").style.display="flex",t.this.querySelector("#canceltradebutton").style.display="flex",t.this.querySelector("#accepttradebutton").style.display="none",t.this.querySelector("#rejecttradebutton").style.display="none"},h=t.this.getElementById("trade-leftp-property"),m=t.this.getElementById("trade-rightp-property");for(t.tradeObj.currentInitiator=t.tradeObj.initiator,t.tradeObj.currentRecipient=t.tradeObj.recipient;h.lastChild;)h.removeChild(h.lastChild);for(;m.lastChild;)m.removeChild(m.lastChild);let g=document.createElement("table"),b=document.createElement("table");for(let o=0;o<40;o++){if((l=t.square[o]).house>0||0===l.groupNumber)continue;p=!0;let r=l.group.length;for(let e=0;e<r;e++)if(t.square[l.group[e]].house>0){p=!1;break}p&&(l.owner===e.initiator.index?((n=g.appendChild(document.createElement("tr"))).addEventListener("click",u),(a=n.appendChild(document.createElement("td"))).className="propertycellcheckbox",(i=a.appendChild(document.createElement("input"))).type="checkbox",i.id="tradeleftcheckbox"+o,i.title="Check this box to include "+l.name+" in the trade.",(a=n.appendChild(document.createElement("td"))).className="propertycellcolor",a.setAttribute("show",o),a.style.backgroundColor=l.color,1==l.groupNumber||2==l.groupNumber?a.style.borderColor="grey":a.style.borderColor=l.color,a.propertyIndex=o,a.onmouseover=async function(e){await mInterface.get({type:"showdeed",property:e.target.getAttribute("show")},t)},a.onmouseout=function(e){t.this.querySelector("#deed").style.display="none"},(a=n.appendChild(document.createElement("td"))).className="propertycellname",l.mortgage&&(a.title="Mortgaged",a.style.color="grey"),a.textContent=l.name):l.owner===t.tradeObj.recipient.index&&((n=b.appendChild(document.createElement("tr"))).addEventListener("click",u),(a=n.appendChild(document.createElement("td"))).className="propertycellcheckbox",(i=a.appendChild(document.createElement("input"))).type="checkbox",i.id="traderightcheckbox"+o,i.title="Check this box to include "+l.name+" in the trade.",(a=n.appendChild(document.createElement("td"))).className="propertycellcolor",a.setAttribute("show",o),a.style.backgroundColor=l.color,1==l.groupNumber||2==l.groupNumber?a.style.borderColor="grey":a.style.borderColor=l.color,a.propertyIndex=o,a.onmouseover=async function(e){await mInterface.get({type:"showdeed",property:e.target.getAttribute("show")},t)},a.onmouseout=function(){t.this.querySelector("#deed").style.display="none"},(a=n.appendChild(document.createElement("td"))).className="propertycellname",l.mortgage&&(a.title="Mortgaged",a.style.color="grey"),a.textContent=l.name))}if(t.tradeObj.initiator.communityChestJailCard?((n=g.appendChild(document.createElement("tr"))).addEventListener("click",u),(a=n.appendChild(document.createElement("td"))).className="propertycellcheckbox",(i=a.appendChild(document.createElement("input"))).type="checkbox",i.id="tradeleftcheckbox40",i.title="Check this box to include this Get Out of Jail Free Card in the trade.",(a=n.appendChild(document.createElement("td"))).className="propertycellcolor",a.style.backgroundColor="white",a.style.borderColor="grey",(a=n.appendChild(document.createElement("td"))).className="propertycellname",a.textContent="Get Out of Jail Free Card"):t.tradeObj.recipient.communityChestJailCard&&((n=b.appendChild(document.createElement("tr"))).addEventListener("click",u),(a=n.appendChild(document.createElement("td"))).className="propertycellcheckbox",(i=a.appendChild(document.createElement("input"))).type="checkbox",i.id="traderightcheckbox40",i.title="Check this box to include this Get Out of Jail Free Card in the trade.",(a=n.appendChild(document.createElement("td"))).className="propertycellcolor",a.style.backgroundColor="white",a.style.borderColor="grey",(a=n.appendChild(document.createElement("td"))).className="propertycellname",a.textContent="Get Out of Jail Free Card"),t.tradeObj.initiator.chanceJailCard?((n=g.appendChild(document.createElement("tr"))).addEventListener("click",u),(a=n.appendChild(document.createElement("td"))).className="propertycellcheckbox",(i=a.appendChild(document.createElement("input"))).type="checkbox",i.id="tradeleftcheckbox41",i.title="Check this box to include this Get Out of Jail Free Card in the trade.",(a=n.appendChild(document.createElement("td"))).className="propertycellcolor",a.style.backgroundColor="white",a.style.borderColor="grey",(a=n.appendChild(document.createElement("td"))).className="propertycellname",a.textContent="Get Out of Jail Free Card"):t.tradeObj.recipient.chanceJailCard&&((n=b.appendChild(document.createElement("tr"))).addEventListener("click",u),(a=n.appendChild(document.createElement("td"))).className="propertycellcheckbox",(i=a.appendChild(document.createElement("input"))).type="checkbox",i.id="traderightcheckbox41",i.title="Check this box to include this Get Out of Jail Free Card in the trade.",(a=n.appendChild(document.createElement("td"))).className="propertycellcolor",a.style.backgroundColor="white",a.style.borderColor="grey",(a=n.appendChild(document.createElement("td"))).className="propertycellname",a.textContent="Get Out of Jail Free Card"),g.lastChild?h.appendChild(g):h.textContent=t.tradeObj.initiator.name+" has no properties to trade.",b.lastChild?m.appendChild(b):m.textContent=t.tradeObj.recipient.name+" has no properties to trade.",t.this.getElementById("trade-leftp-name").textContent=t.tradeObj.initiator.name,c=t.this.getElementById("trade-rightp-name"),e.allowRecipientToBeChanged&&t.pcount>2){for(;c.lastChild;)c.removeChild(c.lastChild);s=c.appendChild(document.createElement("select"));for(let e=1;e<=t.pcount;e++)e!==t.tradeObj.initiator.index&&((d=s.appendChild(document.createElement("option"))).value=e+"",d.style.color=t.player[e].color,d.textContent=t.player[e].name,e===t.tradeObj.recipient.index&&(d.selected="selected"));s.onchange=async function(e){let o=parseInt(e.target.value,10);await mInterface.get({type:"getTrade"},t),t.tradeObj.recipient=t.player[o],t.tradeObj.currentRecipient=t.player[o],await monopoly.get({type:"resetTrade",initiator:t.tradeObj.currentInitiator,recipient:t.player[o],allowRecipientToBeChanged:!0},t)},s.title="Select a player to trade with."}else c.textContent=t.tradeObj.recipient.name;t.this.getElementById("trade-leftp-money").value="0",t.this.getElementById("trade-leftp-money").addEventListener("input",y),t.this.getElementById("trade-rightp-money").value="0",t.this.getElementById("trade-rightp-money").addEventListener("input",y),r(!0)})(e,t);break;case"proposeTrade":(async(e,t,o)=>{if(isNaN(t.this.getElementById("trade-leftp-money").value))return t.this.getElementById("trade-leftp-money").value="This value must be a number.",t.this.getElementById("trade-leftp-money").style.color="red",!1;if(isNaN(t.this.getElementById("trade-rightp-money").value))return t.this.getElementById("trade-rightp-money").value="This value must be a number.",t.this.getElementById("trade-rightp-money").style.color="red",!1;let l=readTrade(),r=l.getMoney(),n=l.getInitiator(),a=l.getRecipient(),i=[];if(r>0&&r>n.money)return t.this.getElementById("trade-leftp-money").value=n.name+" does not have $"+r+".",t.this.getElementById("trade-leftp-money").style.color="red",!1;if(r<0&&-r>a.money)return t.this.getElementById("trade-rightp-money").value=a.name+" does not have $"+-r+".",t.this.getElementById("trade-rightp-money").style.color="red",!1;let s=0;for(let e=0;e<40;e++)i[e]=-l.getProperty(e),s|=l.getProperty(e);if(s|=l.getCommunityChestJailCard(),0===(s|=l.getChanceJailCard()))return popup("<p>One or more properties must be selected in order to trade.</p>"),!1;if(n.human&&!confirm(n.name+", are you sure you want to make this offer to "+a.name+"?"))return!1;let d=new Trade(a,n,-r,i,-l.getCommunityChestJailCard(),-l.getChanceJailCard());if(a.human)writeTrade(d),t.this.querySelector("#proposetradebutton").style.display="none",t.this.querySelector("#canceltradebutton").style.display="none",t.this.querySelector("#accepttradebutton").style.display="flex",t.this.querySelector("#rejecttradebutton").style.display="flex",addAlert(n.name+" initiated a trade with "+a.name+"."),popup("<p>"+n.name+" has proposed a trade with you, "+a.name+". You may accept, reject, or modify the offer.</p>");else{let e=a.AI.acceptTrade(l);if(!0===e)popup("<p>"+a.name+" has accepted your offer.</p>"),this.acceptTrade(d);else{if(!1===e)return void popup("<p>"+a.name+" has declined your offer.</p>");e instanceof Trade&&(popup("<p>"+a.name+" has proposed a counteroffer.</p>"),writeTrade(e),$("#proposetradebutton, #canceltradebutton").hide(),$("#accepttradebutton").show(),$("#rejecttradebutton").show())}}})(0,t);break;case"gotojail":(async(e,t,o)=>{let l=t.player[t.turn];await monopoly.get({type:"addAlert",value:`${l.name} was sent directly to jail.`},t),t.this.getElementById("landed").innerHTML="You are in jail.",l.jail=!0,t.doublecount=0,t.this.getElementById("nextbutton").value="End turn",t.this.getElementById("nextbutton").title="End turn and advance to the next player.",l.human&&t.this.getElementById("nextbutton").focus(),await monopoly.get({type:"updatePosition",player:l},t),await monopoly.get({type:"updateOwned",value:""},t),l.human||(popup(l.AI.alertList,game.next),l.AI.alertList="")})(0,t);break;case"showdeed":(async(e,t,o)=>{let l=t.square[e.property];t.this.querySelector("#deed").style.display="flex",t.this.querySelector("#deed-normal").style.display="none",t.this.querySelector("#deed-mortgaged").style.display="none",t.this.querySelector("#deed-special").style.display="none",l.mortgage?(t.this.querySelector("#deed-mortgaged").style.display="flex",t.this.getElementById("deed-mortgaged-name").textContent=l.name,t.this.getElementById("deed-mortgaged-mortgage").textContent=l.price/2):l.groupNumber>=3?(t.this.querySelector("#deed-normal").style.display="flex",t.this.getElementById("deed-header").style.backgroundColor=l.color,t.this.getElementById("deed-name").textContent=l.name,t.this.getElementById("deed-baserent").textContent=l.baserent,t.this.getElementById("deed-rent1").textContent=l.rent1,t.this.getElementById("deed-rent2").textContent=l.rent2,t.this.getElementById("deed-rent3").textContent=l.rent3,t.this.getElementById("deed-rent4").textContent=l.rent4,t.this.getElementById("deed-rent5").textContent=l.rent5,t.this.getElementById("deed-mortgage").textContent=l.price/2,t.this.getElementById("deed-houseprice").textContent=l.houseprice,t.this.getElementById("deed-hotelprice").textContent=l.houseprice):2==l.groupNumber?(t.this.querySelector("#deed-special").style.display="flex",t.this.getElementById("deed-special-name").textContent=l.name,t.this.getElementById("deed-special-text").innerHTML=await classicedition.get({type:"utiltext"},t),t.this.getElementById("deed-special-mortgage").textContent=l.price/2):1==l.groupNumber&&(t.this.querySelector("#deed-special").style.display="flex",t.this.getElementById("deed-special-name").textContent=l.name,t.this.getElementById("deed-special-text").innerHTML=await classicedition.get({type:"transtext"},t),t.this.getElementById("deed-special-mortgage").textContent=l.price/2)})(e,t);break;case"land":(async(e,t,o)=>{e.increasedRent=!!e.increasedRent;let l=t.player[t.turn],n=t.square[l.position],a=t.die1,i=t.die2;if(t.this.querySelector("#landed").style.display="flex",t.this.querySelector("#landed").innerHTML="You landed on "+n.name+".",n.landcount++,await mInterface.get({type:"addAlert",value:`${l.name} landed on ${n.name}.`},t),0!==n.price&&0===n.owner&&(l.human?(t.this.querySelector("#landed").innerHTML="<div>You landed on <a href='javascript:void(0);' id='previeCard' class='statscellcolor'>"+n.name+".</a><input type='button' id='buyCards' value='Buy ($"+n.price+")' title='Buy "+n.name+" for "+n.pricetext+".'/></div>",t.this.querySelector("#buyCards").addEventListener("click",async e=>{let o=t.player[t.turn],l=t.square[o.position],r=l.price;if(o.money>=r){let e=[];for(let l=0;l<t.auctionQueue.length;l++)t.auctionQueue[l]===o.position||e.push(t.auctionQueue[l]);t.auctionQueue=e,o.pay(r,0,t),l.owner=t.turn,await mInterface.get({type:"updateMoney"},t),await mInterface.get({type:"addAlert",value:`${o.name} bought ${l.name} for ${l.pricetext}.`},t),await mInterface.get({type:"updateOwned"},t),t.this.querySelector("#landed").style.display="none"}else await mInterface.get({type:"popup",HTML:"<p>"+o.name+", you need $"+(l.price-o.money)+" more to buy "+l.name+".</p>"},t)}),t.this.querySelector("#previeCard").addEventListener("mouseover",async e=>{let o=t.player[t.turn],l=t.square[o.position];t.this.querySelector("#deed").style.display="flex",t.this.querySelector("#deed-special").style.display="none",t.this.querySelector("#deed-normal").style.display="none",t.this.querySelector("#deed-mortgaged").style.display="none",l.mortgage?(t.this.querySelector("#deed-mortgaged").style.display="flex",t.this.getElementById("deed-mortgaged-name").textContent=l.name,t.this.getElementById("deed-mortgaged-mortgage").textContent=l.price/2):l.groupNumber>=3?(t.this.querySelector("#deed-normal").style.display="flex",t.this.getElementById("deed-header").style.backgroundColor=l.color,t.this.getElementById("deed-name").textContent=l.name,t.this.getElementById("deed-baserent").textContent=l.baserent,t.this.getElementById("deed-rent1").textContent=l.rent1,t.this.getElementById("deed-rent2").textContent=l.rent2,t.this.getElementById("deed-rent3").textContent=l.rent3,t.this.getElementById("deed-rent4").textContent=l.rent4,t.this.getElementById("deed-rent5").textContent=l.rent5,t.this.getElementById("deed-mortgage").textContent=l.price/2,t.this.getElementById("deed-houseprice").textContent=l.houseprice,t.this.getElementById("deed-hotelprice").textContent=l.houseprice):2==l.groupNumber?(t.this.querySelector("#deed-special").style.display="flex",t.this.getElementById("deed-special-name").textContent=l.name,t.this.getElementById("deed-special-text").innerHTML=await classicedition.get({type:"utiltext"},t),t.this.getElementById("deed-special-mortgage").textContent=l.price/2):1==l.groupNumber&&(t.this.querySelector("#deed-special").style.display="flex",t.this.getElementById("deed-special-name").textContent=l.name,t.this.getElementById("deed-special-text").innerHTML=await classicedition.get({type:"transtext"},t),t.this.getElementById("deed-special-mortgage").textContent=l.price/2)}),t.this.querySelector("#previeCard").addEventListener("mouseout",e=>{t.this.querySelector("#deed").style.display="none"})):l.AI.buyProperty(l.position)&&await mInterface.get({type:"buy"},t),await mInterface.get({type:"addPropertyToAuctionQueue",propertyIndex:l.position},t)),0===n.owner||n.owner==t.turn||n.mortgage)n.owner>0&&n.owner!=t.turn&&n.mortgage&&(t.this.getElementById("landed").innerHTML="You landed on "+n.name+". Property is mortgaged; no rent was collected.");else{let o,r=!0;if(t.groupowned=!0,5==l.position||15==l.position||25==l.position||35==l.position)e.increasedRent?(o=25,t.rent=25):(t.rent=12.5,o=12.5),n.owner==t.square[5].owner&&(o*=2,t.rent*=2),n.owner==t.square[15].owner&&(o*=2,t.rent*=2),n.owner==t.square[25].owner&&(o*=2,t.rent*=2),n.owner==t.square[35].owner&&(o*=2,t.rent*=2);else if(12===l.position)e.increasedRent||t.square[28].owner==n.owner?(o=10*(a+i),t.rent=10*(a+i)):(o=4*(a+i),t.rent=4*(a+i));else if(28===l.position)e.increasedRent||t.square[12].owner==n.owner?(o=10*(a+i),t.rent=10*(a+i)):(o=4*(a+i),t.rent=4*(a+i));else{for(let e=0;e<40;e++){let o=t.square[e];o.groupNumber==n.groupNumber&&o.owner!=n.owner&&(r=!1,t.groupowned=!1)}r?0===n.house?(o=2*n.baserent,t.rent=2*n.baserent):(o=n["rent"+n.house],t.rent=n["rent"+n.house]):(o=n.baserent,t.rent=n.baserent)}await mInterface.get({type:"addAlert",value:`${l.name} paid $" ${o} rent to. ${t.player[n.owner].name}`},t),l.pay(o,n.owner,t),t.player[n.owner].money+=o,t.this.getElementById("landed").innerHTML="You landed on "+n.name+". "+t.player[n.owner].name+" collected $"+o+" rent."}4===l.position&&await mInterface.get({type:"citytax"},t),30===l.position&&(await mInterface.get({type:"updateMoney"},t),await mInterface.get({type:"updatePosition"},t),l.human?(console.assert(!1),await mInterface.get({type:"popup",HTML:"<div>Go to jail. Go directly to Jail. Do not pass GO. Do not collect $200.</div>",action:async()=>{await mInterface.get({type:"gotojail"},t)},option:null},t)):await mInterface.get({type:"gotojail"},t),r(t)),38===l.position&&await mInterface.get({type:"luxurytax"},t),await mInterface.get({type:"updateMoney"},t),await mInterface.get({type:"updatePosition"},t),await mInterface.get({type:"updateOwned"},t),l.human?await mInterface.get({type:"chanceCommunityChest"},t):(popup(l.AI.alertList,chanceCommunityChest),l.AI.alertList=""),r(t)})(e,t);break;case"updateMoney":(async(e,t,o)=>{let l=t.player[t.turn];t.this.querySelector("#pmoney").innerHTML="$"+l.money;for(let e=0;e<t.this.querySelectorAll(".money-bar-row").length;e++)t.this.querySelectorAll(".money-bar-row")[e].style.display="none";for(let e=1;e<=t.pcount;e++){let o=t.player[e];t.this.querySelector(`#moneybarrow${e}`).style.display="flex",t.this.getElementById("p"+e+"moneybar").style.border="0.195vw solid "+o.color,t.this.getElementById("p"+e+"money").innerHTML=o.money,t.this.getElementById("p"+e+"moneyname").innerHTML=o.name}""===t.this.querySelector("#landed").innerHTML&&(t.this.querySelector("#landed").style.display="none"),t.this.querySelector("#quickstats").style.borderColor=l.color,l.money<0?(t.this.querySelector("#resignbutton").style.display="flex",t.this.querySelector("#nextbutton").style.display="none"):(t.this.querySelector("#resignbutton").style.display="none",t.this.querySelector("#nextbutton").style.display="flex"),r(t)})(0,t);break;case"trade":(async(e,t,o)=>{if(t.this.querySelector("#trade").style.display="flex",t.this.querySelector("#popupbackground").style.display="flex",t.this.querySelector("#proposetradebutton").style.display="flex",t.this.querySelector("#canceltradebutton").style.display="flex",t.this.querySelector("#accepttradebutton").style.display="none",t.this.querySelector("#rejecttradebutton").style.display="none",null!==e.tradeObj)await mInterface.get({type:"writeTrade",tradeObj:e.tradeObj},t),await mInterface.get({type:"proposeTrade"},t);else{let e=t.player[t.turn],o=1===t.turn?t.player[2]:t.player[1];await mInterface.get({type:"trade",initiator:e,recipient:o,property:null,money:null,communityChestJailCard:null,chanceJailCard:null},t),t.tradeObj.currentInitiator=t.tradeObj.initiator,t.tradeObj.currentRecipient=t.tradeObj.recipient;await mInterface.get({type:"resetTrade",initiator:e,recipient:o,allowRecipientToBeChanged:!0},t)}})(e,t);break;case"popup":(async(e,t,o)=>{t.this.getElementById("popuptext").innerHTML=e.HTML,t.this.getElementById("popup").style.width="61.297vw",t.this.getElementById("popup").style.height="16.297vw;",t.this.getElementById("popup").style.top="0",t.this.getElementById("popup").style.left="0",e.option||"string"!=typeof e.action||(e.option=e.action),e.option=e.option?e.option.toLowerCase():"","function"!=typeof e.action&&(e.action=null),"yes/no"===e.option?(t.this.getElementById("popuptext").innerHTML+='<div><input type="button" value="Yes" id="popupyes" /><input type="button" value="No" id="popupno" /></div>',t.this.querySelector("#popupyes").addEventListener("click",async()=>{console.assert(!1,t),t.this.querySelector("#popupwrap").style.display="none",t.this.querySelector("#popupbackground").style.display="none",e.action(e,t)}),t.this.querySelector("#popupno").addEventListener("click",async()=>{console.assert(!1),t.this.querySelector("#popupwrap").style.display="none",t.this.querySelector("#popupbackground").style.display="none"})):"blank"!==e.option&&(t.this.querySelector(".containerCard")?t.this.querySelector(".containerCard").insertAdjacentHTML("beforeend","<div><input type='button' value='OK' id='popupclose' /></div>"):t.this.querySelector("#popuptext").insertAdjacentHTML("beforeend","<div><input type='button' value='OK' id='popupclose' /></div>"),t.this.querySelector("#popupclose").focus(),t.this.querySelector("#popupclose").addEventListener("click",async()=>{t.this.querySelector("#popupwrap").style.display="none",null===e.action?e.HTML.indexOf("Go to jail")>-1?t.this.querySelector("#popupbackground").style.display="none":e.HTML.indexOf("more to buy")>-1&&(t.this.querySelector("#popupbackground").style.display="none"):(t.this.querySelector("#popupbackground").style.display="none",e.action(e,t))})),t.this.querySelector("#popupwrap").style.display="flex",t.this.querySelector("#popupbackground").style.display="flex",t.this.querySelector("#auctionBidItem")&&t.this.querySelector("#auctionBidItem").addEventListener("click",async()=>{await auction.get({type:"auctionBid",bid:null},t)}),t.this.querySelector("#auctionPassItem")&&t.this.querySelector("#auctionPassItem").addEventListener("click",async()=>{await auction.get({type:"auctionPass"},t)}),t.this.querySelector("#exitAuctionItem")&&t.this.querySelector("#exitAuctionItem").addEventListener("click",async()=>{confirm("Are you sure you want to stop bidding on this property altogether?")&&await auction.get({type:"auctionExit"},t)}),t.this.querySelector("#popupwrap").style.display="flex",r(t)})(e,t);break;case"updatePosition":(async(e,t,o)=>{t.this.getElementById("jail").style.border="0.098vw solid black",t.this.querySelector("#jailpositionholder")&&(t.this.querySelector("#jailpositionholder").innerHTML="");for(let e=0;e<40;e++)t.this.getElementById("cell"+e).style.border="0.098vw solid black",t.this.getElementById("cell"+e+"positionholder").innerHTML="";let l,n,a;for(let e=0;e<40;e++){l=t.square[e],n=0,a=0;for(let o=t.turn;o<=t.pcount;o++)t.player[o].position!==e||t.player[o].jail||(t.this.getElementById("cell"+e+"positionholder").innerHTML+="<div class='cell-position' title='"+t.player[o].name+"' style='background-color: "+t.player[o].color+"; left: "+n+"vw; top: "+a+"px;'></div>",36==n?(n=0,a=12):n+=1.2);for(let o=1;o<t.turn;o++)t.player[o].position!=e||t.player[o].jail||(t.this.getElementById("cell"+e+"positionholder").innerHTML+="<div class='cell-position' title='"+t.player[o].name+"' style='background-color: "+t.player[o].color+"; left: "+n+"vw; top: "+a+"px;'></div>",36==n?(n=0,a=12):n+=1.2)}n=0,a=63;for(let e=t.turn;e<=t.pcount;e++)t.player[e].jail&&(t.this.getElementById("jailpositionholder").innerHTML+="<div class='cell-position' title='"+t.player[e].name+"' style='background-color: "+t.player[e].color+"; left: "+n+"vw; top: "+a+"px;'></div>",36===n?(n=0,a=41):n+=1.2);for(let e=1;e<t.turn;e++)t.player[e].jail&&(t.this.getElementById("jailpositionholder").innerHTML+="<div class='cell-position' title='"+t.player[e].name+"' style='background-color: "+t.player[e].color+"; left: "+n+"vw; top: "+a+"px;'></div>",36===n?(n=0,a=41):n+=1.2);let i=t.player[t.turn];i.jail?t.this.getElementById("jail").style.border="0.098vw solid "+i.color:t.this.getElementById("cell"+i.position).style.border="0.098vw solid "+i.color,r(t)})(0,t);break;case"showStats":(async(e,t,o)=>{let l,r,n,a,i,s;l="<table align='center'><tr>";for(let e=1;e<=t.pcount;e++){s=!1,5==e&&(l+="</tr><tr>"),l+="<td class='statscell' id='statscell"+e+"' style='border: 0.195vw solid "+(n=t.player[e]).color+"' ><div class='statsplayername'>"+n.name+"</div>";for(let o=0;o<40;o++)(r=t.square[o]).owner==e&&(a="",i="",r.mortgage&&(a="title='Mortgaged' style='color: grey;'"),s||(s=!0,l+="<table>"),5==r.house?i+="<span style='float: right; font-weight: bold;'>1&nbsp;x&nbsp;<img src='./static/html/components/main-manager/images/hotel.png' alt='' title='Hotel' class='hotel' style='float: none;' /></span>":r.house>0&&r.house<5&&(i+="<span style='float: right; font-weight: bold;'>"+r.house+"&nbsp;x&nbsp;<img src='./static/html/components/main-manager/images/house.png' alt='' title='House' class='house' style='float: none;' /></span>"),l+="<tr><td class='statscellcolor' style='background: "+r.color+";",1!=r.groupNumber&&2!=r.groupNumber||(l+=" border: 0.098vw solid grey;"),l+="' showdeed = "+o+"></td><td class='statscellname' "+a+">"+r.name+i+"</td></tr>");n.communityChestJailCard&&(s||(s=!0,l+="<table>"),l+="<tr><td class='statscellcolor'></td><td class='statscellname'>Get Out of Jail Free Card</td></tr>"),n.chanceJailCard&&(s||(s=!0,l+="<table>"),l+="<tr><td class='statscellcolor'></td><td class='statscellname'>Get Out of Jail Free Card</td></tr>"),l+=s?"</table>":n.name+" dosen't have any properties.",l+="</td>"}if(l+="</tr></table><div id='titledeed'></div>",t.this.getElementById("statstext").innerHTML=l,t.this.querySelector(".statscellcolor")){let e=t.this.querySelectorAll(".statscellcolor");for(let o=0;o<e.length;o++)e[o].addEventListener("mouseover",async e=>{let o=e.target.getAttribute("showdeed");await mInterface.get({type:"showdeed",property:o},t)}),e[o].addEventListener("mouseout",async e=>{t.this.querySelector("#deed").style.display="none"})}else;t.this.querySelector("#statswrap").style.display="flex",t.this.querySelector("#statsbackground").addEventListener("click",async e=>{console.assert(!1,e)})})(0,t);break;case"mortgage":(async(e,t,o)=>{let l=t.monopoly.square[e.value];t.monopoly.player[l.owner];if(l.house>0||l.hotel>0||l.mortgage)return!1;let n=Math.round(.5*l.price),a=Math.round(.6*l.price);l.mortgage=!0,t.monopoly.player.money+=n,t.this.getElementById("mortgagebutton").value="Unmortgage for $"+a,t.this.getElementById("mortgagebutton").title="Unmortgage "+l.name+" for $"+a+".",await mInterface.get({type:"addAlert",value:`${t.player.name} mortgaged ${l.name} for $ ${n}.`},t),await mInterface.get({type:"updateOwned",value:""},t),await mInterface.get({type:"updateMoney",value:""},t),r(t)})(e,t);break;case"roll":(async(e,t,o)=>{let l=t.player[t.turn];t.this.querySelector("#option").style.display="none",t.this.querySelector("#buy").style.display="flex",t.this.querySelector("#manage").style.display="none",l.human&&t.this.getElementById("nextbutton").focus(),t.this.getElementById("nextbutton").value="End turn",t.this.getElementById("nextbutton").title="End turn and advance to the next player.",await monopoly.get({type:"rollDice"},t);let n=t.die1,a=t.die2;if(t.doublecount++,n==a?await mInterface.get({type:"addAlert",value:`${l.name} rolled ${n+a} - doubles.`},t):await mInterface.get({type:"addAlert",value:`${l.name} rolled ${n+a}.`},t),n!=a||l.jail)t.this.getElementById("nextbutton").value="End turn",t.this.getElementById("nextbutton").title="End turn and advance to the next player.",t.doublecount=0;else if(await monopoly.get({type:"updateDice",die1:n,die2:a},t),t.doublecount<3)t.this.getElementById("nextbutton").value="Roll again",t.this.getElementById("nextbutton").title="You threw doubles. Roll again.";else if(3===t.doublecount)return l.jail=!0,t.doublecount=0,await mInterface.get({type:"addAlert",value:`${l.name}  rolled doubles three times in a row.`},t),await monopoly.get({type:"updateMoney"},t),void(l.human?await monopoly.get({type:"popup",HTML:"You rolled doubles three times in a row. Go to jail.",action:await monopoly.get({type:"gotojail"},t),option:null},t):await monopoly.get({type:"gotojail"},t));await monopoly.get({type:"updatePosition",player:l},t),await monopoly.get({type:"updateMoney"},t),await monopoly.get({type:"updateOwned",player:l},t),!0===l.jail?(l.jailroll++,await monopoly.get({type:"updateDice",die1:n,die2:a},t),n==a?(t.this.getElementById("jail").style.border="0.098vw solid black",t.this.getElementById("cell11").style.border="0.195vw solid "+l.color,t.this.querySelector("#landed").style.display="none",l.jail=!1,l.jailroll=0,l.position=10+n+a,t.doublecount=0,await mInterface.get({type:"addAlert",value:`${l.name} rolled doubles to get out of jail.`},t),await monopoly.get({type:"land"},t)):3===l.jailroll?l.human?await monopoly.get({type:"popup",HTML:"<p>You must pay the $50 fine.</p>",action:async()=>{await mInterface.get({type:"payFifty"},t),t.player[t.turn].position=10+n+a,await monopoly.get({type:"land"},t)},option:null},t):(await mInterface.get({type:"payFifty"},t),l.position=10+n+a,await monopoly.get({type:"land"},t)):(t.this.querySelector("#landed").style.display="flex",t.this.getElementById("landed").innerHTML="You are in jail.",l.human||(l.AI.alertList=""))):(await monopoly.get({type:"updateDice",die1:n,die2:a},t),l.position+=n+a,l.position>=40&&(l.position-=40,l.money+=200,await mInterface.get({type:"addAlert",value:`${l.name}  collected a $200 salary for passing GO.`},t)),await monopoly.get({type:"land"},t)),r(t)})(0,t);break;case"getCheckedProperty":(async(e,t,o)=>{let l=-1;for(let e=0;e<42;e++)if(t.this.getElementById("propertycheckbox"+e)&&t.this.getElementById("propertycheckbox"+e).checked){l=e;break}r(l)})(0,t);break;case"updateOwned":(async(e,t,o)=>{let l=t.player[t.turn],n=(()=>{for(let e=0;e<42;e++)if(t.this.getElementById("propertycheckbox"+e)&&t.this.getElementById("propertycheckbox"+e).checked)return e;return-1})();t.checkedproperty=n,t.this.querySelector("#option").style.display="flex",t.this.querySelector("#owned").style.display="flex";let a,i="",s=-1,d="",p="";for(let e=0;e<40;e++)if((a=t.square[e]).groupNumber&&0===a.owner)t.this.querySelector(`#cell${e}owner`).style.display="none";else if(a.groupNumber&&a.owner>0){let o=t.this.getElementById("cell"+e+"owner");o.style.display="block",o.style.backgroundColor=t.player[a.owner].color,o.title=t.player[a.owner].name}for(let e=0;e<40;e++)if((a=t.square[e]).owner==t.turn){if(d="",a.mortgage&&(d="title='Mortgaged' style='color: grey;'"),p="",a.house>=1&&a.house<=4)for(let e=1;e<=a.house;e++)p+="<img src='./static/html/components/main-manager/images/house.png' alt='' title='House' class='house' />";else a.hotel&&(p+="<img src='./static/html/components/main-manager/images/house.png' alt='' title='Hotel' class='hotel' />");""===i&&(i+="<table>",s=e),i+="<tr class='property-cell-row'><td class='propertycellcheckbox'><input type='checkbox' id='propertycheckbox"+e+"' /></td><td class='propertycellcolor' style='background: "+a.color+";",1!=a.groupNumber&&2!=a.groupNumber||(i+=" border: 0.098vw solid grey; width: 1.758vw;"),i+="' showdeed = "+e+" ></td> <td class = 'propertycellname' > "+a.name+p+"</td> </tr>"}if(l.communityChestJailCard&&(""===i&&(s=40,i+="<table>"),i+="<tr class='property-cell-row'><td class='propertycellcheckbox'><input type='checkbox' id='propertycheckbox40' /></td><td class='propertycellcolor' style='background: white;'></td><td class='propertycellname'>Get Out of Jail Free Card</td></tr>"),l.chanceJailCard&&(""===i&&(s=41,i+="<table>"),i+="<tr class='property-cell-row'><td class='propertycellcheckbox'><input type='checkbox' id='propertycheckbox41' /></td><td class='propertycellcolor' style='background: white;'></td><td class='propertycellname'>Get Out of Jail Free Card</td></tr>"),""===i?(i=l.name+", you don't have any properties.",t.this.querySelector("#option").style.display="none"):i+="</table>",t.this.getElementById("owned").innerHTML=i,t.this.querySelector(".propertycellcolor")){let e=t.this.querySelectorAll(".propertycellcolor");for(let o=0;o<e.length;o++)e[o].addEventListener("mouseover",async l=>{let r=e[o].getAttribute("showdeed");await monopoly.get({type:"showdeed",property:r},t)}),e[o].addEventListener("mouseout",async e=>{t.this.querySelector("#deed").style.display="none"})}n>-1&&t.this.getElementById("propertycheckbox"+n)?t.this.getElementById("propertycheckbox"+n).checked=!0:s>-1&&(t.this.getElementById("propertycheckbox"+s).checked=!0);let c=t.this.querySelectorAll(".property-cell-row");for(let e=0;e<c.length;e++)c[e].addEventListener("click",async e=>{let o=!0,l=e.target.parentNode,r={},n=!1;for(;o;)"TR"===l.tagName?(n=l,l=l.parentNode):"TBODY"===l.tagName?(r=l,o=!1):l=l.parentNode;if(n){for(let e=0;e<r.children.length;e++)r.children[e].querySelector("input").checked=!1;n.querySelector("input").checked=!0}else;await monopoly.get({type:"updateOption"},t)});await mInterface.get({type:"updateOption"},t),r(t)})(0,t);break;case"updateOption":(async(e,t,o)=>{t.this.querySelector("#option").style.display="flex";let l=!0,n=!0,a=(()=>{for(let e=0;e<42;e++)if(t.this.getElementById("propertycheckbox"+e)&&t.this.getElementById("propertycheckbox"+e).checked)return e;return-1})();if(a<0||a>=40){t.this.querySelector("#buyhousebutton").style.display="none",t.this.querySelector("#sellhousebutton").style.display="none",t.this.querySelector("#mortgagebutton").style.display="none";let e=32,o=12;for(let l=0;l<40;l++){let r=t.square[l];1==r.hotel?o--:e-=r.house}t.this.querySelector("#buildings").style.display="flex",t.this.getElementById("buildings").innerHTML="<img src='./static/html/components/main-manager/images/house.png' alt='' title='House' class='house' />:&nbsp;"+e+"&nbsp;&nbsp;<img src='./static/html/components/main-manager/images/hotel.png.png' alt='' title='Hotel' class='hotel' />:&nbsp;"+o,r(t)}else{t.this.querySelector("#buildings").style.display="none";let e=t.square[a],o=t.this.getElementById("buyhousebutton"),i=t.this.getElementById("sellhousebutton");if(t.this.querySelector("#mortgagebutton").style.display="flex",t.this.getElementById("mortgagebutton").disabled=!1,e.mortgage)t.this.getElementById("mortgagebutton").value="Unmortgage ($"+Math.round(.6*e.price)+")",t.this.getElementById("mortgagebutton").title="Unmortgage "+e.name+" for $"+Math.round(.6*e.price)+".",t.this.querySelector("#buyhousebutton").style.display="none",t.this.querySelector("#sellhousebutton").style.display="none",n=!1;else if(t.this.getElementById("mortgagebutton").value="Mortgage ($"+.5*e.price+")",t.this.getElementById("mortgagebutton").title="Mortgage "+e.name+" for $"+.5*e.price+".",e.groupNumber>=3){t.this.querySelector("#buyhousebutton").style.display="flex",t.this.querySelector("#sellhousebutton").style.display="flex",o.disabled=!1,i.disabled=!1,o.value="Buy house ($"+e.houseprice+")",i.value="Sell house ($"+.5*e.houseprice+")",o.title="Buy a house for $"+e.houseprice,i.title="Sell a house for $"+.5*e.houseprice,4==e.house&&(o.value="Buy hotel ($"+e.houseprice+")",o.title="Buy a hotel for $"+e.houseprice),1==e.hotel&&(t.this.querySelector("#buyhousebutton").style.display="none",i.value="Sell hotel ($"+.5*e.houseprice+")",i.title="Sell a hotel for $"+.5*e.houseprice);let a=0,s=5,d=e.group.length;for(let r=0;r<d;r++){let d=t.square[e.group[r]];d.owner!==e.owner?(o.disabled=!0,i.disabled=!0,o.title="Before you can buy a house, you must own all the properties of this color-group."):(d.house>a&&(a=d.house),d.house<s&&(s=d.house),d.house>0&&(l=!1),d.mortgage&&(n=!1))}n||(o.disabled=!0,o.title="Before you can buy a house, you must unmortgage all the properties of this color-group."),e.house>s&&(o.disabled=!0,1==e.house?o.title="Before you can buy another house, the other properties of this color-group must all have one house.":4==e.house?o.title="Before you can buy a hotel, the other properties of this color-group must all have 4 houses.":o.title="Before you can buy a house, the other properties of this color-group must all have "+e.house+" houses."),e.house<a&&(i.disabled=!0,1==e.house?i.title="Before you can sell house, the other properties of this color-group must all have one house.":i.title="Before you can sell a house, the other properties of this color-group must all have "+e.house+" houses."),0===e.house&&0===e.hotel?t.this.querySelector("#sellhousebutton").style.display="none":t.this.querySelector("#mortgagebutton").style.display="none",l||(t.this.getElementById("mortgagebutton").title="Before a property can be mortgaged, all the properties of its color-group must unimproved.",t.this.getElementById("mortgagebutton").disabled=!0),r(t)}else t.this.querySelector("#buyhousebutton").style.display="none",t.this.querySelector("#sellhousebutton").style.display="none",r(t);r(t)}})(0,t);break;case"play":(async(e,t,o)=>{if(await monopoly.auction({type:"auction"},t))r(t);else{t.turn++,t.turn>t.pcount&&(t.turn-=t.pcount);let o=t.player[t.turn];await monopoly.get({type:"resetDice"},t),t.this.getElementById("pname").innerHTML=o.name,await mInterface.get({type:"addAlert",value:"It is "+o.name+"'s turn."},t),o.pay(0,o.creditor,t),t.this.querySelector("#landed").style.display="none",t.this.querySelector("#option").style.display="none",t.this.querySelector("#manage").style.display="none",t.this.querySelector("#board").style.display="flex",t.this.querySelector("#control").style.display="flex",t.this.querySelector("#moneybar").style.display="flex",t.this.querySelector("#buy").style.display="flex",t.doublecount=0,o.human&&t.this.getElementById("nextbutton").focus(),t.this.getElementById("nextbutton").value="Roll Dice",t.this.getElementById("nextbutton").title="Roll the dice and move your token accordingly.",t.this.querySelector("#die0").style.display="none",t.this.querySelector("#die1").style.display="none",o.jail&&(t.this.querySelector("#landed").style.display="flex",t.this.getElementById("landed").innerHTML="You are in jail.<input id='landedItemjail' type='button' title='Pay $50 fine to get out of jail immediately.' value='Pay $50 fine' />",t.this.querySelector("#landedItemjail").addEventListener("click",async()=>{await mInterface.get({type:"payFifty"},t)}),(o.communityChestJailCard||o.chanceJailCard)&&(t.this.getElementById("landed").innerHTML+="<input type='button' id='gojfbutton' title='Use &quot;Get Out of Jail Free&quot; card.' value='Use Card' />",t.this.querySelector("#gojfbutton").addEventListener("click",async()=>{await mInterface.get({type:"useJailCard"},t)})),t.this.getElementById("nextbutton").title="Roll the dice. If you throw doubles, you will get out of jail.",0===o.jailroll?await mInterface.get({type:"addAlert",value:"This is "+o.name+"'s first turn in jail."},t):1===o.jailroll?await mInterface.get({type:"addAlert",value:"This is "+o.name+"'s second turn in jail."},t):2===o.jailroll&&(t.this.getElementById("landed").innerHTML+="<div>NOTE: If you do not throw doubles after this roll, you <i>must</i> pay the $50 fine.</div>",await mInterface.get({type:"addAlert",value:"This is "+o.name+"'s third turn in jail."},t)),!o.human&&o.AI.postBail()&&(o.communityChestJailCard||o.chanceJailCard?await mInterface.get({type:"useJailCard"},t):await mInterface.get({type:"payfifty"},t))),await monopoly.get({type:"updateMoney"},t),await monopoly.get({type:"updatePosition"},t),await monopoly.get({type:"updateOwned"},t);let l=t.this.querySelectorAll(".money-bar-arrow");for(let e=0;e<l.length;e++)l[e].style.display="none";t.this.querySelector(`#p${t.turn}arrow`).style.display="flex",o.human||o.AI.beforeTurn()||await mInterface.get({type:"next",player:o},e)}})(e,t);break;case"addAlert":(async(e,t,o)=>{let l=t.this.querySelector("#alert"),n=document.createElement("div");n.innerText=e.value,l.appendChild(n),r(t)})(e,t)}})};