import action from"/static/html/components/component_modules/action/action.mjs";import utils from"/static/html/components/component_modules/utils/utils.mjs";export default(e,t,...a)=>new Promise(function(i,s){bundle.default(e,"export",async function(n,r){let o=e=>{i(e)},d=e=>{console.log("~~~ err router ~~~",e),s(e)};switch(t){case"create":(async(e,a,i)=>{try{console.log(`${e.input}[${t}][(feed)${e[a]}]`);let i={},s={},n={};switch(e[a]){case"channel":switch(r.isEmpty(e.name)&&(e.name="default"),e.name){case"bid":i.option={title:"Аукцион",description:"описание",id:"https://www.universitykids.ru/",link:"https://www.universitykids.ru/rss",language:"ru",webMaster:"s.zababurin.v@gmail.com",image:"https://www.universitykids.ru/universitykids.jpg",favicon:"https://www.universitykids.ru/favicon.ico",copyright:"All rights reserved 2019, Zababurin Sergey",generator:"awesome",author:{name:"Zababurin Sergey",email:"s.zababurin.v@gmail.com",link:"https://vk.com/zababurin"},category:"product"},(s=new r.Feed(i.option)).addCategory("product"),i.json=s.json1(),i.rss=s.rss2(),i.atom=s.atom1();break;default:i.option={title:"Детский университет",description:"Сайт предоставляет родителям и детям возможность публикации проектно-исследовательских работ Эксперты смогут просмотреть проекты в любое время и жать необходимые комментарии.",id:"https://www.universitykids.ru/",link:"https://www.universitykids.ru/rss",language:"ru",webMaster:"s.zababurin.v@gmail.com",image:"https://www.universitykids.ru/universitykids.jpg",favicon:"https://www.universitykids.ru/favicon.ico",copyright:"All rights reserved 2019, Zababurin Sergey",generator:"awesome",author:{name:"Zababurin Sergey",email:"s.zababurin.v@gmail.com",link:"https://vk.com/zababurin"},category:"education"},(s=new r.Feed(i.option)).addCategory("education"),i.json=s.json1(),i.rss=s.rss2(),i.atom=s.atom1()}o(i);break;case"item":s=new r.Feed(e.feed.option),r.isEmpty(e.data.rss)&&(e.data.rss="default"),e.data.rss,n={title:e.data.title,link:e.data.url,description:e.data.short_content,content:e.data.content,author:[{name:"Zababurin Sergey",email:"s.zababurin.v@gmail.com",link:"https://vashi-faili.firebaseapp.com/"}],date:new Date(e.data.timestamp),image:e.data.image.data},s.addItem(n),e.feed.json=s.json1(),e.feed.rss=s.rss2(),e.feed.atom=s.atom1(),e.item={},e.item=JSON.parse(s.json1()).items[0],e.item.date_modified=e.item.date_modified.replace(/(\..*$)/g,".000Z"),e.timestamp=e.data.timestamp,o(e);break;case"feed":let t=new r.Feed(e.feed.option),c=[];for(let t=0;t<e.items.length;t++){let a=`    <item>\n            <title>${e.items[t].title[0]}</title>\n            <guid>${e.items[t].guid[0]}</guid>\n             <link>${e.items[t].link[0]}</link>\n            <pubDate>${e.items[t].pubDate[0]}</pubDate>\n            <description>${e.items[t].description[0]}</description>\n            <content:encoded>${e.items[t]["content:encoded"][0]}</content:encoded>\n            <author>${e.items[t].author[0]}</author>\n            <enclosure url="${e.items[t].enclosure[0].$.url}"/>\n</item>`;c.push(a)}let l=t.rss2(),u=l.substr(0,l.indexOf("</channel>"));for(let e=0;e<c.length;e++)u+=c[e];o(u+=" </channel>\n                                               </rss>");break;default:d(`необрабатываемый тип запроса ${e[a]}`)}}catch(e){d(e)}})(e,a[0],a[1],a[2],a[3]);break;case"convert":(async(e,a,i)=>{try{switch(console.log(`${e.input}[${t}][(feed)${e[a]}]`),e[a]){case"rss":const i=new r.Feed(e.data);o(i.rss2());break;case"light":break;default:d(`необрабатываемый тип запроса ${e[a]}`)}}catch(e){d(e)}})(e,a[0],a[1],a[2],a[3]);break;case"get":(async(e,a,i)=>{try{switch(console.log(`${e.input}[${t}][(feed)${e[a]}]`),e[a]){case"yandex":const i="https://cors-anywhere.herokuapp.com/";(new r.rssParser).parseURL(i+"https://news.yandex.ru/culture.rss",function(e,t){console.log("~~~~~~~~",t)});break;case"feeds":o(action({input:"feed",type:"feeds"},"get","type"));break;case"items":e.func(e.data,async function(e,t){o(t.rss.channel[0].item)});break;default:d(`необрабатываемый тип запроса ${e[a]}`)}}catch(e){d(e)}})(e,a[0],a[1],a[2],a[3]);break;case"search":(async(e,a,i)=>{try{switch(console.log(`${e.input}[${t}][(feed)${e[a]}]`),e[a]){case"item":let i={},s=[];for(let t=0;t<e.data.length;t++)e.data[t].pubDate[0]===e.target?i=e.data[t]:s.push(e.data[t]);let n={};n.feed=s,n.remove=i,o(n);break;default:d(`необрабатываемый тип запроса ${e[a]}`)}}catch(e){d(e)}})(e,a[0],a[1],a[2],a[3]);break;case"find":(async(e,a,i)=>{try{switch(console.log(`${e.input}[${t}][(feed)${e[a]}]`),e[a]){case"item":let i=!1;for(let t=0;t<e.data.length;t++){if(console.assert(!1),(await utils({input:"action",data:e.data[t].item.date_modified,type:"feedDate"},"convert","type")).all===e.target){i=!0,o(e.data[t]._id);break}}!0===i||o(void 0);break;case"itemUpdate":let s=!1;for(let t=0;t<e.data.length;t++)if(console.log("~~1~~~",Date.parse(e.data[t].item.date_modified)),console.log("~~2~~~",e.target),Date.parse(e.data[t].item.date_modified)===e.target){s=!0,o(e.data[t]);break}!0===s||o(void 0);break;default:d(`необрабатываемый тип запроса ${e[a]}`)}}catch(e){d(e)}})(e,a[0],a[1],a[2],a[3]);break;default:d(`новая функция ${t}`)}})});