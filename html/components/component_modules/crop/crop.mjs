"use strict";let crop={this:{}};crop.this.cropUrl="",crop.this.width="",crop.this.height="",crop.func={},crop.watch={},crop.this.originImgSize="",crop.func.getCoord=function(r,t,e,c,o){return{p0:[r=o.scale*r,t=o.scale*t],p1:[r+(e=o.scale*e),t],p2:[r+e,t+(c=o.scale*c)],p3:[r,t+c],w:e,h:c,l:r,t:t}},crop.func["c-crop--area"]=function(r,t){return t.querySelector(".c-crop--area").style.width=r.imgW+"px",t.querySelector(".c-crop--area").style.height=r.imgH+"px",t.querySelector(".c-crop--area").style.marginTop=(r.height-r.imgH)/2+"px",t.querySelector(".c-crop--area").style.marginLeft=(r.width-r.imgW)/2+"px",r},crop.func["c-crop--cut"]=function(r,t){return t.querySelector(".c-crop--cut").style.width=r.elWidth+"px",t.querySelector(".c-crop--cut").style.height=r.elHeight+"px",t.querySelector(".c-crop--cut").style.left=r.cursorLeft+"px",t.querySelector(".c-crop--cut").style.top=r.cursorTop+"px",r.left=r.cursorLeft,r.top=r.cursorTop,r},crop.func["c-preview"]=function(r,t){return t.querySelector(".preview").style.width=r.previewImgSize[0].w+"px",t.querySelector(".preview").style.height=r.previewImgSize[0].h+"px",t.querySelector(".preview").style.left=r.previewImgSize[0].l+"px",t.querySelector(".preview").style.top=r.previewImgSize[0].t+"px",r},crop.func.updateSize=function(r,t){r.imgW-(r.left+r.elWidth)<0&&(r.left=r.left+(r.imgW-(r.left+r.elWidth))),r.imgH-(r.top+r.elHeight)<0&&(r.top=r.top+(r.imgH-(r.top+r.elHeight)));let e={};return e=crop.func.getCoord(r.left,r.top,r.elWidth,r.elHeight,r),r.previewImgSize=crop.func.setPreview(e,r),t.querySelector(".c-crop--cut").style.width=r.elWidth+"px",t.querySelector(".c-crop--cut").style.height=r.elHeight+"px",t.querySelector(".c-crop--cut").style.left=r.left+"px",t.querySelector(".c-crop--cut").style.top=r.top+"px",t.querySelector(".cut").style.marginTop=-r.top+"px",t.querySelector(".cut").style.marginLeft=-r.left+"px",t.querySelector(".preview").style.width=r.previewImgSize[0].w+"px",t.querySelector(".preview").style.height=r.previewImgSize[0].h+"px",t.querySelector(".preview").style.left=r.previewImgSize[0].l+"px",t.querySelector(".preview").style.top=r.previewImgSize[0].t+"px",r},crop.func.cut=function(r,t){return t.querySelector(".cut").style.width=r.imgW+"px",t.querySelector(".cut").style.height=r.imgH+"px",t.querySelector(".cut").style.marginTop=-r.cursorLeft+"px",t.querySelector(".cut").style.marginLeft=-r.cursorTop+"px",r},crop.func.setPreview=function(r,t){if(!t.previewJson.length)return!1;return t.previewJson.map(e=>{let c=e.width/r.w;return{scale:c,l:-c*r.l,t:-c*r.t,w:c*t.originImgSize.w,h:c*t.originImgSize.h}})},crop.func.setImage=function(r,t){return new Promise(t=>{let e=r.this.querySelector(".org");e.src=r.crop.this.url,e.setAttribute("alt","image"),(e=r.this.querySelector(".cut")).src=r.crop.this.url,e.setAttribute("alt","image"),(e=r.this.querySelector(".preview")).src=r.crop.this.url,e.setAttribute("alt","image")})},crop.func.getSize=function(r){return new Promise(t=>{let e=r.this.querySelector("#c-crop--hide_img");r.crop.this.cropUrl=r.upload.url,r.crop.this.cropUrl&&e?(e.onload=function(){const r=crop.func.getSizeImg(e);t(r)},e.src=r.crop.this.cropUrl):t({w:0,h:0,r:0})})},crop.func.setSize=async function(r){if(!r.upload.url)return!1;let t=await crop.func.getSize(r);r.crop.this.originImgSize=t,r.crop.watch.originImgSize=t,(r=await crop.func.setCoordRange(r)).crop.this.scale=t.w/r.crop.this.imgW,r.crop.watch.scale=t.w/r.crop.this.imgW,r.crop.this.cursorTop=0,r.crop.this.cursorLeft=0,r.crop.this.ratio=1;let e={...r.crop.this.cropJson};if(e.w=r.crop.this.imgW,e.h=r.crop.this.imgH,r.crop.this.ratio)if(e.r=r.crop.this.ratio,e.w>e.h){let t=e.h*r.crop.this.ratio/e.w;t>1?(e.ch=e.h/t,e.cw=e.ch*r.crop.this.ratio):(e.ch=e.h,e.cw=e.ch*r.crop.this.ratio)}else{let t=e.w/r.crop.this.ratio/e.h;t>1?(e.cw=e.w/t,e.ch=e.cw/r.crop.this.ratio):(e.cw=e.w,e.ch=e.cw/r.crop.this.ratio)}else e.cw=e.w,e.ch=e.h;return r.crop.this.elWidth=e.cw/2,r.crop.this.elHeight=e.ch/2,r.crop.this.cursorTop=e.ch/4,r.crop.this.cursorLeft=e.cw/4,r.crop.watch.elWidth=e.cw/2,r.crop.watch.elHeight=e.ch/2,r.crop.watch.cursorTop=e.ch/4,r.crop.watch.cursorLeft=e.cw/4,r.crop.this.cropJson={...e},r.crop.watch["c-crop--cut"](r.crop.this,r.this),r.crop.watch.cut(r.crop.this,r.this),r.crop.func.tool.drapSizeUpdate(r.crop.this.elWidth,r.crop.this.elHeight,r.crop.this.cursorTop,r.crop.this.cursorLeft,r),r},crop.func.getSizeImg=function(r){let t=r.naturalWidth,e=r.naturalHeight;return{w:t,h:e,r:0===t&&0===e?0:t/e}},crop.func.getHW=function(r){return r.crop.this.width=r.this.querySelector(".c-crop--main").style.width,r.crop.this.height=r.this.querySelector(".c-crop--main").style.height,r.crop.this.width=r.crop.func.convert.vwToPixel(r.crop.this.width.substr(0,r.crop.this.width.length-2)),r.crop.this.height=r.crop.func.convert.vwToPixel(r.crop.this.height.substr(0,r.crop.this.height.length-2)),r},crop.func.setCoordRange=function(r){return new Promise(function(t,e){let c={...r.crop.this.originImgSize};r.crop.func.getHW(r),r.crop.watch.height=r.crop.this.height,r.crop.watch.width=r.crop.this.width,r.crop.watch.imgW=r.crop.this.imgW,r.crop.watch.imgH=r.crop.this.imgH,r.crop.watch["c-crop--area"]=r.crop.func["c-crop--area"],r.crop.watch["c-crop--cut"]=r.crop.func["c-crop--cut"],r.crop.watch.cut=r.crop.func.cut;let o=r.crop.this.width/r.crop.this.height;c.r>o?(r.crop.this.imgW=r.crop.this.width,r.crop.this.imgH=r.crop.this.width/c.r,r.crop.watch.imgW=r.crop.this.width,r.crop.watch.imgH=r.crop.this.width/c.r):(r.crop.this.imgH=r.crop.this.height,r.crop.this.imgW=r.crop.this.height*c.r,r.crop.watch.imgH=r.crop.this.height,r.crop.watch.imgW=r.crop.this.height*c.r),r.crop.watch["c-crop--area"](r.crop.this,r.this),t(r)})},crop.func.getCropJson=function(r){return new Promise(function(t,e){r.crop.this.cropJson=[],r.crop.this.cropJson.cw=null,r.crop.this.cropJson.ch=null,r.crop.this.cropJson.w=null,r.crop.this.cropJson.h=null,r.crop.this.cropJson.r=null,r.crop.watch.cropJson=r.crop.this.cropJson,t(r)})},crop.func.openCrop=function(r){return new Promise(function(t,e){let c=this;this.fileLoader(r,r=>{c.cropUrl1=r})})},crop.func.dragFn=function(r){return new Promise(function(t,e){const c=r.dataTransfer.files.item(0);if(!/^image.*$/.test(c.type))return!1;var o=new FileReader;o.readAsDataURL(c),o.onload=function(r){this.cropUrl=r.target.result}})},crop.func.showImage=function(r,t){return new Promise(function(e,c){let o=new FileReader;var i=r.crop.file;o.readAsDataURL(i),o.onload=function(r){t(r.target.result)}})},crop.func.setPreviewSize=function(r){return new Promise(function(t,e){if(!r.crop.this.previewJson.length)return!1;let c=r.crop.this.previewJson.map(t=>{let e=t.width/r.crop.this.coord.w;return{scale:e,l:-e*r.crop.this.coord.l,t:-e*r.crop.this.coord.t,w:e*r.crop.this.originImgSize.w,h:e*r.crop.this.originImgSize.h}});r.crop.this.previewImgSize=c,r.crop.watch.previewImgSize=c,crop.watch["c-preview"](r.crop.this,r.this),r.crop.watch.end=!0,t(r)})};export default{crop:crop};