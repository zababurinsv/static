import isEmpty from"/static/html/components/component_modules/isEmpty/isEmpty_t.mjs";import colorlog from"/static/html/components/component_modules/colorLog/colorLog.mjs";import Performance from"/static/html/components/component_modules/performance/performance.mjs";let root,performance=Performance(),object={},SELECT={$progress:!1,$selected:!1},Conditional={},Helper={},TRANSFORM={};Helper.is_template=(e=>new Promise(async function(t,o){t(/\{\{(.+)\}\}/g.test(e))})),SELECT.exec=((e,t,o)=>new Promise(async function(r,l){try{if(colorlog(">~~~~~~~~~ SELECT.exec ~~~exec~~~~<","#eb3456",e,t,o),"string"==typeof e);else if(await Helper.is_array(e))for(let r=0;r<e.length;r++)colorlog(">~~~~~~~~~ SELECT.exec ~~~exec~~~~<","#eb3456",e[r],t+"["+r+"]",o),await SELECT.exec(e[r],t+"["+r+"]",o);else for(let r in e)if(colorlog(">~~~~~~~~~ SELECT.exec ~~~exec~~~~<","#eb3456",e,r,e[r]),"$root"!==r){if(o(r,e[r])){let o=SELECT.$selected.length;SELECT.$selected.push({index:o,key:r,path:t,object:e,value:e[r]})}colorlog(">~~~~~~~~~ SELECT.exec ~~~exec~~~~<","#eb3456",e[r],t+'["'+r+'"]',o),await SELECT.exec(e[r],t+'["'+r+'"]',o)}}catch(e){i={_:"exec",error:e},console.log("~~~ err ~~~",i),l(i)}var i})),SELECT.objects=((e={_:"SELECT",SELECT:void 0})=>new Promise(async function(t,o){isEmpty(e.SELECT)||(SELECT=e.SELECT),SELECT.$progress=null,SELECT.$selected?t(SELECT.$selected.map(function(e){return e.object})):t([SELECT.$selected_root])})),SELECT.keys=((e={_:"SELECT",SELECT:void 0})=>new Promise(async function(t,o){isEmpty(e.SELECT)||(SELECT=e.SELECT),SELECT.$progress=null,SELECT.$selected?t(SELECT.$selected.map(function(e){return e.key})):Array.isArray(SELECT.$selected_root)?t(Object.keys(SELECT.$selected_root).map(function(e){return parseInt(e)})):t(Object.keys(SELECT.$selected_root))})),SELECT.paths=((e={_:"SELECT",SELECT:void 0})=>new Promise(async function(t,o){isEmpty(e.SELECT)||(SELECT=e.SELECT),SELECT.$progress=null,SELECT.$selected?t(SELECT.$selected.map(function(e){return e.path})):Array.isArray(SELECT.$selected_root)?t(Object.keys(SELECT.$selected_root).map(function(e){return"["+e+"]"})):t(Object.keys(SELECT.$selected_root).map(function(e){return'["'+e+'"]'}))})),SELECT.values=((e={_:"SELECT",SELECT:void 0})=>new Promise(async function(t,o){isEmpty(e.SELECT)||(SELECT=e.SELECT),SELECT.$progress=null,SELECT.$selected?t(SELECT.$selected.map(function(e){return e.value})):t(Object.values(SELECT.$selected_root))})),SELECT.root=((e={_:"SELECT",SELECT:void 0})=>new Promise(async function(t,o){isEmpty(e.SELECT)||(SELECT=e.SELECT),SELECT.$progress=null,colorlog(">~~~~~~~~~ SELECT.root ~~~$selected_root_out~~~~<","red",SELECT.$selected_root),t(SELECT.$selected_root)})),Helper.is_array=(e=>new Promise(async function(t,o){t(Array.isArray(e)||!!e&&"object"==typeof e&&"number"==typeof e.length&&(0===e.length||e.length>0&&e.length-1 in e))})),Helper.resolve=((e,t,o)=>new Promise(async function(r,l){let i=e=>{r(e)};try{if(colorlog(">~~~~~~~~~ SELECT.root ~~~resolve~~~~<","#348feb",SELECT.$selected_root),t&&t.length>0){i(Function("new_val","with(this) {this"+t+"=new_val; return this;}").bind(e)(o))}else i(e=o)}catch(e){n={_:"Helper.resolve",error:e},console.log("~~~ err ~~~",n),l(n)}var n})),TRANSFORM._fillout=(e=>new Promise(async function(t,o){let r=e=>{t(e)};try{let t=/\{\{(.*?)\}\}/g,i=/^\{\{((?!\}\}).)*\}\}$/,n=e.variable,s=e.data,c=e.template,a=n.replace(t,"$1");if(s){let e;-1===["number","string","array","boolean","function"].indexOf(typeof s)&&(s.$root=root);let t=/function\([ ]*\)[ ]*\{(.*)\}[ ]*$/g.exec(a),o=(e=t?Function("with(this) {"+t[1]+"}").bind(s):/\breturn [^;]+;?[ ]*$/.test(a)&&/return[^}]*$/.test(a)?Function("with(this) {"+a+"}").bind(s):Function("with(this) {return ("+a+")}").bind(s))();if(delete s.$root,o&&(o=o.valueOf()),void 0===o)r(c);else if(o)c?i.test(c)?r(o):r(c.replace(n,o)):r(o);else{if(!c)return"";i.test(c)?r(o):r(c.replace(n,""))}}else r(c)}catch(e){l={_:"_fillout",error:e},console.log("~~~ err ~~~",l),o(l)}var l})),TRANSFORM.fillout=((e,t,o)=>new Promise(async function(r,l){try{colorlog(">~~~~~~~~~ TRANSFORM.fillout ~~~in~~~~~~<","#9beb34",e,t,o);let n=t;if(await Helper.is_template(t)){let r=/\{\{(.*?)\}\}/g,l=t.match(r);if(l)if(colorlog(">~~~~~~~~~ TRANSFORM.fillout ~~~variables~~1~~~~<","#9beb34",l),o)n=await TRANSFORM._fillout({variable:l[0],data:e,template:null}),colorlog(">~~~~~~~~~ TRANSFORM.fillout ~~~_fillout~~~~~~<","#9beb34",n);else{for(let t=0;t<l.length;t++){let o=l[t];n=await TRANSFORM._fillout({variable:o,data:e,template:n})}colorlog(">~~~~~~~~~ TRANSFORM.fillout ~~~variables_fillout~~2~~~~<","#9beb34",n)}else console.warn("здесь был return пока не вижу зачем он")}colorlog(">~~~~~~~~~ TRANSFORM.fillout ~~~out~~~~<","red",n),r(n)}catch(e){i={_:"error menu",error:e},console.log("~~~ err ~~~",i),l(i)}var i})),TRANSFORM.tokenize=(e=>new Promise(async(t,o)=>{try{let r,l=/\{\{(.+)\}\}/g,i=(e=e.replace(l,"$1")).trim().split(" "),n=null;if(i.length>0&&"#"===i[0][0]){n={name:r=i.shift(),expression:i.join(" ")}}(e=>{t(e)})(n)}catch(e){(e=>{o(e)})({_:"error menu",error:e})}})),TRANSFORM.run=((e,t)=>new Promise(async(o,r)=>{let l=e=>{o(e)};try{let o,i;if(colorlog(">~~~~~~~~~ TRANSFORM.run ~~~template~~~~~~<","#c203fc",e),"string"==typeof e)if(await Helper.is_template(e)){let r=/\{\{([ ]*#include)[ ]*([^ ]*)\}\}/g;colorlog(">~~~~~~~~~ TRANSFORM.run ~~~include_string_re~~~~~~<","#c203fc",r),r.test(e)?(i=await TRANSFORM.tokenize(e),o=i.expression?await TRANSFORM.fillout(t,"{{"+i.expression+"}}",!0):e):o=await TRANSFORM.fillout(t,e)}else o=e;else if(await Helper.is_array(e))if(await Conditional.is(e))o=await Conditional.run(e,t);else{o=[];for(let r=0;r<e.length;r++){let l=await TRANSFORM.run(e[r],t);l&&o.push(l)}}else if("[object Object]"===Object.prototype.toString.call(e)){o={};let r=/\{\{([ ]*#include)[ ]*(.*)\}\}/,l=Object.keys(e).filter(function(e){return r.test(e)});l.length>0&&(i=await TRANSFORM.tokenize(l[0]),o=i.expression?await TRANSFORM.fillout(e[l[0]],"{{"+i.expression+"}}",!0):e[l[0]]);for(let r in e)if(await Helper.is_template(r))if(i=await TRANSFORM.tokenize(r)){if("#include"===i.name);else if("#let"===i.name){if(await Helper.is_array(e[r])&&2==e[r].length){let l=e[r][0],i=e[r][1],n=TRANSFORM.run(l,t);for(let e in n)TRANSFORM.memory[e]=n[e],t[e]=n[e];o=await TRANSFORM.run(i,t)}}else if("#concat"===i.name)await Helper.is_array(e[r])&&(o=[],e[r].forEach(function(e){let r=TRANSFORM.run(e,t);o=o.concat(r)}),/\{\{(.*?)\}\}/.test(JSON.stringify(o))&&(o=e));else if("#merge"===i.name){if(await Helper.is_array(e[r]))if(o={},e[r].forEach(function(e){let r=TRANSFORM.run(e,t);for(let e in r)o[e]=r[e]}),"object"==typeof t){delete o.$index;for(let e in TRANSFORM.memory)delete o[e]}else{delete String.prototype.$index,delete Number.prototype.$index,delete Function.prototype.$index,delete Array.prototype.$index,delete Boolean.prototype.$index;for(let e in TRANSFORM.memory)delete String.prototype[e],delete Number.prototype[e],delete Function.prototype[e],delete Array.prototype[e],delete Boolean.prototype[e]}}else if("#each"===i.name){colorlog(">~~~~~~~~~ TRANSFORM.run ~~~#each~~~~~~<","#c203fc",t,"{{"+i.expression+"}}",!0);let l=await TRANSFORM.fillout(t,"{{"+i.expression+"}}",!0);if(l&&await Helper.is_array(l)){o=[];for(let t=0;t<l.length;t++){if(colorlog(">~~~~~~~~~ TRANSFORM.run ~~~#each~~~~~~<","#c203fc",l[t]),"object"==typeof l[t]){l[t].$index=t;for(let e in TRANSFORM.memory)l[t][e]=TRANSFORM.memory[e]}else{colorlog(">~~~~~~~~~ TRANSFORM.run ~~~#memory~~~~~~<","#c203fc",TRANSFORM.memory),String.prototype.$index=t,Number.prototype.$index=t,Function.prototype.$index=t,Array.prototype.$index=t,Boolean.prototype.$index=t;for(let e in TRANSFORM.memory)String.prototype[e]=TRANSFORM.memory[e],Number.prototype[e]=TRANSFORM.memory[e],Function.prototype[e]=TRANSFORM.memory[e],Array.prototype[e]=TRANSFORM.memory[e],Boolean.prototype[e]=TRANSFORM.memory[e]}colorlog(">~~~~~~~~~ TRANSFORM.run ~~~#memory~~~~~~<","#c203fc",e[r],l[t]);let i=await TRANSFORM.run(e[r],l[t]);if("object"==typeof l[t]){delete l[t].$index;for(let e in TRANSFORM.memory)delete l[t][e]}else{colorlog(">~~~~~~~~~ TRANSFORM.run ~~~#delete~~~~~~<","#c203fc",e[r],l[t]),delete String.prototype.$index,delete Number.prototype.$index,delete Function.prototype.$index,delete Array.prototype.$index,delete Boolean.prototype.$index;for(let e in TRANSFORM.memory)delete String.prototype[e],delete Number.prototype[e],delete Function.prototype[e],delete Array.prototype[e],delete Boolean.prototype[e]}i&&(o.push(i),colorlog(">~~~~~~~~~ TRANSFORM.run ~~~#result~~~~~~<","#c203fc",i,o))}}else colorlog(">~~~~~~~~~ TRANSFORM.run ~~~#result = template~~~~~~<","#c203fc",e),o=e}}else{colorlog(">~~~~~~~~~ TRANSFORM.run ~~~TRANSFORM.fillout~~~~~~<","#c203fc",t,r),colorlog(">~~~~~~~~~ TRANSFORM.run ~~~TRANSFORM.fillout~~~~~~<","#c203fc",t,e[r]);let l=await TRANSFORM.fillout(t,r),i=await TRANSFORM.fillout(t,e[r]);void 0!==l&&void 0!==i&&(o[l]=i,colorlog(">~~~~~~~~~ TRANSFORM.run ~~~ result[k] = v;~~~~~~<","#c203fc",o,o[l],l,i))}else if("string"==typeof e[r])if((i=await TRANSFORM.tokenize(e[r]))&&"#?"===i.name){let e=await TRANSFORM.fillout(t,"{{"+i.expression+"}}");e!=="{{"+i.expression+"}}"&&e&&(o[r]=e)}else{let l=await TRANSFORM.run(e[r],t);void 0!==l&&(o[r]=l)}else{let l=await TRANSFORM.run(e[r],t);void 0!==l&&(o[r]=l)}}else colorlog(">~~~~~~~~~ TRANSFORM.run ~~~out~~~template~~~<","red",e),l(e);l(o)}catch(e){(e=>{console.log("~~~ err ~~~",e),r(e)})({_:"error menu",error:e})}})),Conditional.is=(e=>new Promise(async(t,o)=>{let r=e=>{t(e)};try{if(colorlog(">~~~~~~~~~ Conditional.is ~~~~~~~~~<","#8034eb",e),await Helper.is_array(e))if(0===e.length)colorlog(">~~~~~~~~~ Conditional.is ~~~~~false~~~~<","red",e),r(!1);else{let t=!0;for(let o=0;o<e.length;o++){let o=e[0];if("object"!=typeof o){colorlog(">~~~~~~~~~ Conditional.is ~~~~~~~~~<","#8034eb",o),t=!1;break}if(1!==Object.keys(o).length){t=!1;break}}if(t){let t,o=e[0];for(let l in o)(t=await TRANSFORM.tokenize(l))&&t.name&&t.expression&&0!==t.expression.length?"#if"!==t.name.toLowerCase()&&(colorlog(">~~~~~~~~~ Conditional.is ~~~~~false~~~~<","red",e),r(!1)):(colorlog(">~~~~~~~~~ Conditional.is ~~~~~false~~~~<","red",e),r(!1));if(1===e.length)colorlog(">~~~~~~~~~ Conditional.is ~~~~~true~~~~<","red",e),r(!0);else{colorlog(">~~~~~~~~~ Conditional.is ~~~~~else~~~~<","red",e);let o=!0;for(let r=1;r<e.length-1;r++){let l=e[r];for(let e in l)if("#elseif"!==(t=await TRANSFORM.tokenize(e)).name.toLowerCase()){o=!1;break}}if(o){let o=e[e.length-1],l=!0;for(let e in o)t=await TRANSFORM.tokenize(e),colorlog(">~~~~~~~~~ Conditional.is ~~~~~~~~~<","#8034eb",t),-1===["#else","#elseif"].indexOf(t.name.toLowerCase())&&(l=!1);colorlog(">~~~~~~~~~ Conditional.is ~~~~~verify~~~~<","red",l),r(l)}else r(!0)}}else r(!1)}else colorlog(">~~~~~~~~~ Conditional.is ~~~~~false~~~~<","red",e),r(!1)}catch(e){(e=>{console.log("~~~ err ~~~",e),o(e)})({_:"is",error:e})}})),SELECT.select=((e,t,o)=>new Promise(async function(r,l){try{colorlog(">~~~~~~~~~ SELECT.select ~~~~~~~~~<","#0362fc",SELECT),isEmpty(t)||(e.filter=t),isEmpty(o)||(e.serialized=o);let i={};i=isEmpty(e.this)?e:e.this;try{o&&(i=JSON.parse(e))}catch(e){}t?(SELECT.$selected=[],await SELECT.exec(i,"",t)):SELECT.$selected=null,i&&(Helper.is_array(i)||"object"==typeof i)?(SELECT.$progress||(colorlog(">~~~~~~~~~ SELECT.select ~~~~$progress~~~~~<","#0362fc"),Helper.is_array(i)?(SELECT.$val=[],SELECT.$selected_root=[]):(SELECT.$val={},SELECT.$selected_root={})),Object.keys(i).forEach(function(e){colorlog(">~~~~~~~~~ SELECT.select ~~~~$progress~~~~~<","#0362fc",i[e]),SELECT.$val[e]=i[e],SELECT.$selected_root[e]=i[e]})):(SELECT.$val=i,SELECT.$selected_root=i),SELECT.$progress=!0,colorlog(">~~~~~~~~~ SELECT.select ~~~~out~~~~~<","red",SELECT),(e=>{r(e)})(SELECT)}catch(e){l({_:"error menu",error:e})}})),SELECT.transformWith=((e,t,o)=>new Promise(async(r,l)=>{try{colorlog(">~~~~~~~~~ SELECT.transformWith ~~~~~~~~~<","#6203fc",SELECT),isEmpty(SELECT.$progress)&&(SELECT.$progress=null),isEmpty(SELECT.$parsed)&&(SELECT.$parsed=[]),isEmpty(o)||(SELECT=Object.assign(SELECT,o));let n={};isEmpty(e.template)?n=e:(colorlog(">~~~~~~~~~ SELECT.transformWith ~~~template~~~~~~<","#6203fc",SELECT),n=e.template),isEmpty(t)&&(colorlog(">~~~~~~~~~ SELECT.transformWith ~~~serialized~~~~~~<","#6203fc",SELECT),e.serialized=t);try{t&&(n=JSON.parse(e))}catch(e){}if(SELECT.$template_root=n,String.prototype.$root=SELECT.$selected_root,Number.prototype.$root=SELECT.$selected_root,Function.prototype.$root=SELECT.$selected_root,Array.prototype.$root=SELECT.$selected_root,Boolean.prototype.$root=SELECT.$selected_root,root=SELECT.$selected_root,SELECT.$selected&&SELECT.$selected.length>0)SELECT.$selected.sort(function(e,t){return t.path.length-e.path.length}).forEach(function(e){console.assert(!1);var t=TRANSFORM.run(n,e.object);SELECT.$selected_root=Helper.resolve(SELECT.$selected_root,e.path,t),e.object=t}),SELECT.$selected.sort(function(e,t){return e.index-t.index});else{var i=await TRANSFORM.run(n,SELECT.$selected_root);SELECT.$selected_root=await Helper.resolve(SELECT.$selected_root,"",i)}delete String.prototype.$root,delete Number.prototype.$root,delete Function.prototype.$root,delete Array.prototype.$root,delete Boolean.prototype.$root,performance.now(!0),(e=>{r(e)})(SELECT)}catch(e){(e=>{l(e)})({_:"error menu",error:e})}}));let _stringify=JSON.stringify;JSON.stringify=function(e,t,o){return-1!==["number","string","boolean"].indexOf(typeof e)?_stringify(e,t,o):_stringify(e,t||function(e,t){if(!(SELECT.$injected&&SELECT.$injected.length>0&&-1!==SELECT.$injected.indexOf(e)||"$root"===e||"$index"===e||e in TRANSFORM.memory))return"function"==typeof t?"("+t.toString()+")":t},o)};export default(e={_:"json"})=>new Promise(async(e,t)=>{object.class=class{constructor(e){this.select=this.select.bind(this),this.transformWith=this.transformWith.bind(this),this.root=this.root.bind(this),colorlog(!0,{key:"value"},"constructor",this,"performance"),colorlog(!0,"свойство2","constructor",this.transformWith,"performance"),colorlog(!0,"свойство3","success",this.select,"performance2"),colorlog(!0,"свойство5","constructor",this,"performance"),colorlog(!0,"свойство6","success",this,"performance2"),colorlog(!0,"свойство7","constructor",this,"performance"),colorlog(!0,"свойство8","success",this,"performance2"),colorlog(!0,"end","constructor",this,"performance"),colorlog(!0,"end","success",this,"performance2"),console.log(performance.allMark)}root(e){return SELECT.root(e)}transformWith(e,t,o){return SELECT.transformWith(e,t,o)}select(e={_:"select",this:void 0,filter:!1,serialized:!1},t,o){return SELECT.select(e,t,o)}get self(){return object}},(t=>{e(t)})(object)});