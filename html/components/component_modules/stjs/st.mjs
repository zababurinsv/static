export default{ST:async(e={_:"st",this:void 0})=>{e.this;var t,r={is_template:function(e){return/\{\{(.+)\}\}/g.test(e)},is_array:function(e){return Array.isArray(e)||!!e&&"object"==typeof e&&"number"==typeof e.length&&(0===e.length||e.length>0&&e.length-1 in e)},resolve:function(e,t,r){return t&&t.length>0?Function("new_val","with(this) {this"+t+"=new_val; return this;}").bind(e)(r):e=r}},o={run:function(e,t){for(var r=0;r<e.length;r++){var o=e[r],i=Object.keys(o)[0],l=n.tokenize(i);if("#if"!==l.name&&"#elseif"!==l.name)return n.run(o[i],t);var s=l.expression,a=n.fillout(t,"{{"+s+"}}");if(a==="{{"+s+"}}")return e;if(a)return n.run(o[i],t)}return null},is:function(e){if(!r.is_array(e))return!1;if(0===e.length)return!1;for(var t=!0,o=0;o<e.length;o++){var i=e[0];if("object"!=typeof i){t=!1;break}if(1!==Object.keys(i).length){t=!1;break}}if(!t)return!1;var l,s=e[0];for(var a in s){if(!(l=n.tokenize(a)))return!1;if(!l.name)return!1;if(!l.expression||0===l.expression.length)return!1;if("#if"!==l.name.toLowerCase())return!1}if(1===e.length)return!0;for(var c=!0,u=1;u<e.length-1;u++){var p=e[u];for(var f in p)if("#elseif"!==(l=n.tokenize(f)).name.toLowerCase()){c=!1;break}}if(!c)return!1;var d=e[e.length-1];for(var $ in d)if(l=n.tokenize($),-1===["#else","#elseif"].indexOf(l.name.toLowerCase()))return!1;return!0}},n={memory:{},transform:function(e,t,r,o){var n,l=null;if(/#include/.test(JSON.stringify(e))&&(l=function(e,t){return/#include/.test(e)||/#include/.test(t)}),r){var s=i.select(e,l,o).transform(t,o).root();n=i.select(t,null,o).inject(r,o).transformWith(s,o).root()}else n=i.select(e,l,o).transform(t,o).root();return o?JSON.stringify(n):n},tokenize:function(e){var t=(e=e.replace(/\{\{(.+)\}\}/g,"$1")).trim().split(" ");if(t.length>0&&"#"===t[0][0])return{name:t.shift(),expression:t.join(" ")};return null},run:function(e,t){var i,l;if("string"==typeof e)if(r.is_template(e)){/\{\{([ ]*#include)[ ]*([^ ]*)\}\}/g.test(e)?(l=n.tokenize(e),i=l.expression?n.fillout(t,"{{"+l.expression+"}}",!0):e):i=n.fillout(t,e)}else i=e;else if(r.is_array(e))if(o.is(e))i=o.run(e,t);else{i=[];for(var s=0;s<e.length;s++){(x=n.run(e[s],t))&&i.push(x)}}else{if("[object Object]"!==Object.prototype.toString.call(e))return e;i={};var a=/\{\{([ ]*#include)[ ]*(.*)\}\}/,c=Object.keys(e).filter(function(e){return a.test(e)});for(var u in c.length>0&&(l=n.tokenize(c[0]),i=l.expression?n.fillout(e[c[0]],"{{"+l.expression+"}}",!0):e[c[0]]),e){if(r.is_template(u))if(l=n.tokenize(u)){if("#include"===l.name);else if("#let"===l.name){if(r.is_array(e[u])&&2==e[u].length){var p=e[u][0],f=e[u][1],d=n.run(p,t);for(var $ in d)n.memory[$]=d[$],t[$]=d[$];i=n.run(f,t)}}else if("#concat"===l.name)r.is_array(e[u])&&(i=[],e[u].forEach(function(e){var r=n.run(e,t);i=i.concat(r)}),/\{\{(.*?)\}\}/.test(JSON.stringify(i))&&(i=e));else if("#merge"===l.name){if(r.is_array(e[u]))if(i={},e[u].forEach(function(e){var r=n.run(e,t);for(var o in r)i[o]=r[o]}),"object"==typeof t)for(var y in delete i.$index,n.memory)delete i[y];else for(var y in delete String.prototype.$index,delete Number.prototype.$index,delete Function.prototype.$index,delete Array.prototype.$index,delete Boolean.prototype.$index,n.memory)delete String.prototype[y],delete Number.prototype[y],delete Function.prototype[y],delete Array.prototype[y],delete Boolean.prototype[y]}else if("#each"===l.name){var m=n.fillout(t,"{{"+l.expression+"}}",!0);if(m&&r.is_array(m)){i=[];for(var v=0;v<m.length;v++){if("object"==typeof m[v])for(var y in m[v].$index=v,n.memory)m[v][y]=n.memory[y];else for(var y in String.prototype.$index=v,Number.prototype.$index=v,Function.prototype.$index=v,Array.prototype.$index=v,Boolean.prototype.$index=v,n.memory)String.prototype[y]=n.memory[y],Number.prototype[y]=n.memory[y],Function.prototype[y]=n.memory[y],Array.prototype[y]=n.memory[y],Boolean.prototype[y]=n.memory[y];var g=n.run(e[u],m[v]);if("object"==typeof m[v])for(var y in delete m[v].$index,n.memory)delete m[v][y];else for(var y in delete String.prototype.$index,delete Number.prototype.$index,delete Function.prototype.$index,delete Array.prototype.$index,delete Boolean.prototype.$index,n.memory)delete String.prototype[y],delete Number.prototype[y],delete Function.prototype[y],delete Array.prototype[y],delete Boolean.prototype[y];g&&i.push(g)}}else i=e}}else{var h=n.fillout(t,u),_=n.fillout(t,e[u]);void 0!==h&&void 0!==_&&(i[h]=_)}else if("string"==typeof e[u])if((l=n.tokenize(e[u]))&&"#?"===l.name){var b=n.fillout(t,"{{"+l.expression+"}}");b!=="{{"+l.expression+"}}"&&b&&(i[u]=b)}else{var x;void 0!==(x=n.run(e[u],t))&&(i[u]=x)}else void 0!==(x=n.run(e[u],t))&&(i[u]=x)}}return i},fillout:function(e,t,o){var i=t;if(r.is_template(t)){var l=t.match(/\{\{(.*?)\}\}/g);if(!l)return i;if(o)i=n._fillout({variable:l[0],data:e,template:null});else for(var s=0;s<l.length;s++){var a=l[s];i=n._fillout({variable:a,data:e,template:i})}}return i},_fillout:function(e){var r=/^\{\{((?!\}\}).)*\}\}$/,o=e.variable,n=e.data,i=e.template;try{var l=o.replace(/\{\{(.*?)\}\}/g,"$1");if(n){["number","string","array","boolean","function"].indexOf(-1===typeof n)&&(n.$root=t);var s=/function\([ ]*\)[ ]*\{(.*)\}[ ]*$/g.exec(l),a=(s?Function("with(this) {"+s[1]+"}").bind(n):/\breturn [^;]+;?[ ]*$/.test(l)&&/return[^}]*$/.test(l)?Function("with(this) {"+l+"}").bind(n):Function("with(this) {return ("+l+")}").bind(n))();return delete n.$root,a&&(a=a.valueOf()),void 0===a?i:a?i?r.test(i)?a:i.replace(o,a):a:i?r.test(i)?a:i.replace(o,""):""}return i}catch(e){return i}}},i={$val:null,$selected:[],$injected:[],$progress:null,exec:function(e,t,o){if("string"==typeof e);else if(r.is_array(e))for(var n=0;n<e.length;n++)i.exec(e[n],t+"["+n+"]",o);else for(var l in e)if("$root"!==l){if(o(l,e[l])){var s=i.$selected.length;i.$selected.push({index:s,key:l,path:t,object:e,value:e[l]})}i.exec(e[l],t+'["'+l+'"]',o)}},inject:function(e,t){i.$injected=e;try{t&&(i.$injected=JSON.parse(e))}catch(e){}return Object.keys(i.$injected).length>0&&i.select(i.$injected),i},select:function(e,t,o){var n=e;try{o&&(n=JSON.parse(e))}catch(e){}return t?(i.$selected=[],i.exec(n,"",t)):i.$selected=null,n&&(r.is_array(n)||"object"==typeof n)?(i.$progress||(r.is_array(n)?(i.$val=[],i.$selected_root=[]):(i.$val={},i.$selected_root={})),Object.keys(n).forEach(function(e){i.$val[e]=n[e],i.$selected_root[e]=n[e]})):(i.$val=n,i.$selected_root=n),i.$progress=!0,i},transformWith:function(e,o){i.$parsed=[],i.$progress=null;var l=e;try{o&&(l=JSON.parse(e))}catch(e){}if(i.$template_root=l,String.prototype.$root=i.$selected_root,Number.prototype.$root=i.$selected_root,Function.prototype.$root=i.$selected_root,Array.prototype.$root=i.$selected_root,Boolean.prototype.$root=i.$selected_root,t=i.$selected_root,i.$selected&&i.$selected.length>0)i.$selected.sort(function(e,t){return t.path.length-e.path.length}).forEach(function(e){var t=n.run(l,e.object);i.$selected_root=r.resolve(i.$selected_root,e.path,t),e.object=t}),i.$selected.sort(function(e,t){return e.index-t.index});else{var s=n.run(l,i.$selected_root);i.$selected_root=r.resolve(i.$selected_root,"",s)}return delete String.prototype.$root,delete Number.prototype.$root,delete Function.prototype.$root,delete Array.prototype.$root,delete Boolean.prototype.$root,i},transform:function(e,o){i.$parsed=[],i.$progress=null;var l=e;try{o&&(l=JSON.parse(e))}catch(e){}if(i.$template_root=i.$selected_root,String.prototype.$root=l,Number.prototype.$root=l,Function.prototype.$root=l,Array.prototype.$root=l,Boolean.prototype.$root=l,t=l,i.$selected&&i.$selected.length>0)i.$selected.sort(function(e,t){return t.path.length-e.path.length}).forEach(function(e){var t=n.run(e.object,l);i.$template_root=r.resolve(i.$template_root,e.path,t),i.$selected_root=i.$template_root,e.object=t}),i.$selected.sort(function(e,t){return e.index-t.index});else{var s=n.run(i.$selected_root,l);i.$template_root=r.resolve(i.$template_root,"",s),i.$selected_root=i.$template_root}return delete String.prototype.$root,delete Number.prototype.$root,delete Function.prototype.$root,delete Array.prototype.$root,delete Boolean.prototype.$root,i},objects:function(){return i.$progress=null,i.$selected?i.$selected.map(function(e){return e.object}):[i.$selected_root]},keys:function(){return i.$progress=null,i.$selected?i.$selected.map(function(e){return e.key}):Array.isArray(i.$selected_root)?Object.keys(i.$selected_root).map(function(e){return parseInt(e)}):Object.keys(i.$selected_root)},paths:function(){return i.$progress=null,i.$selected?i.$selected.map(function(e){return e.path}):Array.isArray(i.$selected_root)?Object.keys(i.$selected_root).map(function(e){return"["+e+"]"}):Object.keys(i.$selected_root).map(function(e){return'["'+e+'"]'})},values:function(){return i.$progress=null,i.$selected?i.$selected.map(function(e){return e.value}):Object.values(i.$selected_root)},root:function(){return i.$progress=null,i.$selected_root}},l=JSON.stringify;return JSON.stringify=function(e,t,r){return-1!==["number","string","boolean"].indexOf(typeof e)?l(e,t,r):l(e,t||function(e,t){if(!(i.$injected&&i.$injected.length>0&&-1!==i.$injected.indexOf(e)||"$root"===e||"$index"===e||e in n.memory))return"function"==typeof t?"("+t.toString()+")":t},r)},{TRANSFORM:n,SELECT:i,Conditional:o,Helper:r,inject:i.inject,select:i.select,transform:n.transform}}};