import index from"/static/html/react/waves-auth/index.mjs";import wavesKeeper from"/static/html/components/component_modules/WavesKeeper/WavesKeeper.mjs";import store from"/static/html/components/component_modules/staticProperty/staticProperty.mjs";import matcher from"/static/html/components/component_modules/matcher/matcher.mjs";import conf from"/static/html/components/component_modules/matcher/matcher/this/database/config/index.mjs";import addEventListener from"/static/html/components/component_modules/addEventListener/addEventListener.mjs";import account from"/static/html/components/component_modules/account/account.mjs";import Authtorization from"/static/html/components/component_modules/authtorization/authtorization.mjs";customElements.define("waves-auth",class extends HTMLElement{static get observedAttributes(){return["feed"]}constructor(){super();let e=[],t=[],a=[],n=[];function s(t,a){return new Promise(function(a,n){t.verify=[];let s={};s=t.slot?t.slot:t.parent,t.this.hasAttribute("preset")?0===t.this.getAttribute("preset").length?(t["path-template"]=`/static/html/components/${t.component}/template/${s}.html`,t.preset="default",t.verify.preset=!0):(t["path-template"]=`/static/html/components/${t.component}/template/${t.this.getAttribute("preset")}/${t.component}-${t.this.getAttribute("preset")}.html`,t.preset=`${t.this.getAttribute("preset")}`,t.verify.preset=!0):(t["path-template"]=`/static/html/components/${t.component}/${t.component}.html`,t.verify.preset=!1),fetch(t["path-template"]).then(function(e){if(e.ok)return e.text()}).then(function(n){let s=(new DOMParser).parseFromString(n,"text/html");t.template=s.getElementsByTagName("template")[0].content.cloneNode(!0),function(t){return new Promise(function(a,n){t["path-external"]=`/static/html/components/${t.component}/external/${t.component}-external.html`,fetch(t["path-external"]).then(function(e){return!1===e.ok?e.ok:e.text()}).then(function(n){if(!1===n);else{let s=(new DOMParser).parseFromString(n,"text/html");t.external=s.querySelectorAll("section"),function(t){return new Promise(function(a,n){t["external-property"]=e["external-property"];let s=[],o=[],i=[];for(let e=0;e<t.external.length;e++){for(let a=0;a<t.external[e].children.length;a++)switch(t.external[e].children[a].tagName){case"SCRIPT":t.external[e].getAttribute("id")&&(o.script=t.external[e].children[a]);break;case"COMPONENT-ID":o.id=t.external[e].children[a].innerText;break;case"COMPONENT-ACTION":for(let n=0;n<t.external[e].children[a].children.length;n++)i.push(t.external[e].children[a].children[n].innerText);o.actions=i}s.push(o),o=[]}t["external-property"]=s,a(t)}).catch(e=>{})}(t).then(e=>{0===e["external-property"].length?a(e):function(e){return new Promise(function(t,a){e["words-action"]=[];let n=[];for(let a=0;a<e["external-property"].length;a++){for(let t=0;t<e["external-property"][a].actions.length;t++)for(let s=0;s<e.words.length;s++)-1!==e["external-property"][a].actions[t].indexOf(e.words[s])&&("shadowRoot"!==e.words[s]&&"shadow"!==e.words[t]||(n.shadow=!0),"light"!==e.words[s]&&"лайт"!==e.words[t]||(n.light=!0),"editor"===e.words[s]&&(n.editor=!0),"слайдер"===e.words[s]&&(n["editor-slider"]=!0),"swap"===e.words[s]&&(n.swap=!0));e["words-action"]=n;for(let t in e["external-property"])for(let a in e["external-property"][t])switch(a){case"id":let n=document.createElement(e["external-property"][t][a]);n.setAttribute("type","external"),e.this.appendChild(n)}t(e)}})}(e).then(e=>{a(e)})})}}).catch(e=>{throw e})})}(t).then(e=>{(function(e,t,a){return new Promise(function(t,a){e["template-shadow"]=[],e["template-light"]=[];let n=[];n.swap=!1,n.blog=!1,n.external=!1,n.light=!1,n.slider=!1,n.one=!1,n.sliderText=!1,n.text=!1;for(let t=0;t<e.type.length;t++){if(-1!==e.type[t].indexOf("slider")&&e.type[t].split("-").length>1){n.slider=!0;for(let a in e.type[t].split("-"))switch(e.type[t].split("-")[a]){case"one":n.one=!0}}if(e.type[t].length)if(e.type[t].split("-").length>1)switch(e.type[t].split("-")[0]){case"blog":n.blog=!0;break;default:console.log("типы не отслеживаются",e.type[t])}else switch(e.type[t]){case"swap":n.swap=!0;break;case"external":n.external=!0;break;case"light":n.light=!0;break;case"slider":n.slider=!0;break;case"sliderText":n.sliderText=!0;break;case"text":n.text=!0}}if(!0===n.swap){for(let t=0;t<e.this.children.length;t++)1===e.this.children[t].tagName.split("-").length?("view"===e.this.children[t].slot&&(e.this.children[t].className="wall"),e["template-light"].push(e.this.children[t])):!0===e.getAttribute(e.this.children[t],"light","template")?(e.this.children[t].setAttribute("type",`${e.this.children[t].getAttribute("type")}-external`),o(e.this.children[t],e),e["template-light"].push(e.this.children[t])):(e.this.children[t].setAttribute("type",`${e.this.children[t].getAttribute("type")}-external`),o(e.this.children[t],e),e["template-shadow"].push(e.this.children[t]));for(let t=0;t<e.template.children.length;t++)1===e.template.children[t].tagName.split("-").length?("view"===e.template.children[t].slot&&(e.template.children[t].className="wall"),e["template-light"].push(e.template.children[t])):!0===e.getAttribute(e.template.children[t],"light","template")?(e.template.children[t].setAttribute("type",`${e.template.children[t].getAttribute("type")}-external`),o(e.template.children[t],e),e["template-light"].push(e.template.children[t])):(e.template.children[t].setAttribute("type",`${e.template.children[t].getAttribute("type")}-external`),o(e.template.children[t],e),e["template-shadow"].push(e.template.children[t]))}else{for(let t=0;t<e.this.children.length;t++)1===e.this.children[t].tagName.split("-").length?("view"===e.this.children[t].slot&&(e.this.children[t].className="wall"),e["template-shadow"].push(e.this.children[t])):!0===e.getAttribute(e.this.children[t],"light","template")?(o(e.this.children[t],e),e["template-shadow"].push(e.this.children[t])):(o(e.this.children[t],e),e["template-light"].push(e.this.children[t]));for(let t=0;t<e.template.children.length;t++)1===e.template.children[t].tagName.split("-").length?("view"===e.template.children[t].slot&&(e.template.children[t].className="wall"),e["template-shadow"].push(e.template.children[t])):!0===e.getAttribute(e.template.children[t],"light","template")?(o(e.template.children[t],e),e["template-shadow"].push(e.template.children[t])):(o(e.template.children[t],e),e["template-light"].push(e.template.children[t]))}for(let t in n)e.verify[t]=n[t];!0===e.verify.slider?function(e){return new Promise(function(t,a){fetch(`/static/html/components/varan-slider/template/${e.slot}.html`).then(function(e){if(e.ok)return e.text()}).then(function(a){let n=(new DOMParser).parseFromString(a,"text/html");e.slider=n.getElementsByTagName("template")[0].content.cloneNode(!0);let s=document.createElement("section");s.className="slider",s.slot="view",s.appendChild(e.slider),e.slider=s,e["slider-template"]=s;for(let t=0;t<e.type.length;t++)"slider-one-text"===e.type[t]&&(e.verify.sliderText=!0);matcher.database.request.functions.getObject(e).then(e=>{e.get?(pagination.init(e),pagination.action(e).then(e=>{t(e)})):t(e)})}).catch(e=>e)})}(e).then(e=>{e["template-light"].push(e.slider),e.this.appendChild(e.slider),function(e,t){return new Promise(function(t,a){(function(e,t){return new Promise(function(a,n){for(let n=0;n<e.state.length;n++)for(let s=0;s<e[`template-${e.state[n]}`].length;s++)0===e[`template-${e.state[n]}`][s].getElementsByClassName(t).length||(e.slider=e[`template-${e.state[n]}`][s].getElementsByClassName(t)[0],a(e[`template-${e.state[n]}`][s].getElementsByClassName(t)[0]))})})(e,"peppermint").then(a=>{(function(e){return new Promise(function(t,a){t(Peppermint(e,{dots:!1,slideshow:!1,speed:500,slideshowInterval:5e3,stopSlideshowAfterInteraction:!0,onSetup:function(e){}}))})})(a).then(a=>{e.slider=a,t(e)})}),t(e)})}(e).then(e=>{if(!0===e.verify.one)for(let a=0;a<e.state.length;a++)for(let n=0;n<e[`template-${e.state[a]}`].length;n++)"wall"===e[`template-${e.state[a]}`][n].className&&(e[`template-${e.state[a]}`].splice(n,1),t(e));else t(e)})}):t(e)})})(e,e["type-swap"],e["type-external"]).then(e=>{let t={};for(let a=0;a<e["template-light"].length;a++)"VARAN-MENU"===e["template-light"][a].tagName&&(t=e["template-light"].splice(a,1),e["template-light"].push(t[0]));if(!0===e.verify.swap){if(0!==e["template-shadow"].length){e.this.attachShadow({mode:"open"}),e.shadowRoot=!0;for(let t=0;t<e["template-shadow"].length;t++)e.this.shadowRoot.appendChild(e["template-shadow"][t])}if(0!==e["template-light"].length)for(let t=0;t<e["template-light"].length;t++)e.this.appendChild(e["template-light"][t])}else{if(0!==e["template-shadow"].length){e.this.attachShadow({mode:"open"}),e.shadowRoot=!0;for(let t in e["template-shadow"])e.this.shadowRoot.appendChild(e["template-shadow"][t])}if(0!==e["template-light"].length)for(let t in e["template-light"])e.this.appendChild(e["template-light"][t])}a(e)})})}).catch(e=>e)})}function o(e,t){return new Promise(function(a,n){let s=!1;for(let t=0;t<document.querySelectorAll("script").length;t++)-1!==document.querySelectorAll("script")[t].src.indexOf(e.tagName.toLowerCase())&&(s=!0);if(!0===s)console.log("модуль загружен");else{const s=document.createElement("script");s.type="module",s.src=`./static/html/components/${e.tagName.toLowerCase()}/${e.tagName.toLowerCase()}.mjs`,s.setAttribute("async",""),s.onload=a,s.onerror=n,t.this.appendChild(s)}})}var i;t.push("component-id"),t.push("script"),t.push("component-action"),a.push("h1"),a.push("innerText"),n.push("shadowRoot"),n.push("head"),n.push("shadow"),n.push("light"),n.push("lightDom"),n.push("editor"),n.push("слайдер"),n.push("swap"),e.this=this,e["type-supported"]=a,(i=this,new Promise(function(e,t){let a=[];a.staticProperty=[],a.staticProperty.c=0,a.state=[],a.state.push("shadow"),a.state.push("light"),a.words=n,a["type-swap"]=!1,a["type-external"]=!1,a["document-offsetWidth"]=document.body.offsetWidth;let s=!1;if(a.getAttribute=((e,t,a)=>{if("template"===a){if(!e.getAttribute("type"))return e.setAttribute("type","default"),!1;for(let a=0;a<e.getAttribute("type").split("-").length;a++)e.getAttribute("type").split("-")[a]===t&&(s=!0);return s}if(e[`verify-${t}`]=!1,0===e.this.getAttribute("type").split("-").length)return!1;for(let a=0;a<e.this.getAttribute("type").split("-").length;a++)e.this.getAttribute("type").split("-")[a]===t?e[`verify-${t}`]=!0:e[`verify-${t}`]=!1;return console.assert(!1,e),e[`verify-${t}`]}),i.tagName.toLowerCase()&&(a.component=i.tagName.toLowerCase()),"object"!=typeof i);else{if(i.getAttribute("type")){a.type=i.getAttribute("type").split("-");for(let e=0;e<a.type.length;e++)a.type[e]=a.type[e].replace(/:/g,"-");for(let e in a.type)switch(a.type[e]){case"swap":a["type-swap"]=!0;break;case"external":a["type-external"]=!0}}else a.type=["default"],i.setAttribute("type","default");if(i.slot?a.slot=i.slot:(i.slot=i.tagName.toLowerCase(),a.slot=i.slot),i.getAttribute("type")){let e=!1;for(let t in i.getAttribute("type").split("-"))-1!==i.getAttribute("type").split("-")[t].indexOf("style:")&&(e=!0);a["style-custom"]=!0===e?"not-default":"default"}}a.shadowRoot=!1,a.this=i,e(a)})).then(e=>{s(e).then(e=>{(function(e){return new Promise(function(t,a){let n=document.createElement("style"),s=document.createElement("style"),o={};(o=e.slot?e.slot:e.parent)||console.assert(!1,"не установленны ни слот ни парент");for(let t=0;t<e.type.length;t++)"swap"===e.type[t]?"scoped"===e.type[t]&&n.setAttribute("scoped",""):"scoped"===e.type[t]&&s.setAttribute("scoped","");for(let a=0;a<e.state.length;a++){switch(e[`path-style-${e.state[a]}`]=`@import '/static/html/components/${e.component}/${e.state[a]}/${e.component}.css'; @import '/static/html/components/${e.component}/${e.state[a]}/${e.component}-custom.css';`,e.state[a]){case"shadow":!0===e.verify.preset&&(e[`path-style-${e.state[a]}-preset`]=`@import '/static/html/components/${e.component}/template/${o}.css';`),n.innerText=e[`path-style-${e.state[a]}`]+e[`path-style-${e.state[a]}-preset`];break;case"light":!0===e.verify.preset&&(e[`path-style-${e.state[a]}-preset`]=`@import '/static/html/components/${e.component}/template/${o}.css';`),s.innerText=e[`path-style-${e.state[a]}`]+e[`path-style-${e.state[a]}-preset`]}"swap"===e.state[a]?!0===e.shadowRoot?(e.this.shadowRoot.appendChild(s),e.this.appendChild(n),t(e)):e.this.appendChild(n):!0===e.shadowRoot?(e.this.shadowRoot.appendChild(n),e.this.appendChild(s),t(e)):e.this.appendChild(s)}t(e)})})(e).then(e=>{!async function(e){bundle.default(e,null,async function(t,a){await store({input:"waves-auth",type:"obj",this:e.this,parent:e.this.getAttribute("parent"),slot:e.slot},"set","type");let n={};new((n=await Authtorization()).class.network)({pid:"test1"}),new n.class.network({pid:"test2"}),new n.class.local;let s=new n.class.interface({pid:"waves-auth"});new n.class.network({pid:"test3"}),new n.class.network({pid:"test4"}),s.action();try{WavesKeeper.on("update",async t=>{if(a.isEmpty(t)&&await WavesKeeper.auth({data:"Auth on my  site"}),await a.waves.auth({input:"auth",data:t,type:"checked",password:[]},"auth","type")){await store({input:"waves-auth",type:"all"},"get","type");let t=await wavesKeeper.getPublicState(),n=t.account.balance.available/1e8,s={};switch(t.network.code){case"T":s="Testnet";break;case"W":s="Mainnet";break;default:s="Custome"}let o=await store({input:"waves-balance",type:"all"},"get","type"),i=conf.account.dappaddress,l=conf.account.testnodes,r=await window.wt.nodeInteraction.accountDataByKey(`${t.account.address}_balance`,window.wt.dappaddress,window.wt.baseUri),c=await window.wt.nodeInteraction.balanceDetails(i,l);a.isEmpty(r)&&((r={}).value=0),c=c.regular/1e8;let p=r.value/1e8;await store({input:"state",type:"obj",state:{address:t.account.address,waves:n,network:s}},"set","type"),o["waves-balance"][0].this.shadowRoot.querySelector("#multiDomainAccount").innerText=`${conf.account.dappaddress}`,o["waves-balance"][0].this.shadowRoot.querySelector(".regularBalance").innerText=`waves: ${c}`,o["waves-balance"][0].this.shadowRoot.querySelector(".balanceAccount").innerText=`${p}`;let h=await WavesKeeper.publicState(),d=await matcher.server({input:"waves-auth",path:`/winner/${h.account.address}`,type:"winner"},"get","type");if(d.mongo.length>0){let a=`<div class="input">Выполнен вход под аккаунтом</div>\n                             <div class="account">\n                             <div class="network">${s}</div>\n                             <div class="address">${t.account.address}</div>\n                             <div class="balance">Waves: ${n}</div>\n                             </div>`,o=document.createElement("div");o.className="winner";for(let e=0;e<d.mongo.length;e++){let t=+d.mongo[e].winner.payment[0].amount/1e8+.014;t=t.toFixed(3);let a=`<div class="info">\n                                    <div> Лот: ${d.mongo[e].object}</div>\n                                    <div class="priceLot"> Стоимость лота: ${t} Waves</div>\n                                    <button class="pay ${d.mongo[e].object}">Оплатить</button>\n                              </div>`;o.insertAdjacentHTML("beforeend",a)}e.this.shadowRoot.querySelector(".register").innerHTML="",e.this.shadowRoot.querySelector(".register").insertAdjacentHTML("afterbegin",a),e.this.shadowRoot.querySelector("#winner").style.display="flex",e.this.shadowRoot.querySelector("#winner").innerHTML="",e.this.shadowRoot.querySelector("#winner").appendChild(o);let i=e.this.shadowRoot.querySelectorAll(".pay");for(let e=0;e<i.length;e++)await addEventListener({input:"waves-auth",data:i[e],type:"payLot"},"set","type")}else{let a=`<div class="input">Выполнен вход под аккаунтом</div>\n                             <div class="account">\n                             <div class="network">${s}</div>\n                             <div class="address">${t.account.address}</div>\n                             <div class="balance">Waves: ${n}</div>\n                             </div>`;e.this.shadowRoot.querySelector("#winner").innerHTML="",e.this.shadowRoot.querySelector("#winner").style.display="none",e.this.shadowRoot.querySelector(".register").innerHTML="",e.this.shadowRoot.querySelector(".register").insertAdjacentHTML("afterbegin",a)}}})}catch(t){let a='<div class="input"> У вас не установлен Waves Keepper</div>\n                     <div id="account">\n                     <div class="account reg">Зарегистрироваться</div>\n                     <div class="account auth">Войти</div>\n                     </div>';e.this.shadowRoot.querySelector("#winner").innerHTML="",e.this.shadowRoot.querySelector("#winner").style.display="none",e.this.shadowRoot.querySelector(".register").innerHTML="",e.this.shadowRoot.querySelector(".register").insertAdjacentHTML("afterbegin",a);let n=e.this.shadowRoot.querySelectorAll(".account");for(let e=0;e<n.length;e++)await addEventListener({input:"waves-auth",data:n[e],type:`${n[e].className.split(" ")[1]}`},"set","type");console.warn("нет waves keepper",t);let s=conf.account.dappaddress,o=conf.account.testnodes,i=await window.wt.nodeInteraction.balanceDetails(s,o);i=i.regular/1e8;let l=await store({input:"waves-balance",type:"all"},"get","type");l["waves-balance"][0].this.shadowRoot.querySelector("#multiDomainAccount").innerText=`${conf.account.dappaddress}`,l["waves-balance"][0].this.shadowRoot.querySelector(".regularBalance").innerText=`waves: ${i}`}e.this.shadowRoot.querySelector(".register").addEventListener("click",async function(t){try{t.target.innerText="выполняется вход";let n=await WavesKeeper.publicState();if(await a.waves.auth({input:"auth",data:n,type:"checked",password:[]},"auth","type")){let t=await matcher.server({input:"waves-auth",path:`/winner/${n.account.address}`,type:"winner"},"get","type"),s=(await store({input:"waves-auth",type:"all"},"get","type"),await wavesKeeper.getPublicState()),o=s.account.balance.available/1e8,i={};switch(s.network.code){case"T":i="Testnet";break;case"W":i="Mainnet";break;default:i="Custome"}let l=await store({input:"waves-balance",type:"all"},"get","type"),r=conf.account.dappaddress,c=conf.account.testnodes,p=await window.wt.nodeInteraction.balanceDetails(r,c),h=await window.wt.nodeInteraction.accountDataByKey(`${s.account.address}_balance`,window.wt.dappaddress,window.wt.baseUri);a.isEmpty(h)&&((h={}).value=0),p=p.regular/1e8;let d=h.value/1e8;await store({input:"state",type:"obj",state:{address:s.account.address,waves:o,network:i}},"set","type"),l["waves-balance"][0].this.shadowRoot.querySelector("#multiDomainAccount").innerText=`${conf.account.dappaddress}`,l["waves-balance"][0].this.shadowRoot.querySelector(".regularBalance").innerText=`waves: ${p}`,l["waves-balance"][0].this.shadowRoot.querySelector(".balanceAccount").innerText=`${d}`;let u={};if(t.mongo.length>0){let a=document.createElement("div");a.className="winner";for(let e=0;e<t.mongo.length;e++){let n=+t.mongo[e].winner.payment[0].amount/1e8+.014;n=n.toFixed(3);let s=`<div class="info">\n                                    <div> Лот: ${t.mongo[e].object}</div>\n                                    <div class="priceLot"> Стоимость лота: ${n} Waves</div>\n                                    <button class="pay ${t.mongo[e].object}">Оплатить</button>\n                              </div>`;a.insertAdjacentHTML("beforeend",s)}u=`<div class="input">Выполнен вход под аккаунтом</div>\n                             <div class="account">\n                             <div class="network">${i}</div>\n                             <div class="address">${s.account.address}</div>\n                             <div class="balance">Waves: ${o}</div>\n                              <div class="fiat"><slot name="fiat-form"></slot></div>\n                             </div>`,e.this.shadowRoot.querySelector(".register").innerHTML="",e.this.shadowRoot.querySelector(".register").insertAdjacentHTML("afterbegin",u),e.this.shadowRoot.querySelector("#winner").style.display="flex",e.this.shadowRoot.querySelector("#winner").innerHTML="",e.this.shadowRoot.querySelector("#winner").appendChild(a);let n=e.this.shadowRoot.querySelectorAll(".pay");for(let e=0;e<n.length;e++)await addEventListener({input:"waves-auth",data:n[e],type:"payLot"},"set","type")}else u=`<div class="input">Выполнен вход под аккаунтом</div>\n                             <div class="account">\n                             <div class="network">${i}</div>\n                             <div class="address">${s.account.address}</div>\n                             <div class="balance">Waves: ${o}</div>\n                             <div class="fiat"><slot name="fiat-form"></slot></div>\n                             </div>`,e.this.shadowRoot.querySelector(".register").innerHTML="",e.this.shadowRoot.querySelector(".register").insertAdjacentHTML("afterbegin",u)}}catch(e){console.warn("нет waves keepper",e)}})})}(e)})})})}connectedCallback(){}disconnectedCallback(){console.log("disconnected callback")}componentWillMount(){console.log("component will mount")}componentDidMount(){console.log("component did mount")}componentWillUnmount(){console.log("component will unmount")}componentDidUnmount(){console.log("component did unmount")}});