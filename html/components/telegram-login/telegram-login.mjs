import webSocket from"/static/html/components/component_modules/webSocket/webSocket.mjs";import action from"/static/html/components/component_modules/action/action.mjs";import Login from"/static/html/components/component_modules/login/login.mjs";import store from"/static/html/components/component_modules/staticProperty/staticProperty.mjs";import Config from"/static/html/components/component_modules/config/config.mjs";customElements.define("telegram-login",class extends HTMLElement{static get observedAttributes(){return["feed"]}constructor(){super();let e=[],t=[],o=[],s=[];function n(e,t,o){return new Promise(function(t,o){e["template-shadow"]=[],e["template-light"]=[];let s=[];s.swap=!1,s.blog=!1,s.external=!1,s.light=!1,s.slider=!1,s.one=!1,s.sliderText=!1,s.text=!1;for(let t=0;t<e.type.length;t++){if(-1!==e.type[t].indexOf("slider")&&e.type[t].split("-").length>1){s.slider=!0;for(let o in e.type[t].split("-"))switch(e.type[t].split("-")[o]){case"one":s.one=!0}}if(e.type[t].length)if(e.type[t].split("-").length>1)switch(e.type[t].split("-")[0]){case"blog":s.blog=!0;break;default:console.log("типы не отслеживаются",e.type[t])}else switch(e.type[t]){case"swap":s.swap=!0;break;case"external":s.external=!0;break;case"light":s.light=!0;break;case"slider":s.slider=!0;break;case"sliderText":s.sliderText=!0;break;case"text":s.text=!0}}if(!0===s.swap){for(let t=0;t<e.this.children.length;t++)1===e.this.children[t].tagName.split("-").length?("view"===e.this.children[t].slot&&(e.this.children[t].className="wall"),e["template-light"].push(e.this.children[t])):!0===e.getAttribute(e.this.children[t],"light","template")?(e.this.children[t].setAttribute("type",`${e.this.children[t].getAttribute("type")}-external`),l(e.this.children[t],e),e["template-light"].push(e.this.children[t])):(e.this.children[t].setAttribute("type",`${e.this.children[t].getAttribute("type")}-external`),l(e.this.children[t],e),e["template-shadow"].push(e.this.children[t]));for(let t=0;t<e.template.children.length;t++)1===e.template.children[t].tagName.split("-").length?("view"===e.template.children[t].slot&&(e.template.children[t].className="wall"),e["template-light"].push(e.template.children[t])):!0===e.getAttribute(e.template.children[t],"light","template")?(e.template.children[t].setAttribute("type",`${e.template.children[t].getAttribute("type")}-external`),l(e.template.children[t],e),e["template-light"].push(e.template.children[t])):(e.template.children[t].setAttribute("type",`${e.template.children[t].getAttribute("type")}-external`),l(e.template.children[t],e),e["template-shadow"].push(e.template.children[t]))}else{for(let t=0;t<e.this.children.length;t++)1===e.this.children[t].tagName.split("-").length?("view"===e.this.children[t].slot&&(e.this.children[t].className="wall"),e["template-shadow"].push(e.this.children[t])):!0===e.getAttribute(e.this.children[t],"light","template")?(l(e.this.children[t],e),e["template-shadow"].push(e.this.children[t])):(l(e.this.children[t],e),e["template-light"].push(e.this.children[t]));for(let t=0;t<e.template.children.length;t++)1===e.template.children[t].tagName.split("-").length?("view"===e.template.children[t].slot&&(e.template.children[t].className="wall"),e["template-shadow"].push(e.template.children[t])):!0===e.getAttribute(e.template.children[t],"light","template")?(l(e.template.children[t],e),e["template-shadow"].push(e.template.children[t])):(l(e.template.children[t],e),e["template-light"].push(e.template.children[t]))}for(let t in s)e.verify[t]=s[t];!0===e.verify.slider?function(e){return new Promise(function(t,o){fetch(`/static/html/components/varan-slider/template/${e.slot}.html`).then(function(e){if(e.ok)return e.text()}).then(function(o){let s=new DOMParser,n=s.parseFromString(o,"text/html");e.slider=n.getElementsByTagName("template")[0].content.cloneNode(!0);let i=document.createElement("section");i.className="slider",i.slot="view",i.appendChild(e.slider),e.slider=i,e["slider-template"]=i;for(let t=0;t<e.type.length;t++)"slider-one-text"===e.type[t]&&(e.verify.sliderText=!0);matcher.database.request.functions.getObject(e).then(e=>{e.get?(pagination.init(e),pagination.action(e).then(e=>{t(e)})):t(e)})}).catch(e=>e)})}(e).then(e=>{e["template-light"].push(e.slider),e.this.appendChild(e.slider),function(e,t){return new Promise(function(o,s){if(t){switch(t){case"slider":(function(e,t){return new Promise(function(o,s){for(let s=0;s<e.state.length;s++)for(let n=0;n<e[`template-${e.state[s]}`].length;n++)0===e[`template-${e.state[s]}`][n].getElementsByClassName(t).length||(e.slider=e[`template-${e.state[s]}`][n].getElementsByClassName(t)[0],o(e[`template-${e.state[s]}`][n].getElementsByClassName(t)[0]))})})(e,"peppermint").then(t=>{(function(e){return new Promise(function(t,o){t(Peppermint(e,{dots:!1,slideshow:!1,speed:500,slideshowInterval:5e3,stopSlideshowAfterInteraction:!0,onSetup:function(e){}}))})})(t).then(t=>{e.slider=t,o(e)})})}o(e)}else o(e)})}(e,"slider").then(e=>{if(!0===e.verify.one)for(let o=0;o<e.state.length;o++)for(let s=0;s<e[`template-${e.state[o]}`].length;s++)"wall"===e[`template-${e.state[o]}`][s].className&&(e[`template-${e.state[o]}`].splice(s,1),t(e));else t(e)})}):t(e)})}function i(t,o){return new Promise(function(o,s){t.verify=[];let i={};i=t.slot?t.slot:t.parent,t.this.hasAttribute("preset")?0===t.this.getAttribute("preset").length?(t["path-template"]=`/static/html/components/${t.component}/template/${i}.html`,t.preset="default",t.verify.preset=!0):(t["path-template"]=`/static/html/components/${t.component}/template/${t.this.getAttribute("preset")}/${t.component}-${t.this.getAttribute("preset")}.html`,t.preset=`${t.this.getAttribute("preset")}`,t.verify.preset=!0):(t["path-template"]=`/static/html/components/${t.component}/${t.component}.html`,t.verify.preset=!1),fetch(t["path-template"]).then(function(e){if(e.ok)return e.text()}).then(function(s){let i=(new DOMParser).parseFromString(s,"text/html");t.template=i.getElementsByTagName("template")[0].content.cloneNode(!0),function(t){return new Promise(function(o,s){t["path-external"]=`/static/html/components/${t.component}/external/${t.component}-external.html`,fetch(t["path-external"]).then(function(e){return!1===e.ok?e.ok:e.text()}).then(function(s){if(!1===s);else{let n=new DOMParser,i=n.parseFromString(s,"text/html");t.external=i.querySelectorAll("section"),function(t){return new Promise(function(o,s){t["external-property"]=e["external-property"];let n=[],i=[],l=[];for(let e=0;e<t.external.length;e++){for(let o=0;o<t.external[e].children.length;o++)switch(t.external[e].children[o].tagName){case"SCRIPT":t.external[e].getAttribute("id")&&(i.script=t.external[e].children[o]);break;case"COMPONENT-ID":i.id=t.external[e].children[o].innerText;break;case"COMPONENT-ACTION":for(let s=0;s<t.external[e].children[o].children.length;s++)l.push(t.external[e].children[o].children[s].innerText);i.actions=l}n.push(i),i=[]}t["external-property"]=n,o(t)}).catch(e=>{})}(t).then(e=>{0===e["external-property"].length?o(e):function(e){return new Promise(function(t,o){e["words-action"]=[];let s=[];for(let o=0;o<e["external-property"].length;o++){for(let t=0;t<e["external-property"][o].actions.length;t++)for(let n=0;n<e.words.length;n++)-1!==e["external-property"][o].actions[t].indexOf(e.words[n])&&("shadowRoot"!==e.words[n]&&"shadow"!==e.words[t]||(s.shadow=!0),"light"!==e.words[n]&&"лайт"!==e.words[t]||(s.light=!0),"editor"===e.words[n]&&(s.editor=!0),"слайдер"===e.words[n]&&(s["editor-slider"]=!0),"swap"===e.words[n]&&(s.swap=!0));e["words-action"]=s;for(let t in e["external-property"])for(let o in e["external-property"][t])switch(o){case"id":let s=document.createElement(e["external-property"][t][o]);s.setAttribute("type","external"),e.this.appendChild(s)}t(e)}})}(e).then(e=>{o(e)})})}}).catch(e=>{throw e})})}(t).then(e=>{n(e,e["type-swap"],e["type-external"]).then(e=>{let t={};for(let o=0;o<e["template-light"].length;o++)"VARAN-MENU"===e["template-light"][o].tagName&&(t=e["template-light"].splice(o,1),e["template-light"].push(t[0]));if(!0===e.verify.swap){if(0!==e["template-shadow"].length){e.this.attachShadow({mode:"open"}),e.shadowRoot=!0;for(let t=0;t<e["template-shadow"].length;t++)e.this.shadowRoot.appendChild(e["template-shadow"][t])}if(0!==e["template-light"].length)for(let t=0;t<e["template-light"].length;t++)e.this.appendChild(e["template-light"][t])}else{if(0!==e["template-shadow"].length){e.this.attachShadow({mode:"open"}),e.shadowRoot=!0;for(let t in e["template-shadow"])e.this.shadowRoot.appendChild(e["template-shadow"][t])}if(0!==e["template-light"].length)for(let t in e["template-light"])e.this.appendChild(e["template-light"][t])}o(e)})})}).catch(e=>e)})}function l(e,t){return new Promise(function(o,s){let n=!1;for(let t=0;t<document.querySelectorAll("script").length;t++)-1!==document.querySelectorAll("script")[t].src.indexOf(e.tagName.toLowerCase())&&(n=!0);if(!0===n)console.log("модуль загружен");else{const n=document.createElement("script");n.type="module",n.src=`/static/html/components/${e.tagName.toLowerCase()}/${e.tagName.toLowerCase()}.mjs`,n.setAttribute("async",""),n.onload=o,n.onerror=s,t.this.appendChild(n)}})}var a;async function r(e,t){let o=("; "+e).split("; "+t+"=");if(2==o.length)return o.pop().split(";").shift()}t.push("component-id"),t.push("script"),t.push("component-action"),o.push("h1"),o.push("innerText"),s.push("shadowRoot"),s.push("head"),s.push("shadow"),s.push("light"),s.push("lightDom"),s.push("editor"),s.push("слайдер"),s.push("swap"),e.this=this,e["type-supported"]=o,(a=this,new Promise(function(e,t){let o=[];o.staticProperty=[],o.staticProperty.c=0,o.state=[],o.state.push("shadow"),o.state.push("light"),o.words=s,o["type-swap"]=!1,o["type-external"]=!1,o["document-offsetWidth"]=document.body.offsetWidth;let n=!1;if(o.getAttribute=((e,t,o)=>{if("template"===o){if(!e.getAttribute("type"))return e.setAttribute("type","default"),!1;for(let o=0;o<e.getAttribute("type").split("-").length;o++)e.getAttribute("type").split("-")[o]===t&&(n=!0);return n}if(e[`verify-${t}`]=!1,0===e.this.getAttribute("type").split("-").length)return!1;for(let o=0;o<e.this.getAttribute("type").split("-").length;o++)e.this.getAttribute("type").split("-")[o]===t?e[`verify-${t}`]=!0:e[`verify-${t}`]=!1;return console.assert(!1,e),e[`verify-${t}`]}),a.tagName.toLowerCase()&&(o.component=a.tagName.toLowerCase()),"object"!=typeof a);else{if(a.getAttribute("type")){o.type=a.getAttribute("type").split("-");for(let e=0;e<o.type.length;e++)o.type[e]=o.type[e].replace(/:/g,"-");for(let e in o.type)switch(o.type[e]){case"swap":o["type-swap"]=!0;break;case"external":o["type-external"]=!0}}else o.type=["default"],a.setAttribute("type","default");if(a.slot?o.slot=a.slot:(a.slot=a.tagName.toLowerCase(),o.slot=a.slot),a.getAttribute("type")){let e=!1;for(let t in a.getAttribute("type").split("-"))-1!==a.getAttribute("type").split("-")[t].indexOf("style:")&&(e=!0);o["style-custom"]=!0===e?"not-default":"default"}}o.shadowRoot=!1,o.this=a,e(o)})).then(e=>{i(e).then(e=>{(function(e){return new Promise(function(t,o){let s=document.createElement("style"),n=document.createElement("style"),i={};(i=e.slot?e.slot:e.parent)||console.assert(!1,"не установленны ни слот ни парент");for(let t=0;t<e.type.length;t++)"swap"===e.type[t]?"scoped"===e.type[t]&&s.setAttribute("scoped",""):"scoped"===e.type[t]&&n.setAttribute("scoped","");for(let o=0;o<e.state.length;o++){switch(e[`path-style-${e.state[o]}`]=`@import '/static/html/components/${e.component}/${e.state[o]}/${e.component}.css'; @import '/static/html/components/${e.component}/${e.state[o]}/${e.component}-custom.css';`,e.state[o]){case"shadow":!0===e.verify.preset&&(e[`path-style-${e.state[o]}-preset`]=`@import '/static/html/components/${e.component}/template/${i}.css';`),s.innerText=e[`path-style-${e.state[o]}`]+e[`path-style-${e.state[o]}-preset`];break;case"light":!0===e.verify.preset&&(e[`path-style-${e.state[o]}-preset`]=`@import '/static/html/components/${e.component}/template/${i}.css';`),n.innerText=e[`path-style-${e.state[o]}`]+e[`path-style-${e.state[o]}-preset`]}"swap"===e.state[o]?!0===e.shadowRoot?(e.this.shadowRoot.appendChild(n),e.this.appendChild(s),t(e)):e.this.appendChild(s):!0===e.shadowRoot?(e.this.shadowRoot.appendChild(s),e.this.appendChild(n),t(e)):e.this.appendChild(n)}t(e)})})(e).then(e=>{!async function(e){null===sessionStorage.getItem("uid")?sessionStorage.setItem("uid",await r(document.cookie,"webRTC")):void 0===await r(document.cookie,"webRTC")||await r(document.cookie,"webRTC")===sessionStorage.getItem("uid")||console.assert(!1,"куки отличаются от uid");sessionStorage.setItem("PrivateChat",""),sessionStorage.setItem("last_name",""),sessionStorage.setItem("user_id",""),sessionStorage.setItem("first_name","");let t={};e.this.shadowRoot.querySelector("div.buttonNext").style.display="none",await store({input:"telegram-login",this:e.this,obj:e,slot:e.slot,type:"obj",img:"none"},"set","type");let o=new((await webSocket({name:"telegram-login"})).class)(await Config("telegram","localWss")),s=new((await Login({name:"telegram-login"})).class);await s.phoneCode(e),document.addEventListener("authorizationStateWaitPhoneNumber",async o=>{e.this.shadowRoot.querySelector("#next").addEventListener("click",async o=>{await s.templateCode(e.this.shadowRoot),t=`${e.this.shadowRoot.querySelector("#code").innerText}${e.this.shadowRoot.querySelector("#phone").value}`;let n={};if(10===(n=e.this.shadowRoot.querySelector("#phone").value.replace(/\s/g,"")).length){localStorage.setItem("signed",e.this.shadowRoot.querySelector("#signed").checked);let o=new FormData;o.append("phone_number",t),o.append("signed",e.this.shadowRoot.querySelector("#signed").checked);let s=await fetch("http://localhost:7000/Authorization",{method:"POST",credentials:"include",body:o});s.ok?s=await s.json():console.error("what's wrong")}})}),document.addEventListener("authorizationStateWaitCode",async s=>{e.this.shadowRoot.querySelector("form").style.display="none",e.this.shadowRoot.querySelector("#verification").style.display="flex",e.this.shadowRoot.querySelector(".head").innerHTML="",void 0===s.detail.data.code_info||(t=s.detail.data.code_info.phone_number),e.this.shadowRoot.querySelector(".head").insertAdjacentHTML("afterbegin",`\n                   <h1>${t}</h1>\n                   <img id="change" src="/static/images/JSDesign/WebDesign_v0.1/Icons/edit_svg.svg">\n                   `),e.this.shadowRoot.querySelector("img.telegram").src="/static/html/components/telegram-login/images/monkeyCode.png",e.this.shadowRoot.querySelector("div.telegram").style.background="transparent",e.this.shadowRoot.querySelector(".message").innerText="",e.this.shadowRoot.querySelector(".message").insertAdjacentHTML("afterbegin","\n                  <p>We have sent you an sms</p>\n                  <p>with the code</p>"),e.this.shadowRoot.querySelector(".message").insertAdjacentHTML("afterbegin",'\n               \n                    <input type="button" value="sendSms" id="sms">'),e.this.shadowRoot.querySelector("#sms").addEventListener("click",async e=>{o.socket.send(JSON.stringify({type:"resendPhoneNumberConfirmationCode"}))}),e.this.shadowRoot.querySelector(".buttonNext").style.display="none",e.this.shadowRoot.querySelector("#verification").addEventListener("input",async()=>{e.this.shadowRoot.querySelector("#verification").style.borderColor="red",e.this.shadowRoot.querySelector("img.telegram").src="/static/html/components/telegram-login/images/monkeyCode.png",0===e.this.shadowRoot.querySelector("#verification").value.length?(e.this.shadowRoot.querySelector("img.telegram").src="/static/html/components/telegram-login/images/monkey.png",e.this.shadowRoot.querySelector("#verification").style.borderColor="#acb2b5"):5===e.this.shadowRoot.querySelector("#verification").value.length&&(null===sessionStorage.getItem("uid")?console.assert(!1,"нет uid"):o.socket.send(JSON.stringify({type:"code",uid:`${sessionStorage.getItem("uid")}`,code:e.this.shadowRoot.querySelector("#verification").value})))}),e.this.shadowRoot.querySelector("#change").addEventListener("click",async t=>{e.this.shadowRoot.querySelector(".head").innerHTML="",e.this.shadowRoot.querySelector(".head").insertAdjacentHTML("afterbegin","\n                <h1>Sign in to Telegram</h1>"),e.this.shadowRoot.querySelector(".message").innerText="",e.this.shadowRoot.querySelector(".message").insertAdjacentHTML("afterbegin","\n                <p>Please confirm your country and</p>\n                <p>enter you phone number</p>"),e.this.shadowRoot.querySelector("img.telegram").src="/static/html/components/telegram-login/images/telegram.png",e.this.shadowRoot.querySelector("#next").innerText="Next",e.this.shadowRoot.querySelector(".loader").style.display="none",e.this.shadowRoot.querySelector("form").style.display="flex",e.this.shadowRoot.querySelector("#verification").style.display="none",e.this.shadowRoot.querySelector(".buttonNext").style.display="flex",e.this.shadowRoot.querySelector("#next").disabled=!1})}),document.addEventListener("authorizationStateLoggingOut",async e=>{}),document.addEventListener("authorizationStateWaitPassword",async t=>{e.this.shadowRoot.querySelector("#verification").style.display="none",e.this.shadowRoot.querySelector("img.telegram").src="/static/html/components/telegram-login/images/password.png",e.this.shadowRoot.querySelector(".head").innerHTML="",e.this.shadowRoot.querySelector(".head").insertAdjacentHTML("afterbegin","\n                <h1>Enter a Password</h1>"),e.this.shadowRoot.querySelector(".message").innerText="",e.this.shadowRoot.querySelector(".message").insertAdjacentHTML("afterbegin","\n                 <p>Your account is protected with</p>\n                 <p>an additional password</p>"),e.this.shadowRoot.querySelector("#login").insertAdjacentHTML("beforeend",'\n                <div id="password">\n                    <input type="password" class="password" placeholder="password">\n                    <div id="view"> <img class="password" src="/static/html/components/telegram-login/images/eye2_svg.svg"></div>\n                </div>\n                ');for(let t=0;t<e.this.shadowRoot.querySelectorAll(".buttonNext").length;t++)e.this.shadowRoot.querySelectorAll(".buttonNext")[t].remove();e.this.shadowRoot.querySelector("#login").insertAdjacentHTML("beforeend",'\n            \n            <div class="buttonNext" style="display:flex;">\n            <button id="next">Next</button>\n            <div class="loader"></div>\n            </div>\n            '),e.this.shadowRoot.querySelector("img.password").addEventListener("click",async t=>{switch(e.this.shadowRoot.querySelector("input.password").type){case"text":e.this.shadowRoot.querySelector("input.password").type="password",e.this.shadowRoot.querySelector("img.telegram").src="/static/html/components/telegram-login/images/password.png";break;case"password":e.this.shadowRoot.querySelector("img.telegram").src="/static/html/components/telegram-login/images/passwordTxt.png",e.this.shadowRoot.querySelector("input.password").type="text"}}),e.this.shadowRoot.querySelector("#next").addEventListener("click",async()=>{0===e.this.shadowRoot.querySelector("input.password").value.length||(null===sessionStorage.getItem("uid")?console.assert(!1,"нет uid"):o.socket.send(JSON.stringify({type:"password",uid:`${sessionStorage.getItem("uid")}`,password:e.this.shadowRoot.querySelector("input.password").value})),e.this.shadowRoot.querySelector("input.password").value="",e.this.shadowRoot.querySelector("#next").disabled="true")})}),document.addEventListener("authorizationStateWaitRegistration",async t=>{e.this.shadowRoot.querySelector("#verification").remove(),await s.templatePhoto(e);let n={first_name:void 0,last_name:void 0,photo:void 0};e.this.shadowRoot.querySelector("#name").addEventListener("input",async t=>{if(e.this.shadowRoot.querySelector("#name").style.borderColor="#acb2b5",n.first_name=t.target.value,void 0===n.photo);else{for(let t=0;t<e.this.shadowRoot.querySelectorAll(".buttonNext").length;t++)e.this.shadowRoot.querySelectorAll(".buttonNext")[t].remove();e.this.shadowRoot.querySelector("#login").insertAdjacentHTML("beforeend",'\n            \n            <div class="buttonNext" style="display:flex;">\n            <button id="next">Next</button>\n            <div class="loader"></div>\n            </div>\n            '),e.this.shadowRoot.querySelector("#next").addEventListener("click",async()=>{void 0===n.last_name&&(n.last_name=""),null===sessionStorage.getItem("uid")?console.assert(!1,"нет uid"):o.socket.send(JSON.stringify({type:"bio",uid:`${sessionStorage.getItem("uid")}`,photo:n.photo,first_name:n.first_name,last_name:n.last_name}))})}}),e.this.shadowRoot.querySelector("#last_name").addEventListener("input",async e=>{n.last_name=e.target.value}),document.addEventListener("telegram-login-action",async t=>{if(n.photo=t.detail.photo.blob,void 0===n.first_name)e.this.shadowRoot.querySelector("#name").style.borderColor="red";else{for(let t=0;t<e.this.shadowRoot.querySelectorAll(".buttonNext").length;t++)e.this.shadowRoot.querySelectorAll(".buttonNext")[t].remove();e.this.shadowRoot.querySelector("#login").insertAdjacentHTML("beforeend",'\n            \n            <div class="buttonNext" style="display:flex;">\n            <button id="next">Next</button>\n            <div class="loader"></div>\n            </div>\n            '),e.this.shadowRoot.querySelector("#next").addEventListener("click",async()=>{void 0===n.last_name&&(n.last_name=""),o.socket.send(JSON.stringify({type:"bio",photo:n.photo,first_name:n.first_name,last_name:n.last_name}))})}}),e.this.shadowRoot.querySelector("#image").onchange=function(t){let o=new CustomEvent("sideBarCrop",{detail:{id:e.component,slot:e.slot,file:t.target.files[0]}});document.dispatchEvent(o),t.target.value=""}}),null===localStorage.getItem("signed")?localStorage.setItem("signed",!1):localStorage.setItem("signed",e.this.shadowRoot.querySelector("#signed").checked);let n=new FormData,i=await fetch("http://localhost:7000/init",{method:"POST",credentials:"include",body:n});i.ok?i=await i.json():console.error("what's wrong")}(e)})})})}connectedCallback(){console.log("connected callback")}disconnectedCallback(){console.log("disconnected callback")}componentWillMount(){console.log("component will mount")}componentDidMount(){console.log("component did mount")}componentWillUnmount(){console.log("component will unmount")}componentDidUnmount(){console.log("component did unmount")}});