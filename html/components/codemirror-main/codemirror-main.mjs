import store from"/static/html/components/component_modules/staticProperty/staticProperty.mjs";import Codemirror from"/static/html/components/component_modules/codemirror/codemirror.mjs";import Stjs from"/static/html/components/component_modules/stjs/st.mjs";import Json from"/static/html/components/component_modules/stjs/json.mjs";customElements.define("codemirror-main",class extends HTMLElement{constructor(){super();let e=[],t=[],n=[],r=[];function l(e,t,n){return new Promise(function(t,n){e["template-shadow"]=[],e["template-light"]=[];let r=[];r.swap=!1,r.external=!1,r.light=!1,r.slider=!1,r.one=!1;for(let t=0;t<e.type.length;t++){if(-1!==e.type[t].indexOf("slider")&&e.type[t].split("-").length>1){r.slider=!0;for(let n in e.type[t].split("-"))switch(e.type[t].split("-")[n]){case"one":r.one=!0}}if(e.type[t].length)switch(e.type[t]){case"swap":r.swap=!0;break;case"external":r.external=!0;break;case"light":r.light=!0;break;case"slider":r.slider=!0}}if(!0===r.swap){for(let t=0;t<e.this.children.length;t++)1===e.this.children[t].tagName.split("-").length?("view"===e.this.children[t].slot&&(e.this.children[t].className="wall"),e["template-light"].push(e.this.children[t])):!0===e.getAttribute(e.this.children[t],"light","template")?(e.this.children[t].setAttribute("type",`${e.this.children[t].getAttribute("type")}-external`),o(e.this.children[t]),e["template-light"].push(e.this.children[t])):(e.this.children[t].setAttribute("type",`${e.this.children[t].getAttribute("type")}-external`),o(e.this.children[t]),e["template-shadow"].push(e.this.children[t]));for(let t=0;t<e.template.children.length;t++)1===e.template.children[t].tagName.split("-").length?("view"===e.template.children[t].slot&&(e.template.children[t].className="wall"),e["template-light"].push(e.template.children[t])):!0===e.getAttribute(e.template.children[t],"light","template")?(e.template.children[t].setAttribute("type",`${e.template.children[t].getAttribute("type")}-external`),o(e.template.children[t]),e["template-light"].push(e.template.children[t])):(e.template.children[t].setAttribute("type",`${e.template.children[t].getAttribute("type")}-external`),o(e.template.children[t]),e["template-shadow"].push(e.template.children[t]))}else{for(let t=0;t<e.this.children.length;t++)1===e.this.children[t].tagName.split("-").length?("view"===e.this.children[t].slot&&(e.this.children[t].className="wall"),e["template-shadow"].push(e.this.children[t])):!0===e.getAttribute(e.this.children[t],"light","template")?(o(e.this.children[t]),e["template-shadow"].push(e.this.children[t])):(o(e.this.children[t]),e["template-light"].push(e.this.children[t]));for(let t=0;t<e.template.children.length;t++)1===e.template.children[t].tagName.split("-").length?("view"===e.template.children[t].slot&&(e.template.children[t].className="wall"),e["template-shadow"].push(e.template.children[t])):!0===e.getAttribute(e.template.children[t],"light","template")?(o(e.template.children[t]),e["template-shadow"].push(e.template.children[t])):(o(e.template.children[t]),e["template-light"].push(e.template.children[t]))}for(let t in r)e.verify[t]=r[t];!0===e.verify.slider?function(e){return new Promise(function(t,n){fetch(`/static/html/components/varan-slider/template/${e.slot}.html`).then(function(e){if(e.ok)return e.text()}).then(function(n){let r=new DOMParser,l=r.parseFromString(n,"text/html");e.slider=l.getElementsByTagName("template")[0].content.cloneNode(!0);let i=document.createElement("section");if(i.className="slider",i.slot="view",i.appendChild(e.slider),e.slider=i,0===i.querySelectorAll(".ql-editor").length)t(e);else for(let e=0;e<i.querySelectorAll(".ql-editor").length;e++)if(0===i.querySelectorAll(".ql-editor")[e].children.length);else for(let t=0;t<i.querySelectorAll(".ql-editor")[e].children.length;t++)i.querySelectorAll(".ql-editor")[e].children[t].tagName.split("-").length>1&&o(i.querySelectorAll(".ql-editor")[e].children[t]);t(e)}).catch(e=>e)})}(e).then(e=>{e["template-light"].push(e.slider),e.this.appendChild(e.slider),function(e,t,n){return new Promise(function(n,r){if(t){switch(t){case"slider":(function(e,t){return new Promise(function(n,r){for(let r=0;r<e.state.length;r++)for(let l=0;l<e[`template-${e.state[r]}`].length;l++)0===e[`template-${e.state[r]}`][l].getElementsByClassName(t).length||(e.slider=e[`template-${e.state[r]}`][l].getElementsByClassName(t)[0],n(e[`template-${e.state[r]}`][l].getElementsByClassName(t)[0]))})})(e,"peppermint").then(t=>{(function(e){return new Promise(function(t,n){t(Peppermint(e,{dots:!1,slideshow:!1,speed:500,slideshowInterval:5e3,stopSlideshowAfterInteraction:!0,onSetup:function(e){}}))})})(t).then(t=>{e.slider=t,n(e)})})}n(e)}else n(e)})}(e,"slider").then(e=>{if(!0===e.verify.one)for(let n=0;n<e.state.length;n++)for(let r=0;r<e[`template-${e.state[n]}`].length;r++)"wall"===e[`template-${e.state[n]}`][r].className&&(e[`template-${e.state[n]}`].splice(r,1),t(e));else t(e)})}):t(e)})}function i(t,n){return new Promise(function(n,r){t.verify=[],t.this.getAttribute("preset")?(t["path-template"]=`/static/html/components/${t.component}/template/${t.this.getAttribute("preset")}/${t.component}-${t.this.getAttribute("preset")}.html`,t.preset=`${t.this.getAttribute("preset")}`,t.verify.preset=!0):(t["path-template"]=`/static/html/components/${t.component}/${t.component}.html`,t.verify.preset=!1),fetch(t["path-template"]).then(function(e){if(e.ok)return e.text()}).then(function(r){let i=(new DOMParser).parseFromString(r,"text/html");t.template=i.getElementsByTagName("template")[0].content.cloneNode(!0),function(t){return new Promise(function(n,r){t["path-external"]=`/static/html/components/${t.component}/external/${t.component}-external.html`,fetch(t["path-external"]).then(function(e){return!1===e.ok?e.ok:e.text()}).then(function(r){if(!1===r);else{let l=new DOMParser,i=l.parseFromString(r,"text/html");t.external=i.querySelectorAll("section"),function(t){return new Promise(function(n,r){t["external-property"]=e["external-property"];let l=[],i=[],o=[];for(let e=0;e<t.external.length;e++){for(let n=0;n<t.external[e].children.length;n++)switch(t.external[e].children[n].tagName){case"SCRIPT":t.external[e].getAttribute("id")&&(i.script=t.external[e].children[n]);break;case"COMPONENT-ID":i.id=t.external[e].children[n].innerText;break;case"COMPONENT-ACTION":for(let r=0;r<t.external[e].children[n].children.length;r++)o.push(t.external[e].children[n].children[r].innerText);i.actions=o}l.push(i),i=[]}t["external-property"]=l,n(t)}).catch(e=>{})}(t).then(e=>{0===e["external-property"].length?n(e):function(e){return new Promise(function(t,n){e["words-action"]=[];let r=[];for(let n=0;n<e["external-property"].length;n++){for(let t=0;t<e["external-property"][n].actions.length;t++)for(let l=0;l<e.words.length;l++)-1!==e["external-property"][n].actions[t].indexOf(e.words[l])&&("shadowRoot"!==e.words[l]&&"shadow"!==e.words[t]||(r.shadow=!0),"light"!==e.words[l]&&"лайт"!==e.words[t]||(r.light=!0),"editor"===e.words[l]&&(r.editor=!0),"слайдер"===e.words[l]&&(r["editor-slider"]=!0),"swap"===e.words[l]&&(r.swap=!0));e["words-action"]=r;for(let t in e["external-property"])for(let n in e["external-property"][t])switch(n){case"id":let r=document.createElement(e["external-property"][t][n]);r.setAttribute("type","external"),e.this.appendChild(r)}t(e)}})}(e).then(e=>{n(e)})})}}).catch(e=>{throw e})})}(t).then(e=>{l(e,e["type-swap"],e["type-external"]).then(e=>{if(!0===e.verify.swap){if(0!==e["template-shadow"].length){e.this.attachShadow({mode:"open"}),e.shadowRoot=!0;for(let t=0;t<e["template-shadow"].length;t++)e.this.shadowRoot.appendChild(e["template-shadow"][t])}if(0!==e["template-light"].length)for(let t=0;t<e["template-light"].length;t++)e.this.appendChild(e["template-light"][t])}else{if(0!==e["template-shadow"].length){e.this.attachShadow({mode:"open"}),e.shadowRoot=!0;for(let t in e["template-shadow"])e.this.shadowRoot.appendChild(e["template-shadow"][t])}if(0!==e["template-light"].length)for(let t in e["template-light"])e.this.appendChild(e["template-light"][t])}n(e)})})}).catch(e=>e)})}function o(e){return new Promise(function(t,n){const r=document.createElement("script");let l=!1;for(let t in document.head.getElementsByTagName("script"))"object"==typeof document.head.getElementsByTagName("script")[t]&&-1!==document.head.getElementsByTagName("script")[t].outerHTML.indexOf(e.tagName.toLowerCase())&&(l=!0);!0===l||(r.src=`/static/html/components/${e.tagName.toLowerCase()}/${e.tagName.toLowerCase()}.mjs`,r.type="module",r.onload=t,r.onerror=n,document.head.appendChild(r))})}var s;t.push("component-id"),t.push("script"),t.push("component-action"),n.push("h1"),n.push("innerText"),r.push("shadowRoot"),r.push("head"),r.push("shadow"),r.push("light"),r.push("lightDom"),r.push("editor"),r.push("слайдер"),r.push("swap"),e.this=this,e["type-supported"]=n,(s=this,new Promise(function(e,t){let n=[];n.state=[],n.state.push("shadow"),n.state.push("light"),n.words=r,n["type-swap"]=!1,n["type-external"]=!1,n["document-offsetWidth"]=document.body.offsetWidth;let l=!1;if(n.getAttribute=((e,t,n)=>{if("template"===n){if(!e.getAttribute("type"))return e.setAttribute("type","default"),!1;for(let n=0;n<e.getAttribute("type").split("-").length;n++)e.getAttribute("type").split("-")[n]===t&&(l=!0);return l}if(e[`verify-${t}`]=!1,0===e.this.getAttribute("type").split("-").length)return!1;for(let n=0;n<e.this.getAttribute("type").split("-").length;n++)e.this.getAttribute("type").split("-")[n]===t?e[`verify-${t}`]=!0:e[`verify-${t}`]=!1;return e[`verify-${t}`]}),s.tagName.toLowerCase()&&(n.component=s.tagName.toLowerCase()),"object"!=typeof s);else{if(s.getAttribute("type")){n.type=s.getAttribute("type").split("-");for(let e=0;e<n.type.length;e++)n.type[e]=n.type[e].replace(/:/g,"-");for(let e in n.type)switch(n.type[e]){case"swap":n["type-swap"]=!0;break;case"external":n["type-external"]=!0}}else n.type=["default"],s.setAttribute("type","default");if(s.slot?n.slot=s.slot:(s.slot=s.tagName.toLowerCase(),n.slot=s.slot),s.getAttribute("type")){let e=!1;for(let t in s.getAttribute("type").split("-"))-1!==s.getAttribute("type").split("-")[t].indexOf("style:")&&(e=!0);n["style-custom"]=!0===e?"not-default":"default"}}n.shadowRoot=!1,n.this=s,e(n)})).then(e=>(i(e).then(e=>(function(e){return new Promise(function(t,n){let r=document.createElement("style"),l=document.createElement("style");for(let t=0;t<e.type.length;t++)"swap"===e.type[t]?"scoped"===e.type[t]&&r.setAttribute("scoped",""):"scoped"===e.type[t]&&l.setAttribute("scoped","");for(let n=0;n<e.state.length;n++){switch(e[`path-style-${e.state[n]}`]=`@import '/static/html/components/${e.component}/${e.state[n]}/${e.component}.css'; @import '/static/html/components/${e.component}/${e.state[n]}/${e.component}-custom.css';`,e.state[n]){case"shadow":!0===e.verify.preset&&(e[`path-style-${e.state[n]}-preset`]=`@import '/static/html/components/${e.component}/template/${e.preset}/${e.component}-${e.preset}.css';`),r.innerText=e[`path-style-${e.state[n]}`]+e[`path-style-${e.state[n]}-preset`];break;case"light":!0===e.verify.preset&&(e[`path-style-${e.state[n]}-preset`]=`@import '/static/html/components/${e.component}/template/${e.preset}/${e.component}-${e.preset}.css';`),l.innerText=e[`path-style-${e.state[n]}`]+e[`path-style-${e.state[n]}-preset`]}"swap"===e.state[n]?!0===e.shadowRoot?(e.this.shadowRoot.appendChild(l),e.this.appendChild(r),t(e)):e.this.appendChild(r):!0===e.shadowRoot?(e.this.shadowRoot.appendChild(r),e.this.appendChild(l),t(e)):e.this.appendChild(l)}t(e)})}(e).then(e=>(async function(e){store({input:"page-scroll",this:e.this,obj:e,type:"obj"},"set","type");let t=new((await Codemirror({_:"codemirror",this:e.this.shadowRoot})).class),n=await t.init({_:"init",mode:"javascript",this:e.this.shadowRoot.querySelector("#code")}),r=e.this.shadowRoot.querySelector("#search"),l=e.this.shadowRoot.querySelector("#fnext"),i=e.this.shadowRoot.querySelector("#fprev"),o=e.this.shadowRoot.querySelector("#replace"),s=e.this.shadowRoot.querySelector("#replall"),a=e.this.shadowRoot.querySelector("#goto"),h=e.this.shadowRoot.querySelector("#undo"),p=e.this.shadowRoot.querySelector("#redo"),d=e.this.shadowRoot.querySelector("#save"),c=e.this.shadowRoot.querySelector("#getLast"),m=e.this.shadowRoot.querySelector("#run"),u=(e.this.shadowRoot.querySelector("#result"),e.this.shadowRoot.querySelector("#script")),f=(new((await Codemirror({_:"codemirror",this:e.this.shadowRoot})).class),await t.init({_:"init",mode:"application/json",this:e.this.shadowRoot.querySelector("#result")})),y=(await Stjs.ST({_:"ST",this:e.this}),new((await Json()).class));n.editor.on("drop",function(e,t){var n,r;if((r=t.dataTransfer.files).length>0)return t.preventDefault(),t.stopPropagation(),n=r[0],alert("File: "+n.name),!1}),r.addEventListener("click",function(){t.self.CodeMirror.commands.find(n.editor)},!1),l.addEventListener("click",function(){t.self.CodeMirror.commands.findNext(n.editor)},!1),i.addEventListener("click",function(){t.self.CodeMirror.commands.findPrev(n.editor)},!1),o.addEventListener("click",function(){t.self.CodeMirror.commands.replace(n.editor)},!1),s.addEventListener("click",function(){t.self.CodeMirror.commands.replaceAll(n.editor)},!1),a.addEventListener("click",function(){t.self.CodeMirror.commands.jumpToLine(n.editor)},!1),h.addEventListener("click",function(){n.editor.undo()},!1),p.addEventListener("click",function(){n.editor.redo()},!1),d.addEventListener("click",function(){let e=n.editor.getValue();sessionStorage.setItem("CodeMirror",e)},!1),c.addEventListener("click",function(){let e=sessionStorage.getItem("CodeMirror");n.editor.setValue(e)},!1),m.addEventListener("click",async()=>{let e=n.editor.getValue(),t=document.createElement("script");t.type="module";let r=`\n(async ()=>{\n    ${e}\n    let verifyData = false;\n    let verifyTemplate = false;\n    if(typeof data !== "undefined"){\n        verifyData = true;\n    }\n    if(typeof template !== "undefined"){\n        verifyTemplate = true\n    }\n    if(verifyData === true && verifyTemplate === true){\n\n        document.dispatchEvent(new CustomEvent('CodeMirror', {\n            detail: {\n                _:'transform',\n                data:data,\n                template:template\n            }\n        }))\n    }else{\n\n        document.dispatchEvent(new CustomEvent('CodeMirror', {\n            detail: {\n                _:'response',\n                data:${e}\n            }\n        }))\n        \n    }\n})()`;t.innerHTML=r,u.appendChild(t)},!1),document.addEventListener("CodeMirror",async e=>{if("transform"===e.detail._){let t=await y.select(e.detail.data),n=await y.transformWith(e.detail.template,!1,t),r=await y.root(n);f.editor.setValue(JSON.stringify(r,null,4))}else f.editor.setValue(`${e.detail.data()}`);u.innerHTML=""})}(e),e)),e)),e))}});