const defaultOptions={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function generateCallbackFunction(){return`jsonp_${Date.now()}_${Math.ceil(1e5*Math.random())}`}function clearFunction(e){try{delete window[e]}catch(t){window[e]=void 0}}function removeScript(e){const t=document.getElementById(e);t&&document.getElementsByTagName("head")[0].removeChild(t)}function fetchJsonp(e,t={}){let n=e;const o=t.timeout||defaultOptions.timeout,c=t.jsonpCallback||defaultOptions.jsonpCallback;let r;return new Promise((a,i)=>{const l=t.jsonpCallbackFunction||generateCallbackFunction(),u=`${c}_${l}`;window[l]=(e=>{a({ok:!0,json:()=>Promise.resolve(e)}),r&&clearTimeout(r),removeScript(u),clearFunction(l)}),n+=-1===n.indexOf("?")?"?":"&";const s=document.createElement("script");s.setAttribute("src",`${n}${c}=${l}`),t.charset&&s.setAttribute("charset",t.charset),s.id=u,document.getElementsByTagName("head")[0].appendChild(s),r=setTimeout(()=>{i(new Error(`JSONP request to ${e} timed out`)),clearFunction(l),removeScript(u),window[l]=(()=>{clearFunction(l)})},o),s.onerror=(()=>{i(new Error(`JSONP request to ${e} failed`)),clearFunction(l),removeScript(u),r&&clearTimeout(r)})})}export default fetchJsonp;